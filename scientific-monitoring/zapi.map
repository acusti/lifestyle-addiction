{"version":3,"file":"zapi.js","sources":["zapi-compiled.js","src/str-to-date.js"],"names":["$","zapi","js_plugin_src","defaults","collection","user","num_entries","start","zotero_options","ip","params","callback","collection_name","window","location","pathname","split","pop","replace","feed_base","namespace","lang","$body","document","body","$window","$parent_body","$footer","$year_filter","$year_links","$year_sections","quarter_labels","en","fr","years","total","is_init","is_all_loading","is_all_loaded","loading_class","loading_indicator_styles","loading_indicator_html","monitoring_css","year_filter_html","tab_height_timeout","fixTabHeight","clearTimeout","setTimeout","off","frameElement","height","tab_height","parent","on","filterByType","type","this","attr","buildParams","options","extend","quarterly","getFeedUrl","feed_url","Date","toDateString","q","encodeURIComponent","getReferences","substr","shift","initialize","hasClass","find","append","addClass","prev","className","before","ajax","url","dataType","done","data","qtr_idx","the_month","$entry","$bib","bib_html","bib_url_start","entry","entry_class","$feed","parseXML","responseData","xmlString","$entries","len","length","i","ref_html","the_year","year_class","year_title_class","is_new_year","years_for_quarters","parseInt","text","parseJSON","filter","push","strToDate","date","month","Math","floor","title","children","outerHTML","lastIndexOf","substring","indexOf","loadYearFilterList","year_list","yearFilterToggle","yearFilterTitleToggle","evt","preventDefault","$year_link","active_year","not","removeClass","toggleClass","innerHTML","fadeOut","fadeIn","trigger","setupQuarterFilters","getNextReferences","getAllReferences","fail","timedout","prepareMarkup","success","resp","stopPropagation","yearFilterAddActive","yearFilterToggleActive","the_years","$quarters","refs_by_quarter","attachQuarterFilterToggle","$filter","active_quarter","zotero_api","undefined","event","special","inview","href","join","jQuery","_slashRe","_yearRe","_monthRe","_dayRe","_country","string","order","part","parts","toString","m","exec","year","day","tmp","today","getFullYear","twoDigitYear","century","_insertDateOrderPart","splice","months","RegExp","toLowerCase","after","daySuffixes","index","dateOrder","partOrder","pos"],"mappings":"CAAA,SAAUA,GACT,GAAIC,GAAMC,CAEVD,IACCE,UACCC,WAAiB,GACjBC,KAAiB,UAEjBC,YAAiB,GACjBC,MAAiB,EACjBC,eAAiB,8DACjBC,IAAiB,GAElBC,UACAC,YACAC,gBAAkBC,OAAOC,SAASC,SAASC,MAAM,KAAKC,MAAMC,QAAQ,WAAY,IAAIA,QAAQ,cAAe,IAAIA,QAAQ,QAAS,IAChIC,UAAkB,gCAClBC,UAAkB,UAClBC,KAAkB,KAElBC,MAAkBtB,EAAEuB,SAASC,MAC7BC,QAAkBzB,EAAEa,QACpBa,aAAkB1B,EAAE,QACpB2B,QAAkB3B,EAAE,kBACpB4B,aAAkB5B,IAClB6B,YAAkB7B,IAClB8B,eAAkB9B,IAElB+B,gBACCC,IACC,YACA,eACA,cACA,aAEDC,IACC,aACA,eACA,cACA,cAIFC,SAEAC,OAA2B,EAE3BC,SAA2B,EAE3BC,gBAA2B,EAE3BC,eAA2B,EAE3BC,cAA2B,qBAE3BC,yBAA2B,GAC3BC,uBAA2B,GAC3BC,eAA2B,u4CAC3BC,iBAA2B,GAE3BC,mBAA2B,GAC3BC,aAAe,WACdhC,OAAOiC,aAAa7C,EAAK2C,oBACzB3C,EAAK2C,mBAAqB/B,OAAOkC,WAAW,WAE3C9C,EAAKwB,QAAQuB,IAAI,eAAiB/C,EAAKW,iBAEvCC,OAAOoC,aAAaC,OAASjD,EAAKkD,WAAalD,EAAKqB,MAAM8B,SAASF,SAAW,GAE9ErC,OAAOkC,WAAW,WACjB9C,EAAKwB,QAAQ4B,GAAG,eAAiBpD,EAAKW,gBAAiBX,EAAK4C,eAC1D,MACD,MAEJS,aAAe,SAASC,GACvB,MAAO,YACN,MAAOvD,GAAEwD,MAAMC,KAAK,eAAiBF,IAGvCG,YAAe,SAASC,GACvB1D,EAAKS,OAASV,EAAE4D,UAAW3D,EAAKE,SAAUwD,GACtC1D,EAAKS,OAAOmD,YACf5D,EAAKS,OAAOJ,YAAc,KAG5BwD,WAAe,WACd,GAAIC,GAAW9D,EAAKkB,SAYpB,OATA4C,IAAY9D,EAAKS,OAAOL,KAAO,gBAAkBJ,EAAKS,OAAON,WAAa,UAAYH,EAAKS,OAAOF,eAAiB,UAAYP,EAAKS,OAAOH,MAAQ,UAAYN,EAAKS,OAAOJ,YAG3KyD,GAAY,QAAS,GAAIC,OAAOC,eAE5BhE,EAAKS,OAAOwD,IACfH,GAAY,MAAQ9D,EAAKS,OAAOwD,EAAI,2BAG9B,4EAA8EjE,EAAKS,OAAOJ,aAAeL,EAAKS,OAAOD,GAAK,WAAaR,EAAKS,OAAOD,GAAK,IAAM,MAAQ0D,mBAAmBJ,IAEjMK,cAAe,SAAST,EAAShD,GAiBhC,GAfIgD,IAEH1D,EAAKyD,YAAYC,GACbhD,IACHV,EAAKU,SAAWA,GAGoD,OAAjEyC,OAAOvC,OAAOC,SAASC,SAASsD,OAAO,GAAGrD,MAAM,KAAKsD,UACxDrE,EAAKoB,KAAO,OAGVpB,EAAKmC,SACRnC,EAAKsE,cAGFtE,EAAKqC,cAAT,CAIA,GAAIyB,GAAW9D,EAAK6D,YAGf7D,GAAKqB,MAAMkD,SAAS,WACxBxE,EAAEuB,UAAUkD,KAAK,QAAQC,OAAO,UAAYzE,EAAKyC,eAAiB,KAAOzC,EAAKuC,yBAA2B,YACzGvC,EAAKqB,MAAMqD,SAAS,UAIoB,YAArC1E,EAAK0B,QAAQiD,OAAO,GAAGC,YAE1B7E,EAAE,QAAQ0E,OAAO,UAAYzE,EAAKuC,yBAA2B,YAE7DvC,EAAK0B,QAAQmD,OAAO7E,EAAKwC,yBAI1BxC,EAAKyB,aAAaiD,SAAS1E,EAAKsC,eAChCvC,EAAE+E,MACDC,IAAWjB,EACXkB,SAAW,UACTC,KAAK,SAASC,GAChB,GAWCC,GACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EAjBAC,EAAqB5F,EAAEA,EAAE6F,SAASV,EAAKW,aAAaC,YACpDC,EAAqBJ,EAAMnB,KAAK,SAChCwB,EAAqBD,EAASE,OAC9BC,EAAqB,EACrBC,EAAqB,GACrBC,EAAqB,GACrBC,EAAqB,GACrBC,EAAqB,GACrBC,GAAqB,EACrBC,IA0BD,KAfIxG,EAAKkC,SAAU,IAElBlC,EAAKkC,MAAQyD,EAAMnB,KAAKxE,EAAKmB,UAAY,gBAEpCnB,EAAKkC,MAAM+D,SACfjG,EAAKmB,UAAY,GACjBnB,EAAKkC,MAAQyD,EAAMnB,KAAKxE,EAAKmB,UAAY,iBAIzCnB,EAAKkC,MADFlC,EAAKkC,MAAM+D,OACDQ,SAASzG,EAAKkC,MAAMwE,OAAQ,KAE5B,GAGJV,EAAJE,EAASA,IAAK,CAUpB,GATAb,EAAStF,EAAEgG,EAASG,IAEpBT,EAAQ1F,EAAE4G,UAAUtB,EAAOb,KAAKxE,EAAKmB,UAAY,cAAcyF,OAAO5G,EAAKqD,aAAa,SAASqD,QAEjGhB,EAAc,YAEdU,EAAWf,EAAOb,KAAKxE,EAAKmB,UAAY,QAAQuF,OAChDH,EAAcvG,EAAKiC,MAAMjC,EAAKiC,MAAMgE,OAAS,KAAOG,IAE9CD,EAASF,QAAUM,IAAgBH,IAEpCpG,EAAKiC,MAAMgE,QAAUE,EAASF,SACjCE,GAAY,UAEbE,EAAa,gBAAkBD,EAE1BpG,EAAKiC,MAAMgE,SACfI,GAAc,UAEfF,GAAY,eAAiBE,EAAa,KAEtCE,GAAa,CAOhB,GANIvG,EAAKS,OAAOmD,YACf0C,EAAmB,sBAEpBH,GAAY,gBAAkBC,EAAW,IAAME,EAAmB,IAAMF,EAAW,QACnFpG,EAAKiC,MAAM4E,KAAKT,GAEZpG,EAAKS,OAAOmD,UAAW,CAE1B,IADAuC,GAAY,yBACPhB,EAAU,EAAa,EAAVA,EAAaA,IAE9BgB,GAAY,8CAAgDhB,EAAU,KAAOnF,EAAK8B,eAAe9B,EAAKoB,MAAM+D,GAAW,SAExHgB,IAAY,SAGTnG,EAAKiC,MAAMgE,OAAS,GACvBO,EAAmBK,KAAK7G,EAAKiC,MAAMjC,EAAKiC,MAAMgE,OAAS,IAKtDjG,EAAKS,OAAOmD,YACfwB,EAAYpF,EAAK8G,UAAUrB,EAAMsB,MAAMC,MACd,gBAAd5B,KAEVA,EAAY,GAEbM,GAAe,SAAWU,EAAW,YAAca,KAAKC,MAAM9B,EAAY,IAG3Ee,GAAY,eAAiBT,EAAc,KAE3CS,GAAY,QAAUV,EAAMV,IAAM,YAAcU,EAAMV,IAAM,qBAAuB,IAAMU,EAAM0B,OAAS1B,EAAMV,IAAM,OAAS,IAAM,QAEnIO,EAAOD,EAAOb,KAAKxE,EAAKmB,UAAY,cAAcyF,OAAO5G,EAAKqD,aAAa,QAAQ+D,SAAS,OACxF9B,EAAKW,SACRV,EAAWD,EAAK,GAAG+B,UACf5B,EAAMV,MACTS,EAAgBD,EAAS+B,YAAY,iBACf,KAAlB9B,IACHA,EAAgBD,EAAS+B,YAAY,mBAEhB,KAAlB9B,IAGHA,EAAgBD,EAASgC,UAAU,EAAG/B,GAAe8B,YAAY,cAC3C,KAAlB9B,IACHD,EAAWA,EAASgC,UAAU,EAAG/B,GAAiBD,EAASgC,UAAUhC,EAASiC,QAAQ,cAIzFrB,GAAYZ,GAEbY,GAAY,SAGbA,GAAY,SAERnG,EAAKmC,UACRgE,EAAWnG,EAAK0C,iBAAmByD,GAMpCnG,EAAKU,SAASyF,GAIVnG,EAAKmC,UAERnC,EAAKmC,SAAU,EAEfnC,EAAK2B,aAAe3B,EAAKqB,MAAMmD,KAAK,gBACpCxE,EAAKqB,MAAM+B,GAAG,qBAAuBpD,EAAKW,gBAAiB,eAAgBX,EAAKyH,oBAChFzH,EAAKqB,MAAM+B,GAAG,mBAAqBpD,EAAKW,gBAAiB,WACxD,GACC+G,GAAY,GACZxB,EAAY,EACZF,EAAYhG,EAAKiC,MAAMgE,MAUxB,KAPAjG,EAAK2B,aAAe3B,EAAKqB,MAAMmD,KAAK,gBAEpCxE,EAAKqB,MAAM0B,IAAI,qBAAuB/C,EAAKW,iBAAiByC,GAAG,qBAAuBpD,EAAKW,gBAAiB,eAAgBX,EAAK2H,kBACjI3H,EAAKqB,MAAM0B,IAAI,qBAAuB/C,EAAKW,iBAAiByC,GAAG,qBAAuBpD,EAAKW,gBAAiB,kBAAmBX,EAAK4H,uBAEpI5H,EAAK6B,eAAiB7B,EAAKqB,MAAMmD,KAAK,iBAE3BwB,EAAJE,EAASA,IACc,IAAzBlG,EAAKiC,MAAMiE,GAAGD,SACjByB,GAAa,wCAA0C1H,EAAKiC,MAAMiE,GAAK,KAAOlG,EAAKiC,MAAMiE,GAAK,YAGhGlG,GAAK2B,aAAa6C,KAAK,UAAUC,OAAOiD,GACxC1H,EAAK4B,YAAc5B,EAAK2B,aAAa6C,KAAK,eAC1CxE,EAAK4B,YAAYwB,GAAG,SAAWpD,EAAKW,gBAAiB,SAASkH,GAC7DA,EAAIC,gBACJ,IAAIC,GAAchI,EAAEwD,MACnByE,EAAc,EAGfhI,GAAK4B,YAAYqG,IAAIF,GAAYG,YAAY,UAC7CH,EAAWI,YAAY,UAEnBJ,EAAWxD,SAAS,WACvByD,EAAc,IAAMzE,KAAK6E,UAMzBpI,EAAKqB,MAAMqD,SAAS,YACpB1E,EAAK6B,eAAeoG,IAAID,GAAaE,YAAY,UAAUG,UAC3DrI,EAAK6B,eAAe+E,OAAOoB,GAAatD,SAAS,UAAU4D,WAE3DtI,EAAKqB,MAAM6G,YAAY,YACvBlI,EAAK6B,eAAeyG,UAIrB1H,OAAOkC,WAAW,WACjB9C,EAAKwB,QAAQ+G,QAAQ,eAAiBvI,EAAKW,kBACzC,OAGJX,EAAKqB,MAAM0B,IAAI,mBAAqB/C,EAAKW,iBAEzCC,OAAOkC,WAAW,WACjB9C,EAAKqB,MAAM6G,YAAYlI,EAAKsC,gBAC1B,KAECtC,EAAK2B,aAAa4C,SAAS,WAC9BvE,EAAKwB,QAAQ+G,QAAQ,sBAAwBvI,EAAKW,iBAGnDC,OAAOkC,WAAW,WACjB9C,EAAKwI,oBAAoBxI,EAAKiC,QAC5B,QAGLjC,EAAKmC,SAAU,EACfnC,EAAKyB,aAAayG,YAAYlI,EAAKsC,eAGnCtC,EAAKwB,QAAQ4B,GAAG,eAAiBpD,EAAKW,gBAAiBX,EAAK4C,cAAc2F,QAAQ,eAAiBvI,EAAKW,iBAIpGX,EAAKkC,SAAU,GAASlC,EAAKS,OAAOH,MAAQN,EAAKS,OAAOJ,YAAcL,EAAKkC,MAE1ElC,EAAKS,OAAOmD,YAAc5D,EAAKoC,gBAElCpC,EAAKyI,mBAAkB,GACvBzI,EAAK0I,oBAGL1I,EAAKyI,qBAINjC,EAAmBK,KAAKT,GACxBpG,EAAKqC,eAAgB,EACrBrC,EAAKqB,MAAMkH,QAAQ,mBAAqBvI,EAAKW,kBAG1C6F,EAAmBP,QACtBjG,EAAKwI,oBAAoBhC,KAExBmC,KAAK,WAEP3I,EAAKmE,oBAIPsE,kBAAmB,SAASG,GAE3B,MAAK5I,GAAKoC,gBAAmBwG,GAO7B5I,EAAKS,OAAOH,OAASN,EAAKS,OAAOJ,YAG7BL,EAAKS,OAAOH,QAAUN,EAAKS,OAAOJ,cACrCL,EAAKS,OAAOJ,YAAc,SAItBL,EAAKoC,eAWTpC,EAAKmE,gBAVLnE,EAAK0B,QAAQ0B,GAAG,UAAYpD,EAAKW,gBAAiB,WAE7CZ,EAAE,oBAAoByD,KAAK,QAAUxD,EAAKW,kBAI9CX,EAAK0B,QAAQqB,IAAI,UAAY/C,EAAKW,iBAClCX,EAAKmE,yBArBNvD,QAAOkC,WAAW,WACjB9C,EAAKyI,mBAAkB,IACrB,MA0BLC,iBAAkB,WAEb1I,EAAKqC,eAAiBrC,EAAKoC,iBAI/BpC,EAAKoC,gBAAiB,EAEtBpC,EAAKS,OAAOJ,YAAc,GAE1BL,EAAKqB,MAAMqD,SAAS1E,EAAKsC,eAEzBtC,EAAKmE,kBAENG,WAAY,WACXtE,EAAK6I,gBAEL9I,EAAE+E,MACDC,IAAW,+BACXC,SAAW,QACX8D,QAAW,SAASC,GACnB/I,EAAKS,OAAOD,GAAKuI,EAAKvI,MAIxBR,EAAKwB,QAAQ4B,GAAG,sBAAwBpD,EAAKW,gBAAiB,WAE7DC,OAAOkC,WAAW,WACjB9C,EAAKwB,QAAQ+G,QAAQ,eAAiBvI,EAAKW,kBACzC,QAGLkI,cAAe,WAEd7I,EAAKuC,yBAA2B,mIAAqIvC,EAAKsC,cAAgB,60BAC1LtC,EAAKwC,uBAA2B,2JAChCxC,EAAK0C,iBAA2B,wHAA0H1C,EAAKwC,uBAAyB,uBAEzLiF,mBAAoB,SAASI,GAC5BA,EAAImB,kBAEJhJ,EAAKiJ,uBAEAjJ,EAAKqC,gBACLrC,EAAKoC,kBAMVpC,EAAKqB,MAAM0B,IAAI,qBAAuB/C,EAAKW,iBAC3CX,EAAKqB,MAAM+B,GAAI,qBAAuBpD,EAAKW,gBAAiB,eAAgBX,EAAK2H,kBACjF3H,EAAKqB,MAAM+B,GAAI,qBAAuBpD,EAAKW,gBAAiB,kBAAmBX,EAAK4H,yBAErFD,iBAAkB,SAASE,GAC1BA,EAAImB,kBAEJhJ,EAAKiJ,sBAELjJ,EAAKwB,QAAQ+G,QAAQ,sBAAwBvI,EAAKW,kBAEnDiH,sBAAuB,SAASC,GAC/BA,EAAImB,kBAEJhJ,EAAKkJ,yBAELlJ,EAAKwB,QAAQ+G,QAAQ,sBAAwBvI,EAAKW,kBAEnDsI,oBAAqB,SAAStH,GAE7B,MADAA,GAAeA,GAAgB3B,EAAKqB,MAAMmD,KAAK,gBAC1C7C,EAAa4C,SAAS,WAKpB,GAJN5C,EAAa+C,SAAS,UACtB/C,EAAa6C,KAAK,SAASE,SAAS,SAC7B,IAITwE,uBAAwB,SAASvH,GAChCA,EAAeA,GAAgB3B,EAAKqB,MAAMmD,KAAK,gBAC1CxE,EAAKiJ,oBAAoBtH,KAC7BA,EAAauG,YAAY,UACzBvG,EAAa6C,KAAK,SAAS0D,YAAY,UAGzCM,oBAAqB,SAASW,GAC7B,GAECC,GACAC,EACAlE,EAJGe,EAAM,EACTF,EAAMmD,EAAUlD,MAKjB,IAAKjG,EAAKS,OAAOmD,WAAcoC,EAI/B,KAAWA,EAAJE,EAASA,IACf,GAA4B,IAAxBiD,EAAUjD,GAAGD,SAGjBmD,EAAkBpJ,EAAKqB,MAAMmD,KAAK,iBAAmB2E,EAAUjD,GAAK,cACpEmD,KACAlE,EAAkB,EAEbiE,EAAUnD,QAAf,CAGA,KAAiB,EAAVd,EAAaA,IACnBkE,EAAgBlE,GAAWnF,EAAKqB,MAAMmD,KAAK,iBAAmB2E,EAAUjD,GAAK,aAAef,GACxFkE,EAAgBlE,GAASc,QAC5BmD,EAAU5E,KAAK,kBAAoBW,EAAS,MAAMT,SAAS,aAG7D1E,GAAKsJ,0BAA0BF,EAAWC,KAG5CC,0BAA2B,SAASF,EAAWC,GAC9CD,EAAU5E,KAAK,8BAA8BzB,IAAI,wBAA0B/C,EAAKW,iBAAiByC,GAAG,wBAA0BpD,EAAKW,gBAAiB,WACnJ,GAECuF,GAFGqD,EAAiBxJ,EAAEwD,MACtBiG,EAAiB,EAMlB,IAHAJ,EAAU5E,KAAK,mBAAmByD,IAAIsB,GAASrB,YAAY,UAC3DqB,EAAQpB,YAAY,UAEhBoB,EAAQhF,SAAS,UAEpB,IADAiF,EAAiB/C,SAAS8C,EAAQrE,KAAK,WAAY,IAC9CgB,EAAI,EAAO,EAAJA,EAAOA,IACdA,IAAMsD,EACTH,EAAgBnD,GAAGmC,UAEnBgB,EAAgBnD,GAAGoC,aAIrB,KAAKpC,EAAI,EAAO,EAAJA,EAAOA,IACdA,IAAMsD,GACTH,EAAgBnD,GAAGoC,QAKtBtI,GAAKwB,QAAQ+G,QAAQ,sBAAwBvI,EAAKW,qBAMrDC,OAAO6I,WAAa7I,OAAO6I,eAE3B7I,OAAO6I,WAAa1J,EAAE4D,OAAO3D,EAAMY,OAAO6I,YAGXC,SAA3B3J,EAAE4J,MAAMC,QAAQC,SACnB5J,EAAgBW,OAAOC,SAASiJ,KAAK/I,MAAM,KAC3Cd,EAAce,MACdf,EAAc4G,KAAK,wBACnB7G,EAAKyB,aAAagD,OAAO,gBAAkBxE,EAAc8J,KAAK,KAAO,iBAEpEnJ,OAAOoJ,QAAUpJ,OAAOuC,OAAO6G,QC7iBlC,WAYC,GAAIC,GAAW,4GACXC,EAAU,iIACVC,EAAW,KACXC,EAAS,KACTC,EAAW,KAEXvD,EAAY,SAASwD,GACxB,GAAIvD,IACHwD,MAAO,GAIR,KAAID,EACH,MAAOvD,EAGR,IACCyD,GACAtE,EAFGuE,IAIJH,GAASA,EAAOI,WAAWzJ,QAAQ,aAAc,IAAIA,QAAQ,MAAO,IAGpE,IAAI0J,GAAIV,EAASW,KAAKN,EACtB,IAAIK,KACAA,EAAE,KAAOA,EAAE,IAAOA,EAAE,IAAMA,EAAE,IAAe,KAARA,EAAE,IAA0B,KAARA,EAAE,MAC1DA,EAAE,IAAMA,EAAE,IAAMA,EAAE,KAASA,EAAE,KAAOA,EAAE,IAAM,CAuC9C,GAnCkB,GAAfA,EAAE,GAAG1E,QAA8B,GAAf0E,EAAE,GAAG1E,QAAuB,KAAR0E,EAAE,IAE5C5D,EAAK8D,KAAOF,EAAE,GACd5D,EAAKC,MAAQ2D,EAAE,GACf5D,EAAK+D,IAAMH,EAAE,GACb5D,EAAKwD,OAASI,EAAE,GAAK,IAAM,GAC3B5D,EAAKwD,OAASI,EAAE,GAAK,IAAM,GAC3B5D,EAAKwD,OAASI,EAAE,GAAK,IAAM,IAClBA,EAAE,KAAOA,EAAE,IAAMA,EAAE,IAC5B5D,EAAKC,MAAQ2D,EAAE,GACf5D,EAAK8D,KAAOF,EAAE,GACd5D,EAAKwD,OAASI,EAAE,GAAK,IAAM,GAC3B5D,EAAKwD,OAASI,EAAE,GAAK,IAAM,KAGX,MAAZN,GACS,MAAZA,GACY,MAAZA,GACY,MAAZA,GACAtD,EAAKC,MAAQ2D,EAAE,GACf5D,EAAK+D,IAAMH,EAAE,GACb5D,EAAKwD,OAASI,EAAE,GAAK,IAAM,GAC3B5D,EAAKwD,OAASI,EAAE,GAAK,IAAM,KAE3B5D,EAAKC,MAAQ2D,EAAE,GACf5D,EAAK+D,IAAMH,EAAE,GACb5D,EAAKwD,OAASI,EAAE,GAAK,IAAM,GAC3B5D,EAAKwD,OAASI,EAAE,GAAK,IAAM,IAE5B5D,EAAK8D,KAAOF,EAAE,GACd5D,EAAKwD,OAAS,KAGZxD,EAAK8D,OAAM9D,EAAK8D,KAAOpE,SAASM,EAAK8D,KAAM,KAC3C9D,EAAK+D,MAAK/D,EAAK+D,IAAMrE,SAASM,EAAK+D,IAAK,KACxC/D,EAAKC,QACPD,EAAKC,MAAQP,SAASM,EAAKC,MAAO,IAE/BD,EAAKC,MAAQ,IAAI,CAEnB,GAAI+D,GAAMhE,EAAK+D,GACf/D,GAAK+D,IAAM/D,EAAKC,MAChBD,EAAKC,MAAQ+D,EACbhE,EAAKwD,MAAQxD,EAAKwD,MAAMtJ,QAAQ,IAAK,KACnCA,QAAQ,IAAK,KACbA,QAAQ,IAAK,KACbA,QAAQ,IAAK,KAIjB,KAAK8F,EAAKC,OAASD,EAAKC,OAAS,OAASD,EAAK+D,KAAO/D,EAAK+D,KAAO,IAAK,CACtE,GAAG/D,EAAK8D,MAAQ9D,EAAK8D,KAAO,IAAK,CAEhC,GAAIG,GAAQ,GAAIjH,MACZ8G,EAAOG,EAAMC,cACbC,EAAeL,EAAO,IACtBM,EAAUN,EAAOK,CAIpBnE,GAAK8D,KAFH9D,EAAK8D,MAAQK,EAEHC,EAAUpE,EAAK8D,KAGfM,EAAU,IAAMpE,EAAK8D,KAIhC9D,EAAKC,OAAOD,EAAKC,QAEpByD,EAAM5D,MACH2D,KAAMG,EAAE,GAAI9F,QAAQ,IACpB2F,KAAMG,EAAE,SAIX5D,IACCwD,MAAO,IAERE,EAAM5D,MAAO2D,KAAMF,QAGpBG,GAAM5D,MAAO2D,KAAMF,GAKpB,KAAIvD,EAAK8D,KACR,IAAK3E,IAAKuE,GAET,GADAE,EAAIT,EAAQU,KAAKH,EAAMvE,GAAGsE,MACnB,CACNzD,EAAK8D,KAAOF,EAAE,GACd5D,EAAKwD,MAAQa,EAAqBrE,EAAKwD,MAAO,IAAKE,EAAMvE,IACzDuE,EAAMY,OACLnF,EAAG,GACDsE,KAAMG,EAAE,GAAI9F,QAAQ,IACpB2F,KAAMG,EAAE,IAEX,OAMH,IAAI5D,EAAKC,MAAO,CAEf,GAAIsE,IAAU,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MACvD,MAAO,MAAO,MAAO,MAAO,MAEzBnB,KACHA,EAAW,GAAIoB,QAAO,YAAYD,EAAOvB,KAAK,KAAK,qBAAsB,KAG1E,KAAK7D,IAAKuE,GAET,GADAE,EAAIR,EAASS,KAAKH,EAAMvE,GAAGsE,MACpB,CAENzD,EAAKC,MAAQsE,EAAO9D,QAAQmD,EAAE,GAAGa,eAAiB,GAClDzE,EAAKwD,MAAQa,EAAqBrE,EAAKwD,MAAO,IAAKE,EAAMvE,IACzDuE,EAAMY,OACLnF,EAAG,GACDsE,KAAMG,EAAE,GAAI9F,OAAQ,MACpB2F,KAAMG,EAAE,GAAIc,MAAO,KAEtB,QAMH,IAAI1E,EAAK+D,IAAK,CAEb,IAAIV,EAAQ,CACX,GAAIsB,GAAc,EAClBtB,GAAS,GAAImB,QAAO,qBAAqBG,EAAY,YAAa,KAGnE,IAAKxF,IAAKuE,GAET,GADAE,EAAIP,EAAOQ,KAAKH,EAAMvE,GAAGsE,MAClB,CACN,GAAIM,GAAMrE,SAASkE,EAAE,GAAI,GAEzB,IAAW,IAAPG,EAAW,CACd/D,EAAK+D,IAAMA,EACX/D,EAAKwD,MAAQa,EAAqBrE,EAAKwD,MAAO,IAAKE,EAAMvE,IACtDyE,EAAEgB,MAAQ,GACZnB,EAAOC,EAAMvE,GAAGsE,KAAKpG,OAAO,EAAGuG,EAAEgB,OAC9BhB,EAAE,KACJH,GAAQ,IAAMG,EAAE,KAGjBH,EAAOG,EAAE,GAEVF,EAAMY,OACLnF,EAAG,GACDsE,KAAMA,GAET,SAOJzD,EAAKyD,KAAO,EACZ,KAAKtE,IAAKuE,GACT1D,EAAKyD,MAAQC,EAAMvE,GAAGsE,KAAO,GAe9B,OAXGzD,GAAKyD,OACPzD,EAAKyD,KAAOzD,EAAKyD,KAAKvJ,QAAQ,iCAAkC,MAGhD,KAAd8F,EAAKyD,MAA6Bd,SAAd3C,EAAKyD,aACpBzD,GAAKyD,MAIVzD,EAAK8D,MAAsB,IAAd9D,EAAK8D,QAAY9D,EAAK8D,MAAQ,IAEvC9D,GAGJqE,EAAuB,SAASQ,EAAWpB,EAAMqB,GACpD,IAAKD,EACJ,MAAOpB,EAER,IAAIqB,EAAUhH,UAAW,EACxB,MAAO2F,GAAOoB,CAEf,IAAIC,EAAUJ,SAAU,EACvB,MAAOG,GAAYpB,CAEpB,IAAIsB,EACJ,OAAID,GAAUhH,QACbiH,EAAMF,EAAUpE,QAAQqE,EAAUhH,QACvB,IAAPiH,EACIF,EAEDA,EAAU3K,QAAQ,GAAIsK,QAAO,IAAMM,EAAUhH,OAAS,KAAM2F,EAAO,OAEvEqB,EAAUJ,OACbK,EAAMF,EAAUpE,QAAQqE,EAAUJ,OACvB,IAAPK,EACIF,EAAYpB,EAEboB,EAAU3K,QAAQ,GAAIsK,QAAO,IAAMM,EAAUJ,MAAQ,KAAM,KAAOjB,IAEnEoB,EAAYpB,EAGpB5J,QAAO6I,WAAa7I,OAAO6I,eAC3B7I,OAAO6I,WAAW3C,UAAYA","sourcesContent":["(function($) {\n\tvar zapi, js_plugin_src;\n\n\tzapi = {\n\t\tdefaults        : {\n\t\t\tcollection     : '',\n\t\t\tuser           : '1562960',\n\t\t\t// Number of entries to fetch\n\t\t\tnum_entries    : 20,\n\t\t\tstart          : 0,\n\t\t\tzotero_options : 'format=atom&content=json,bib&style=apa&order=date&sort=desc',\n\t\t\tip             : false\n\t\t},\n\t\tparams          : {},\n\t\tcallback        : {},\n\t\tcollection_name : window.location.pathname.split('/').pop().replace('archive-', '').replace('monitoring-', '').replace('.html', ''),\n\t\tfeed_base       : 'https://api.zotero.org/users/',\n\t\tnamespace       : 'zapi\\\\:',\n\t\tlang            : 'en',\n\t\t// Element cache (careful with using string selectors with this jQuery; it will search the parent DOM)\n\t\t$body           : $(document.body),\n\t\t$window         : $(window),\n\t\t$parent_body    : $('body'),\n\t\t$footer         : $('.c-back-to-top'),\n\t\t$year_filter    : $(),\n\t\t$year_links     : $(),\n\t\t$year_sections  : $(),\n\t\t// Labels for quarter-year filters\n\t\tquarter_labels  : {\n\t\t\t'en': [\n\t\t\t\t'Jan - Mar',\n\t\t\t\t'April - June',\n\t\t\t\t'July - Sept',\n\t\t\t\t'Oct - Dec'\n\t\t\t],\n\t\t\t'fr': [\n\t\t\t\t'Jan - Mars',\n\t\t\t\t'Avril - Juin',\n\t\t\t\t'Juil - Sept',\n\t\t\t\t'Oct - Dec'\n\t\t\t]\n\t\t},\n\t\t// An array of years of the references (for archive page)\n\t\tyears                    : [],\n\t\t// Total number of references\n\t\ttotal                    : false,\n\t\t// Flag if is initial load\n\t\tis_init                  : true,\n\t\t// Flag for loading all references immediately\n\t\tis_all_loading           : false,\n\t\t// Flag for keeping track if all references have been loaded\n\t\tis_all_loaded            : false,\n\t\t// Class to add to body when loading references\n\t\tloading_class            : 'loading-references',\n\t\t// HTML and CSS snippets\n\t\tloading_indicator_styles : '',\n\t\tloading_indicator_html   : '',\n\t\tmonitoring_css           : '.year-filter{width:24%;min-width:145px;float:right;margin:0 0 .5em .25em}.year-filter .item{position:relative;max-height:50px;overflow:hidden;cursor:pointer}.year-filter.active .item{max-height:450px;overflow-y:auto;cursor:default}body.loading-references .year-filter.active .item{max-height:110px;overflow:hidden}.year-filter .spinner{position:static;margin:1em auto}.year-filter h3{position:relative;cursor:pointer}.year-filter h6 a{display:block;padding:.2em 1em}.quarter-filter.is-enabled:hover,.year-filter h6 a:hover{background:#f0f0f0;cursor:pointer}.quarter-filter.active,.quarter-filter.active:hover,.year-filter h6 a.active,.year-filter h6 a.active:hover{background:#ddd}.quarters{float:left;margin-left:9px;margin-top:20px;line-height:42px}#boot .year-section h2{margin-top:20px}#boot .year-section.first h2,#boot.filtered .year-section h2{margin-top:0}#boot .year-section h6{margin-top:1em}.filtered .year-section .quarters,.year-section.first .quarters{margin-top:0}.quarter-filter{border:1px solid #e5e5e5;font-weight:700;font-size:13px;padding:.25em .35em;margin:0 .25em;-ms-filter:\"alpha(Opacity=50)\";filter:alpha(opacity=50);opacity:.5}.quarter-filter.is-enabled{-ms-filter:\"alpha(Opacity=100)\";filter:alpha(opacity=100);opacity:1}h2.quarterly{float:left}.ref-entry{clear:left}#boot .year-filter h6 a:hover{text-decoration:none}#boot .year-filter.active .item:hover{background-color:transparent}',\n\t\tyear_filter_html         : '',\n\t\t// Set the correct height of the tab iframe\n\t\ttab_height_timeout       : '',\n\t\tfixTabHeight : function() {\n\t\t\twindow.clearTimeout(zapi.tab_height_timeout);\n\t\t\tzapi.tab_height_timeout = window.setTimeout(function() {\n\t\t\t\t// Remove this event listener, adjust height, add back the listener\n\t\t\t\tzapi.$window.off('resize.tabs.' + zapi.collection_name);\n\t\t\t\t// Set height with extra 50px\n\t\t\t\twindow.frameElement.height = zapi.tab_height = zapi.$body.parent().height() + 50;\n\t\t\t\t// Add back the listener\n\t\t\t\twindow.setTimeout(function() {\n\t\t\t\t\tzapi.$window.on('resize.tabs.' + zapi.collection_name, zapi.fixTabHeight);\n\t\t\t\t}, 200);\n\t\t\t}, 200);\n\t\t},\n\t\tfilterByType : function(type) {\n\t\t\treturn function() {\n\t\t\t\treturn $(this).attr('zapi:type') === type;\n\t\t\t};\n\t\t},\n\t\tbuildParams  : function(options) {\n\t\t\tzapi.params = $.extend({}, zapi.defaults, options);\n\t\t\tif (zapi.params.quarterly) {\n\t\t\t\tzapi.params.num_entries = 99;\n\t\t\t}\n\t\t},\n\t\tgetFeedUrl   : function() {\n\t\t\tvar feed_url = zapi.feed_base;\n\t\t\t\n\t\t\t// Build the zotero api url\n\t\t\tfeed_url += zapi.params.user + '/collections/' + zapi.params.collection + '/items?' + zapi.params.zotero_options + '&start=' + zapi.params.start + '&limit=' + zapi.params.num_entries;\n\t\t\t\n\t\t\t// Add a 24 hour cache busting date string\n\t\t\tfeed_url += '&cb=' + new Date().toDateString();\n\t\t\t\n\t\t\tif (zapi.params.q) {\n\t\t\t\tfeed_url += '&q=' + zapi.params.q + '&qmode=titleCreatorYear';\n\t\t\t}\n\t\t\t// Build the google feed api url and return it\n\t\t\treturn 'https://ajax.googleapis.com/ajax/services/feed/load?v=1.0&output=xml&num=' + zapi.params.num_entries + (zapi.params.ip ? '&userip=' + zapi.params.ip : '') + '&q=' + encodeURIComponent(feed_url);\n\t\t},\n\t\tgetReferences: function(options, callback) {\n\t\t\t// If we have options (like on first load), use them\n\t\t\tif (options) {\n\t\t\t\t// Build our params, then get the feed url\n\t\t\t\tzapi.buildParams(options);\n\t\t\t\tif (callback) {\n\t\t\t\t\tzapi.callback = callback;\n\t\t\t\t}\n\t\t\t\t// Special logic for language\n\t\t\t\tif (parent.window.location.pathname.substr(1).split('/').shift() === 'fr') {\n\t\t\t\t\tzapi.lang = 'fr';\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (zapi.is_init) {\n\t\t\t\tzapi.initialize();\n\t\t\t}\n\t\t\t// If all references are already loaded, return\n\t\t\tif (zapi.is_all_loaded) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// Get the google feed api url\n\t\t\tvar feed_url = zapi.getFeedUrl();\n\t\t\t\n\t\t\t// Check if the iframe has our styles yet\n\t\t\tif (!zapi.$body.hasClass('ready')) {\n\t\t\t\t$(document).find('head').append('<style>' + zapi.monitoring_css + '\\n' + zapi.loading_indicator_styles + '</style>');\n\t\t\t\tzapi.$body.addClass('ready');\n\t\t\t}\n\n\t\t\t// If the spinner markup is not yet in the parent.window DOM, set it up and add styles\n\t\t\tif (zapi.$footer.prev()[0].className !== 'spinner') {\n\t\t\t\t// First, our styles\n\t\t\t\t$('head').append('<style>' + zapi.loading_indicator_styles + '</style>');\n\t\t\t\t// And our markup\n\t\t\t\tzapi.$footer.before(zapi.loading_indicator_html);\n\t\t\t}\n\t\t\t\n\t\t\t// Add loading references class\n\t\t\tzapi.$parent_body.addClass(zapi.loading_class);\n\t\t\t$.ajax({\n\t\t\t\turl      : feed_url,\n\t\t\t\tdataType : 'jsonp'\n\t\t\t}).done(function(data) {\n\t\t\t\tvar // Structure of resp: data.responseData.feed.entries[]\n\t\t\t\t\t$feed              = $($.parseXML(data.responseData.xmlString)),\n\t\t\t\t\t$entries           = $feed.find('entry'),\n\t\t\t\t\tlen                = $entries.length,\n\t\t\t\t\ti                  = 0,\n\t\t\t\t\tref_html           = '',\n\t\t\t\t\tthe_year           = '',\n\t\t\t\t\tyear_class         = '',\n\t\t\t\t\tyear_title_class   = '',\n\t\t\t\t\tis_new_year        = false,\n\t\t\t\t\tyears_for_quarters = [],\n\t\t\t\t\tqtr_idx,\n\t\t\t\t\tthe_month,\n\t\t\t\t\t$entry,\n\t\t\t\t\t$bib,\n\t\t\t\t\tbib_html,\n\t\t\t\t\tbib_url_start,\n\t\t\t\t\tentry,\n\t\t\t\t\tentry_class;\n\n\t\t\t\t// Check if we have set the total results yet\n\t\t\t\tif (zapi.total === false) {\n\t\t\t\t\t// First time through, try to fetch totalResults node using the namespace ('zapi\\\\:')\n\t\t\t\t\tzapi.total = $feed.find(zapi.namespace + 'totalResults');\n\t\t\t\t\t// If that failed, try it without the namespace (set the namespace as an empty string)\n\t\t\t\t\tif (!zapi.total.length) {\n\t\t\t\t\t\tzapi.namespace = '';\n\t\t\t\t\t\tzapi.total = $feed.find(zapi.namespace + 'totalResults');\n\t\t\t\t\t}\n\t\t\t\t\t// If we found it, set it. Otherwise, keep zapi.total as false\n\t\t\t\t\tif (zapi.total.length) {\n\t\t\t\t\t\tzapi.total = parseInt(zapi.total.text(), 10);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tzapi.total = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (; i < len; i++) {\n\t\t\t\t\t$entry = $($entries[i]);\n\t\t\t\t\t// If this selector doesn't work, we need to use a filter function and check attr('zapi:type')\n\t\t\t\t\tentry = $.parseJSON($entry.find(zapi.namespace + 'subcontent').filter(zapi.filterByType('json')).text());\n\t\t\t\t\t\n\t\t\t\t\tentry_class = 'ref-entry';\n\t\t\t\t\t\n\t\t\t\t\tthe_year = $entry.find(zapi.namespace + 'year').text();\n\t\t\t\t\tis_new_year = zapi.years[zapi.years.length - 1] !== the_year;\n\t\t\t\t\t// Is it a new year section or the first of this group of references\n\t\t\t\t\tif ((!ref_html.length || is_new_year) && the_year) {\n\t\t\t\t\t\t// If this is not the first year header and not the first of this group of references, close the previous year div\n\t\t\t\t\t\tif (zapi.years.length && ref_html.length) {\n\t\t\t\t\t\t\tref_html += '</div>';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tyear_class = 'year-section ' + the_year;\n\t\t\t\t\t\t// If this is the very first year, add .first class\n\t\t\t\t\t\tif (!zapi.years.length) {\n\t\t\t\t\t\t\tyear_class += ' first';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tref_html += '<div class=\"' + year_class + '\">';\n\t\t\t\t\t\t// If first of this year, add heading and push year onto years array\n\t\t\t\t\t\tif (is_new_year) {\n\t\t\t\t\t\t\tif (zapi.params.quarterly) {\n\t\t\t\t\t\t\t\tyear_title_class = ' class=\"quarterly\"';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tref_html += '<h2 id=\"year-' + the_year + '\"' + year_title_class + '>' + the_year + '</h2>';\n\t\t\t\t\t\t\tzapi.years.push(the_year);\n\t\t\t\t\t\t\t// If is quarterly, add quarters\n\t\t\t\t\t\t\tif (zapi.params.quarterly) {\n\t\t\t\t\t\t\t\tref_html += '<div class=\"quarters\">';\n\t\t\t\t\t\t\t\tfor (qtr_idx = 0; qtr_idx < 4; qtr_idx++) {\n\n\t\t\t\t\t\t\t\t\tref_html += '<span class=\"quarter-filter\" data-quarter=\"' + qtr_idx + '\">' + zapi.quarter_labels[zapi.lang][qtr_idx] + '</span>';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tref_html += '</div>';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// If there is a previous year, process it for quarterly\n\t\t\t\t\t\t\tif (zapi.years.length > 1) {\n\t\t\t\t\t\t\t\tyears_for_quarters.push(zapi.years[zapi.years.length - 2]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// Quarterly logic requires the date also\n\t\t\t\t\tif (zapi.params.quarterly) {\n\t\t\t\t\t\tthe_month = zapi.strToDate(entry.date).month;\n\t\t\t\t\t\tif (typeof the_month !== 'number') {\n\t\t\t\t\t\t\t// If strToDate() failed to parse the date string, default to first month\n\t\t\t\t\t\t\tthe_month = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tentry_class += ' year-' + the_year + ' quarter-' + Math.floor(the_month / 3);\n\t\t\t\t\t}\n\t\t\t\t\t// Entry wrap\n\t\t\t\t\tref_html += '<div class=\"' + entry_class + '\">';\n\t\t\t\t\t// Title\n\t\t\t\t\tref_html += '<h6>' + (entry.url ? '<a href=\"' + entry.url + '\" target=\"_blank\">' : '') + entry.title + (entry.url ? '</a>' : '') + '</h6>';\n\n\t\t\t\t\t$bib = $entry.find(zapi.namespace + 'subcontent').filter(zapi.filterByType('bib')).children('div');\n\t\t\t\t\tif ($bib.length) {\n\t\t\t\t\t\tbib_html = $bib[0].outerHTML;\n\t\t\t\t\t\tif (entry.url) {\n\t\t\t\t\t\t\tbib_url_start = bib_html.lastIndexOf(' from http://');\n\t\t\t\t\t\t\tif (bib_url_start === -1) {\n\t\t\t\t\t\t\t\tbib_url_start = bib_html.lastIndexOf(' from https://');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (bib_url_start !== -1) {\n\t\t\t\t\t\t\t\t// The \"from [url]\" text always has ' Retrieved' before it, so go find that text\n\t\t\t\t\t\t\t\t// bib_url_start -= 10;\n\t\t\t\t\t\t\t\tbib_url_start = bib_html.substring(0, bib_url_start).lastIndexOf(' Retrieved');\n\t\t\t\t\t\t\t\tif (bib_url_start !== -1) {\n\t\t\t\t\t\t\t\t\tbib_html = bib_html.substring(0, bib_url_start) + bib_html.substring(bib_html.indexOf('</div>'));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tref_html += bib_html;\n\t\t\t\t\t}\n\t\t\t\t\tref_html += '</div>';\n\t\t\t\t}\n\t\t\t\t// Close div.year-section\n\t\t\t\tref_html += '</div>';\n\t\t\t\t// First time through, add in year filter html\n\t\t\t\tif (zapi.is_init) {\n\t\t\t\t\tref_html = zapi.year_filter_html + ref_html;\n\t\t\t\t}\n\n\t\t\t\t// Finished building HTML\n\t\t\t\t// Pass it to callback\n\t\t\t\t// ----------------------\n\t\t\t\tzapi.callback(ref_html);\n\t\t\t\t// ----------------------\n\n\t\t\t\t// Initial run through, set up JS and styles for year filter\n\t\t\t\tif (zapi.is_init) {\n\t\t\t\t\t// Set this flag now to false to avoid conflicts with calling getReferences again\n\t\t\t\t\tzapi.is_init = false;\n\t\t\t\t\t// Attach filter by year click handler\n\t\t\t\t\tzapi.$year_filter = zapi.$body.find('.year-filter');\n\t\t\t\t\tzapi.$body.on('click.year-filter.' + zapi.collection_name, '.year-filter', zapi.loadYearFilterList);\n\t\t\t\t\tzapi.$body.on('references-load.' + zapi.collection_name, function() {\n\t\t\t\t\t\tvar // Prepare for year calculations\n\t\t\t\t\t\t\tyear_list = '',\n\t\t\t\t\t\t\ti         = 0,\n\t\t\t\t\t\t\tlen       = zapi.years.length;\n\n\t\t\t\t\t\t// Reset $year_filter object from DOM\n\t\t\t\t\t\tzapi.$year_filter = zapi.$body.find('.year-filter');\n\t\t\t\t\t\t// Remove all click handlers, then add back simple toggle handler\n\t\t\t\t\t\tzapi.$body.off('click.year-filter.' + zapi.collection_name).on('click.year-filter.' + zapi.collection_name, '.year-filter', zapi.yearFilterToggle);\n\t\t\t\t\t\tzapi.$body.off('click.year-filter.' + zapi.collection_name).on('click.year-filter.' + zapi.collection_name, '.year-filter h3', zapi.yearFilterTitleToggle);\n\t\t\t\t\t\t// Set up year section element cache\n\t\t\t\t\t\tzapi.$year_sections = zapi.$body.find('.year-section');\n\t\t\t\t\t\t// Build years list\n\t\t\t\t\t\tfor (; i < len; i++) {\n\t\t\t\t\t\t\tif (zapi.years[i].length === 4) {\n\t\t\t\t\t\t\t\tyear_list += '<h6><a class=\"year-link\" href=\"#year-' + zapi.years[i] + '\">' + zapi.years[i] + '</a></h6>';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tzapi.$year_filter.find('.group').append(year_list);\n\t\t\t\t\t\tzapi.$year_links = zapi.$year_filter.find('a.year-link');\n\t\t\t\t\t\tzapi.$year_links.on('click.' + zapi.collection_name, function(evt) {\n\t\t\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\t\t\tvar $year_link  = $(this),\n\t\t\t\t\t\t\t\tactive_year = '';\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// No other year links should be active\n\t\t\t\t\t\t\tzapi.$year_links.not($year_link).removeClass('active');\n\t\t\t\t\t\t\t$year_link.toggleClass('active');\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif ($year_link.hasClass('active')) {\n\t\t\t\t\t\t\t\tactive_year = '.' + this.innerHTML;\n\t\t\t\t\t\t\t\t/*zapi.$year_links.filter('.active').each(function() {\n\t\t\t\t\t\t\t\t\tactive_year += (active_year.length ? ', ' : '') + '.' + this.innerHTML;\n\t\t\t\t\t\t\t\t});*/\n\n\t\t\t\t\t\t\t\t// Add filtered class\n\t\t\t\t\t\t\t\tzapi.$body.addClass('filtered');\n\t\t\t\t\t\t\t\tzapi.$year_sections.not(active_year).removeClass('active').fadeOut();\n\t\t\t\t\t\t\t\tzapi.$year_sections.filter(active_year).addClass('active').fadeIn();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tzapi.$body.removeClass('filtered');\n\t\t\t\t\t\t\t\tzapi.$year_sections.fadeIn();\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Recalculate iframe height after 0.3 seconds\n\t\t\t\t\t\t\twindow.setTimeout(function() {\n\t\t\t\t\t\t\t\tzapi.$window.trigger('resize.tabs.' + zapi.collection_name);\n\t\t\t\t\t\t\t}, 300);\n\t\t\t\t\t\t});\n\t\t\t\t\t\t// Remove this handler\n\t\t\t\t\t\tzapi.$body.off('references-load.' + zapi.collection_name);\n\t\t\t\t\t\t// After letting year links settle, remove loading class (to enable smooth dropdown effect)\n\t\t\t\t\t\twindow.setTimeout(function() {\n\t\t\t\t\t\t\tzapi.$body.removeClass(zapi.loading_class);\n\t\t\t\t\t\t}, 200);\n\t\t\t\t\t\t// If .year-filter is currently active, height has changed, so trigger our event\n\t\t\t\t\t\tif (zapi.$year_filter.hasClass('active')) {\n\t\t\t\t\t\t\tzapi.$window.trigger('change-height.tabs.' + zapi.collection_name);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Reload all quarter filters (to avoid bug with first couple year's quarter filter click handlers no longer being triggered after all references finish loading)\n\t\t\t\t\t\twindow.setTimeout(function() {\n\t\t\t\t\t\t\tzapi.setupQuarterFilters(zapi.years);\n\t\t\t\t\t\t}, 200);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tzapi.is_init = false;\n\t\t\t\tzapi.$parent_body.removeClass(zapi.loading_class);\n\t\t\t\t// When this tab is selected, a resize is triggered; use that opportunity to fix the iframe height\n\t\t\t\t// And then trigger the logic once right away for the default tab\n\t\t\t\tzapi.$window.on('resize.tabs.' + zapi.collection_name, zapi.fixTabHeight).trigger('resize.tabs.' + zapi.collection_name);\n\t\t\t\t\n\t\t\t\t// If we have not yet loaded all the references, set up fetching of the next set of references\n\t\t\t\t// First check to make sure we have a valid total (if not, try to fetch the next set)\n\t\t\t\tif (zapi.total === false || zapi.params.start + zapi.params.num_entries < zapi.total) {\n\t\t\t\t\t// Special logic for quarterly collections (in which case load all references)\n\t\t\t\t\tif (zapi.params.quarterly && !zapi.is_all_loading) {\n\t\t\t\t\t\t// Trigger immediate set up of next references (don't need infinite loading functionality)\n\t\t\t\t\t\tzapi.getNextReferences(true);\n\t\t\t\t\t\tzapi.getAllReferences();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Set up next references set\n\t\t\t\t\t\tzapi.getNextReferences();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// We have finished, so we can process the last year's quarter filters\n\t\t\t\t\tyears_for_quarters.push(the_year);\n\t\t\t\t\tzapi.is_all_loaded = true;\n\t\t\t\t\tzapi.$body.trigger('references-load.' + zapi.collection_name);\n\t\t\t\t}\n\t\t\t\t// Quarter filter setup\n\t\t\t\tif (years_for_quarters.length) {\n\t\t\t\t\tzapi.setupQuarterFilters(years_for_quarters);\n\t\t\t\t}\n\t\t\t}).fail(function() {\n\t\t\t\t// Let's try again\n\t\t\t\tzapi.getReferences();\n\t\t\t});\n\t\t},\n\t\t// Set up infinite scroll-style fetching of next set of references (or trigger it right away if is_all_loading)\n\t\tgetNextReferences: function(timedout) {\n\t\t\t// If not is_all_loading and this is not the timeout, set up timeout and return\n\t\t\tif (!zapi.is_all_loading && !timedout) {\n\t\t\t\t// Make sure resize.tabs has had a chance to do its magic by attaching inview event after 500 ms\n\t\t\t\twindow.setTimeout(function() {\n\t\t\t\t\tzapi.getNextReferences(true);\n\t\t\t\t}, 500);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tzapi.params.start += zapi.params.num_entries;\n\t\t\t\n\t\t\t// If this is the first time calling getNextReferences, adjust num_entries to max\n\t\t\tif (zapi.params.start === zapi.params.num_entries) {\n\t\t\t\tzapi.params.num_entries = 99;\n\t\t\t}\n\t\t\t\n\t\t\t// If not is_all_loading, add a handler to the parent window to load the next set of results\n\t\t\tif (!zapi.is_all_loading) {\n\t\t\t\tzapi.$footer.on('inview.' + zapi.collection_name, function() {\n\t\t\t\t\t// Is the current active tab this one?\n\t\t\t\t\tif ($('.tab-pane.active').attr('id') !== zapi.collection_name) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t// It is the current tab, so remove this handler and get the next set of references\n\t\t\t\t\tzapi.$footer.off('inview.' + zapi.collection_name);\n\t\t\t\t\tzapi.getReferences();\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tzapi.getReferences();\n\t\t\t}\n\t\t},\n\t\t// Get all the rest of the references\n\t\tgetAllReferences: function() {\n\t\t\t// If already loaded or loading all references, return\n\t\t\tif (zapi.is_all_loaded || zapi.is_all_loading) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// Load 'em up\n\t\t\tzapi.is_all_loading = true;\n\t\t\t// Load max number of entries at a time\n\t\t\tzapi.params.num_entries = 99;\n\t\t\t// Set loading class\n\t\t\tzapi.$body.addClass(zapi.loading_class);\n\t\t\t// Kick off reference retrieval\n\t\t\tzapi.getReferences();\n\t\t},\n\t\tinitialize: function() {\n\t\t\tzapi.prepareMarkup();\n\t\t\t// Get current ip address for google API calls\n\t\t\t$.ajax({\n\t\t\t\turl      : 'http://www.telize.com/jsonip',\n\t\t\t\tdataType : 'jsonp',\n\t\t\t\tsuccess  : function(resp) {\n\t\t\t\t\tzapi.params.ip = resp.ip;\n\t\t\t\t}\n\t\t\t});\n\t\t\t// Add custom height change event handler to body\n\t\t\tzapi.$window.on('change-height.tabs.' + zapi.collection_name, function() {\n\t\t\t\t// Trigger resize tabs event after 0.5 seconds\n\t\t\t\twindow.setTimeout(function() {\n\t\t\t\t\tzapi.$window.trigger('resize.tabs.' + zapi.collection_name);\n\t\t\t\t}, 500);\n\t\t\t});\n\t\t},\n\t\tprepareMarkup: function() {\n\t\t\t// HTML and CSS snippets\n\t\t\tzapi.loading_indicator_styles = '.spinner { display: none; position: absolute; left: 45%; width: 50px; height: 30px; text-align: center; font-size: 10px; } body.' + zapi.loading_class + ' .spinner { display: block; } .spinner > div { background-color: #333; height: 100%; width: 6px; margin: 0 1px; display: inline-block;  -webkit-animation: stretchdelay 1.2s infinite ease-in-out; animation: stretchdelay 1.2s infinite ease-in-out; } .spinner .rect2 { -webkit-animation-delay: -1.1s; animation-delay: -1.1s; } .spinner .rect3 { -webkit-animation-delay: -1.0s; animation-delay: -1.0s; } .spinner .rect4 { -webkit-animation-delay: -0.9s; animation-delay: -0.9s; } .spinner .rect5 { -webkit-animation-delay: -0.8s; animation-delay: -0.8s; } @-webkit-keyframes stretchdelay { 0%, 40%, 100% { -webkit-transform: scaleY(0.4) } 20% { -webkit-transform: scaleY(1.0) } } @keyframes stretchdelay { 0%, 40%, 100% { transform: scaleY(0.4); -webkit-transform: scaleY(0.4); } 20% {  transform: scaleY(1.0); -webkit-transform: scaleY(1.0); } }';\n\t\t\tzapi.loading_indicator_html   = '<div class=\"spinner\"><div class=\"rect1\"></div><div class=\"rect2\"></div><div class=\"rect3\"></div><div class=\"rect4\"></div><div class=\"rect5\"></div></div>';\n\t\t\tzapi.year_filter_html         = '<nav class=\"year-filter c-accordion\"><div class=\"item\"><span class=\"group\"><h3>Archive <div class=\"arrow\"></div></h3>' + zapi.loading_indicator_html + '</span></div></nav>';\n\t\t},\n\t\tloadYearFilterList: function(evt) {\n\t\t\tevt.stopPropagation();\n\t\t\t// Add .active/.open\n\t\t\tzapi.yearFilterAddActive();\n\t\t\t\n\t\t\tif (!zapi.is_all_loaded) {\n\t\t\t\tif (zapi.is_all_loading) {\n\t\t\t\t\t// Already working on it\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Don't run this function again\n\t\t\tzapi.$body.off('click.year-filter.' + zapi.collection_name);\n\t\t\tzapi.$body.on( 'click.year-filter.' + zapi.collection_name, '.year-filter', zapi.yearFilterToggle);\n\t\t\tzapi.$body.on( 'click.year-filter.' + zapi.collection_name, '.year-filter h3', zapi.yearFilterTitleToggle);\n\t\t},\n\t\tyearFilterToggle: function(evt) {\n\t\t\tevt.stopPropagation();\n\t\t\t// Add .active/.open\n\t\t\tzapi.yearFilterAddActive();\n\t\t\t// Trigger change height\n\t\t\tzapi.$window.trigger('change-height.tabs.' + zapi.collection_name);\n\t\t},\n\t\tyearFilterTitleToggle: function(evt) {\n\t\t\tevt.stopPropagation();\n\t\t\t// Toggle .active/.open\n\t\t\tzapi.yearFilterToggleActive();\n\t\t\t// Trigger change height\n\t\t\tzapi.$window.trigger('change-height.tabs.' + zapi.collection_name);\n\t\t},\n\t\tyearFilterAddActive: function($year_filter) {\n\t\t\t$year_filter = $year_filter || zapi.$body.find('.year-filter');\n\t\t\tif (!$year_filter.hasClass('active')) {\n\t\t\t\t$year_filter.addClass('active');\n\t\t\t\t$year_filter.find('.item').addClass('open');\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\tyearFilterToggleActive: function($year_filter) {\n\t\t\t$year_filter = $year_filter || zapi.$body.find('.year-filter');\n\t\t\tif (!zapi.yearFilterAddActive($year_filter)) {\n\t\t\t\t$year_filter.removeClass('active');\n\t\t\t\t$year_filter.find('.item').removeClass('open');\n\t\t\t}\n\t\t},\n\t\tsetupQuarterFilters: function(the_years) {\n\t\t\tvar i   = 0,\n\t\t\t\tlen = the_years.length,\n\t\t\t\t$quarters,\n\t\t\t\trefs_by_quarter,\n\t\t\t\tqtr_idx;\n\n\t\t\tif (!zapi.params.quarterly || !len) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// Set up quarter filters, if applicable\n\t\t\tfor (; i < len; i++) {\n\t\t\t\tif (the_years[i].length !== 4) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\t$quarters       = zapi.$body.find('.year-section.' + the_years[i] + ' .quarters');\n\t\t\t\trefs_by_quarter = [];\n\t\t\t\tqtr_idx         = 0;\n\n\t\t\t\tif (!$quarters.length) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tfor (; qtr_idx < 4; qtr_idx++) {\n\t\t\t\t\trefs_by_quarter[qtr_idx] = zapi.$body.find('.year-section.' + the_years[i] + ' .quarter-' + qtr_idx);\n\t\t\t\t\tif (refs_by_quarter[qtr_idx].length) {\n\t\t\t\t\t\t$quarters.find('[data-quarter=\"' + qtr_idx +'\"]').addClass('is-enabled');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tzapi.attachQuarterFilterToggle($quarters, refs_by_quarter);\n\t\t\t}\n\t\t},\n\t\tattachQuarterFilterToggle: function($quarters, refs_by_quarter) {\n\t\t\t$quarters.find('.quarter-filter.is-enabled').off('click.quarter-filter.' + zapi.collection_name).on('click.quarter-filter.' + zapi.collection_name, function() {\n\t\t\t\tvar $filter        = $(this),\n\t\t\t\t\tactive_quarter = '',\n\t\t\t\t\ti;\n\t\t\t\t// No other quarter links should be active\n\t\t\t\t$quarters.find('.quarter-filter').not($filter).removeClass('active');\n\t\t\t\t$filter.toggleClass('active');\n\t\t\t\t\n\t\t\t\tif ($filter.hasClass('active')) {\n\t\t\t\t\tactive_quarter = parseInt($filter.data('quarter'), 10);\n\t\t\t\t\tfor (i = 0; i < 4; i++) {\n\t\t\t\t\t\tif (i !== active_quarter) {\n\t\t\t\t\t\t\trefs_by_quarter[i].fadeOut();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trefs_by_quarter[i].fadeIn();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tfor (i = 0; i < 4; i++) {\n\t\t\t\t\t\tif (i !== active_quarter) {\n\t\t\t\t\t\t\trefs_by_quarter[i].fadeIn();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Trigger change height\n\t\t\t\tzapi.$window.trigger('change-height.tabs.' + zapi.collection_name);\n\t\t\t});\n\t\t}\n\t};\n\n\t// Export our Zotero API handler (it may already be defined, in which case merge it into our local zapi)\n\twindow.zotero_api = window.zotero_api || {};\n\t// $.extend() merges 2nd object into first, modifying it, and returns the modified object\n\twindow.zotero_api = $.extend(zapi, window.zotero_api);\n\t\n\t// Attach jquery.inview to parent if not yet attached\n\tif ($.event.special.inview === undefined) {\n\t\tjs_plugin_src = window.location.href.split('/');\n\t\tjs_plugin_src.pop();\n\t\tjs_plugin_src.push('jquery.inview.min.js');\n\t\tzapi.$parent_body.append('<script src=\"' + js_plugin_src.join('/') + '\"><\\/script>');\n\t}\n})(window.jQuery || window.parent.jQuery);\n","/**\n * Zotero date string parsing utility function\n * \n * Adapted to work standalone\n * \n * From https://github.com/zotero/zotero/blob/4.0/chrome/content/zotero/xpcom/date.js\n */\n\n/*jshint quotmark: false, eqeqeq: false */\n\n(function() {\n\n\t/*\n\t * converts a string to an object containing:\n\t *    day: integer form of the day\n\t *    month: integer form of the month (indexed from 0, not 1)\n\t *    year: 4 digit year (or, year + BC/AD/etc.)\n\t *    part: anything that does not fall under any of the above categories\n\t *          (e.g., \"Summer,\" etc.)\n\t *\n\t * Note: the returned object is *not* a JS Date object\n\t */\n\tvar _slashRe = /^(.*?)\\b([0-9]{1,4})(?:([\\-\\/\\.\\u5e74])([0-9]{1,2}))?(?:([\\-\\/\\.\\u6708])([0-9]{1,4}))?((?:\\b|[^0-9]).*?)$/;\n\tvar _yearRe = /^(.*?)\\b((?:circa |around |about |c\\.? ?)?[0-9]{1,4}(?: ?B\\.? ?C\\.?(?: ?E\\.?)?| ?C\\.? ?E\\.?| ?A\\.? ?D\\.?)|[0-9]{3,4})\\b(.*?)$/i;\n\tvar _monthRe = null;\n\tvar _dayRe = null;\n\tvar _country = 'CA';\n\t\n\tvar strToDate = function(string) {\n\t\tvar date = {\n\t\t\torder: ''\n\t\t};\n\t\t\n\t\t// skip empty things\n\t\tif(!string) {\n\t\t\treturn date;\n\t\t}\n\t\t\n\t\tvar parts = [],\n\t\t\tpart,\n\t\t\ti;\n\t\t\n\t\tstring = string.toString().replace(/^\\s+|\\s+$/g, \"\").replace(/\\s+/, \" \");\n\t\t\n\t\t// first, directly inspect the string\n\t\tvar m = _slashRe.exec(string);\n\t\tif (m &&\n\t\t\t((!m[5] || !m[3]) || m[3] == m[5] || (m[3] == \"\\u5e74\" && m[5] == \"\\u6708\")) &&\t// require sane separators\n\t\t\t((m[2] && m[4] && m[6]) || (!m[1] && !m[7]))) {\n\t\t\t// require that either all parts are found,\n\t\t\t// or else this is the entire date field\n\t\t\t// figure out date based on parts\n\t\t\tif(m[2].length == 3 || m[2].length == 4 || m[3] == \"\\u5e74\") {\n\t\t\t\t// ISO 8601 style date (big endian)\n\t\t\t\tdate.year = m[2];\n\t\t\t\tdate.month = m[4];\n\t\t\t\tdate.day = m[6];\n\t\t\t\tdate.order += m[2] ? 'y' : '';\n\t\t\t\tdate.order += m[4] ? 'm' : '';\n\t\t\t\tdate.order += m[6] ? 'd' : '';\n\t\t\t} else if(m[2] && !m[4] && m[6]) {\n\t\t\t\tdate.month = m[2];\n\t\t\t\tdate.year = m[6];\n\t\t\t\tdate.order += m[2] ? 'm' : '';\n\t\t\t\tdate.order += m[6] ? 'y' : '';\n\t\t\t} else {\n\t\t\t\t// local style date (middle or little endian)\n\t\t\t\tif (_country == \"US\" ||\t// The United States\n\t\t\t\t\t_country == \"FM\" ||\t// The Federated States of Micronesia\n\t\t\t\t\t_country == \"PW\" ||\t// Palau\n\t\t\t\t\t_country == \"PH\") {\t// The Philippines\n\t\t\t\t\tdate.month = m[2];\n\t\t\t\t\tdate.day = m[4];\n\t\t\t\t\tdate.order += m[2] ? 'm' : '';\n\t\t\t\t\tdate.order += m[4] ? 'd' : '';\n\t\t\t\t} else {\n\t\t\t\t\tdate.month = m[4];\n\t\t\t\t\tdate.day = m[2];\n\t\t\t\t\tdate.order += m[2] ? 'd' : '';\n\t\t\t\t\tdate.order += m[4] ? 'm' : '';\n\t\t\t\t}\n\t\t\t\tdate.year = m[6];\n\t\t\t\tdate.order += 'y';\n\t\t\t}\n\t\t\t\n\t\t\tif(date.year) date.year = parseInt(date.year, 10);\n\t\t\tif(date.day) date.day = parseInt(date.day, 10);\n\t\t\tif(date.month) {\n\t\t\t\tdate.month = parseInt(date.month, 10);\n\t\t\t\t\n\t\t\t\tif(date.month > 12) {\n\t\t\t\t\t// swap day and month\n\t\t\t\t\tvar tmp = date.day;\n\t\t\t\t\tdate.day = date.month;\n\t\t\t\t\tdate.month = tmp;\n\t\t\t\t\tdate.order = date.order.replace('m', 'D')\n\t\t\t\t\t\t.replace('d', 'M')\n\t\t\t\t\t\t.replace('D', 'd')\n\t\t\t\t\t\t.replace('M', 'm');\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif((!date.month || date.month <= 12) && (!date.day || date.day <= 31)) {\n\t\t\t\tif(date.year && date.year < 100) {\t// for two digit years, determine proper\n\t\t\t\t\t\t\t\t\t\t\t\t\t// four digit year\n\t\t\t\t\tvar today = new Date();\n\t\t\t\t\tvar year = today.getFullYear();\n\t\t\t\t\tvar twoDigitYear = year % 100;\n\t\t\t\t\tvar century = year - twoDigitYear;\n\t\t\t\t\t\n\t\t\t\t\tif(date.year <= twoDigitYear) {\n\t\t\t\t\t\t// assume this date is from our century\n\t\t\t\t\t\tdate.year = century + date.year;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// assume this date is from the previous century\n\t\t\t\t\t\tdate.year = century - 100 + date.year;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif(date.month) date.month--;\t\t// subtract one for JS style\n\t\t\t\t\n\t\t\t\tparts.push(\n\t\t\t\t\t{ part: m[1], before: true },\n\t\t\t\t\t{ part: m[7] }\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\t// give up; we failed the sanity check\n\t\t\t\tdate = {\n\t\t\t\t\torder: ''\n\t\t\t\t};\n\t\t\t\tparts.push({ part: string });\n\t\t\t}\n\t\t} else {\n\t\t\tparts.push({ part: string });\n\t\t}\n\t\t\n\t\t// couldn't find something with the algorithms; use regexp\n\t\t// YEAR\n\t\tif(!date.year) {\n\t\t\tfor (i in parts) {\n\t\t\t\tm = _yearRe.exec(parts[i].part);\n\t\t\t\tif (m) {\n\t\t\t\t\tdate.year = m[2];\n\t\t\t\t\tdate.order = _insertDateOrderPart(date.order, 'y', parts[i]);\n\t\t\t\t\tparts.splice(\n\t\t\t\t\t\ti, 1,\n\t\t\t\t\t\t{ part: m[1], before: true },\n\t\t\t\t\t\t{ part: m[3] }\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\t// MONTH\n\t\tif(!date.month) {\n\t\t\t// compile month regular expression\n\t\t\tvar months = ['jan', 'feb', 'mar', 'apr', 'may', 'jun', 'jul',\n\t\t\t\t'aug', 'sep', 'oct', 'nov', 'dec'];\n\t\t\t\n\t\t\tif(!_monthRe) {\n\t\t\t\t_monthRe = new RegExp(\"^(.*)\\\\b(\"+months.join(\"|\")+\")[^ ]*(?: (.*)$|$)\", \"i\");\n\t\t\t}\n\t\t\t\n\t\t\tfor (i in parts) {\n\t\t\t\tm = _monthRe.exec(parts[i].part);\n\t\t\t\tif (m) {\n\t\t\t\t\t// Modulo 12 in case we have multiple languages\n\t\t\t\t\tdate.month = months.indexOf(m[2].toLowerCase()) % 12;\n\t\t\t\t\tdate.order = _insertDateOrderPart(date.order, 'm', parts[i]);\n\t\t\t\t\tparts.splice(\n\t\t\t\t\t\ti, 1,\n\t\t\t\t\t\t{ part: m[1], before: \"m\" },\n\t\t\t\t\t\t{ part: m[3], after: \"m\" }\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\t// DAY\n\t\tif(!date.day) {\n\t\t\t// compile day regular expression\n\t\t\tif(!_dayRe) {\n\t\t\t\tvar daySuffixes = \"\";\n\t\t\t\t_dayRe = new RegExp(\"\\\\b([0-9]{1,2})(?:\"+daySuffixes+\")?\\\\b(.*)\", \"i\");\n\t\t\t}\n\t\t\t\n\t\t\tfor (i in parts) {\n\t\t\t\tm = _dayRe.exec(parts[i].part);\n\t\t\t\tif (m) {\n\t\t\t\t\tvar day = parseInt(m[1], 10);\n\t\t\t\t\t// Sanity check\n\t\t\t\t\tif (day <= 31) {\n\t\t\t\t\t\tdate.day = day;\n\t\t\t\t\t\tdate.order = _insertDateOrderPart(date.order, 'd', parts[i]);\n\t\t\t\t\t\tif(m.index > 0) {\n\t\t\t\t\t\t\tpart = parts[i].part.substr(0, m.index);\n\t\t\t\t\t\t\tif(m[2]) {\n\t\t\t\t\t\t\t\tpart += \" \" + m[2];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpart = m[2];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tparts.splice(\n\t\t\t\t\t\t\ti, 1,\n\t\t\t\t\t\t\t{ part: part }\n\t\t\t\t\t\t);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\t// Concatenate date parts\n\t\tdate.part = '';\n\t\tfor (i in parts) {\n\t\t\tdate.part += parts[i].part + ' ';\n\t\t}\n\t\t\n\t\t// clean up date part\n\t\tif(date.part) {\n\t\t\tdate.part = date.part.replace(/^[^A-Za-z0-9]+|[^A-Za-z0-9]+$/g, \"\");\n\t\t}\n\t\t\n\t\tif(date.part === \"\" || date.part === undefined) {\n\t\t\tdelete date.part;\n\t\t}\n\t\t\n\t\t//make sure year is always a string\n\t\tif(date.year || date.year === 0) date.year += '';\n\t\t\n\t\treturn date;\n\t};\n\t// Internal helper function\n\tvar _insertDateOrderPart = function(dateOrder, part, partOrder) {\n\t\tif (!dateOrder) {\n\t\t\treturn part;\n\t\t}\n\t\tif (partOrder.before === true) {\n\t\t\treturn part + dateOrder;\n\t\t}\n\t\tif (partOrder.after === true) {\n\t\t\treturn dateOrder + part;\n\t\t}\n\t\tvar pos;\n\t\tif (partOrder.before) {\n\t\t\tpos = dateOrder.indexOf(partOrder.before);\n\t\t\tif (pos == -1) {\n\t\t\t\treturn dateOrder;\n\t\t\t}\n\t\t\treturn dateOrder.replace(new RegExp(\"(\" + partOrder.before + \")\"), part + '$1');\n\t\t}\n\t\tif (partOrder.after) {\n\t\t\tpos = dateOrder.indexOf(partOrder.after);\n\t\t\tif (pos == -1) {\n\t\t\t\treturn dateOrder + part;\n\t\t\t}\n\t\t\treturn dateOrder.replace(new RegExp(\"(\" + partOrder.after + \")\"), '$1' + part);\n\t\t}\n\t\treturn dateOrder + part;\n\t};\n\t// Export strToDate as part of zotero_api object\n\twindow.zotero_api = window.zotero_api || {};\n\twindow.zotero_api.strToDate = strToDate;\n\n})();\n"]}