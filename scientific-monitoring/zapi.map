{"version":3,"file":"zapi.js","sources":["../bower_components/fuse.js/src/fuse.js","zapi-compiled.js"],"names":["global","Fuse","list","options","this","i","len","key","keys","length","defaultOptions","BitapSearcher","pattern","location","distance","threshold","maxPatternLength","caseSensitive","toLowerCase","patternLen","Error","matchmask","patternAlphabet","_calculatePatternAlphabet","prototype","mask","charAt","_bitapScore","errors","accuracy","proximity","Math","abs","search","text","isMatch","score","j","binMin","binMid","start","finish","bitArr","lastBitArr","charMatch","textLen","LOCATION","THRESHOLD","bestLoc","indexOf","binMax","locations","min","lastIndexOf","floor","max","Array","push","deepValueHelper","obj","path","firstSegment","remaining","dotIndex","slice","value","Utils","isArray","deepValue","Object","toString","call","id","includeScore","shouldSort","searchFn","sortFn","a","b","getFn","item","bitapResult","existingResult","searcher","dataLen","searchKeys","searchKeysLen","rawResults","resultMap","results","analyzeText","entity","index","undefined","sort","getItem","replaceValue","exports","module","define","amd","$","zapi","js_plugin_src","defaults","collection","user","num_entries","zotero_options","ip","params","callback","collection_name","window","pathname","split","pop","replace","feed_base","namespace","lang","$body","document","body","$window","$parent_body","$footer","$year_filter","$year_links","$year_sections","quarter_labels","en","fr","years","is_init","is_all_loading","is_all_loaded","loading_class","loading_indicator_styles","loading_indicator_html","monitoring_css","year_filter_html","tab_height_timeout","fixTabHeight","clearTimeout","setTimeout","off","frameElement","height","tab_height","parent","on","filterByType","type","attr","buildParams","extend","getFeedUrl","feed_url","Date","toDateString","q","encodeURIComponent","getReferences","substr","shift","initialize","hasClass","find","append","addClass","prev","className","before","ajax","url","dataType","done","data","qtr_idx","the_month","$entry","$bib","bib_html","bib_url_start","entry","entry_class","$feed","parseXML","responseData","xmlString","$entries","ref_html","the_date","the_year","year_class","year_title_class","is_new_year","years_for_quarters","parseJSON","filter","quarterly","title","children","outerHTML","substring","loadYearFilterList","year_list","yearFilterToggle","yearFilterTitleToggle","evt","preventDefault","$year_link","active_year","not","removeClass","toggleClass","innerHTML","fadeOut","fadeIn","trigger","setupQuarterFilters","getNextReferences","getAllReferences","fail","timedout","prepareMarkup","success","resp","stopPropagation","yearFilterAddActive","yearFilterToggleActive","the_years","$quarters","refs_by_quarter","attachQuarterFilterToggle","$filter","active_quarter","parseInt","zotero_api","event","special","inview","href","join","jQuery"],"mappings":"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","sourcesContent":["/**\n * @license\n * Fuse - Lightweight fuzzy-search\n *\n * Copyright (c) 2012 Kirollos Risk <kirollos@gmail.com>.\n * All Rights Reserved. Apache Software License 2.0\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n(function(global) {\n\n  /**\n   * Adapted from \"Diff, Match and Patch\", by Google\n   *\n   *   http://code.google.com/p/google-diff-match-patch/\n   *\n   * Modified by: Kirollos Risk <kirollos@gmail.com>\n   * -----------------------------------------------\n   * Details: the algorithm and structure was modified to allow the creation of\n   * <Searcher> instances with a <search> method which does the actual\n   * bitap search. The <pattern> (the string that is searched for) is only defined\n   * once per instance and thus it eliminates redundant re-creation when searching\n   * over a list of strings.\n   *\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   */\n  var BitapSearcher = function(pattern, options) {\n    options = options || {};\n    this.options = options;\n    this.options.location = options.location || BitapSearcher.defaultOptions.location;\n    this.options.distance = 'distance' in options ? options.distance : BitapSearcher.defaultOptions.distance;\n    this.options.threshold = 'threshold' in options ? options.threshold : BitapSearcher.defaultOptions.threshold;\n    this.options.maxPatternLength = options.maxPatternLength || BitapSearcher.defaultOptions.maxPatternLength;\n\n    this.pattern = options.caseSensitive ? pattern : pattern.toLowerCase();\n    this.patternLen = pattern.length;\n\n    if (this.patternLen > this.options.maxPatternLength) {\n      throw new Error('Pattern length is too long');\n    }\n\n    this.matchmask = 1 << (this.patternLen - 1);\n    this.patternAlphabet = this._calculatePatternAlphabet();\n  };\n\n  BitapSearcher.defaultOptions = {\n    // Approximately where in the text is the pattern expected to be found?\n    location: 0,\n\n    // Determines how close the match must be to the fuzzy location (specified above).\n    // An exact letter match which is 'distance' characters away from the fuzzy location\n    // would score as a complete mismatch. A distance of '0' requires the match be at\n    // the exact location specified, a threshold of '1000' would require a perfect match\n    // to be within 800 characters of the fuzzy location to be found using a 0.8 threshold.\n    distance: 100,\n\n    // At what point does the match algorithm give up. A threshold of '0.0' requires a perfect match\n    // (of both letters and location), a threshold of '1.0' would match anything.\n    threshold: 0.6,\n\n    // Machine word size\n    maxPatternLength: 32\n  };\n\n  /**\n   * Initialize the alphabet for the Bitap algorithm.\n   * @return {Object} Hash of character locations.\n   * @private\n   */\n  BitapSearcher.prototype._calculatePatternAlphabet = function() {\n    var mask = {},\n      i = 0;\n\n    for (i = 0; i < this.patternLen; i++) {\n      mask[this.pattern.charAt(i)] = 0;\n    }\n\n    for (i = 0; i < this.patternLen; i++) {\n      mask[this.pattern.charAt(i)] |= 1 << (this.pattern.length - i - 1);\n    }\n\n    return mask;\n  };\n\n  /**\n   * Compute and return the score for a match with `e` errors and `x` location.\n   * @param {number} errors Number of errors in match.\n   * @param {number} location Location of match.\n   * @return {number} Overall score for match (0.0 = good, 1.0 = bad).\n   * @private\n   */\n  BitapSearcher.prototype._bitapScore = function(errors, location) {\n    var accuracy = errors / this.patternLen,\n      proximity = Math.abs(this.options.location - location);\n\n    if (!this.options.distance) {\n      // Dodge divide by zero error.\n      return proximity ? 1.0 : accuracy;\n    }\n    return accuracy + (proximity / this.options.distance);\n  };\n\n  /**\n   * Compute and return the result of the search\n   * @param {String} text The text to search in\n   * @return {Object} Literal containing:\n   *                          {Boolean} isMatch Whether the text is a match or not\n   *                          {Decimal} score Overall score for the match\n   * @public\n   */\n  BitapSearcher.prototype.search = function(text) {\n    text = this.options.caseSensitive ? text : text.toLowerCase();\n\n    if (this.pattern === text) {\n      // Exact match\n      return {\n        isMatch: true,\n        score: 0\n      };\n    }\n\n    var i, j,\n      // Set starting location at beginning text and initialize the alphabet.\n      textLen = text.length,\n      LOCATION = this.options.location,\n      // Highest score beyond which we give up.\n      THRESHOLD = this.options.threshold,\n      // Is there a nearby exact match? (speedup)\n      bestLoc = text.indexOf(this.pattern, LOCATION),\n      binMin, binMid,\n      binMax = this.patternLen + textLen,\n      start, finish,\n      bitArr, lastBitArr,\n      charMatch,\n      score = 1,\n      locations = [];\n\n    if (bestLoc != -1) {\n      THRESHOLD = Math.min(this._bitapScore(0, bestLoc), THRESHOLD);\n      // What about in the other direction? (speedup)\n      bestLoc = text.lastIndexOf(this.pattern, LOCATION + this.patternLen);\n\n      if (bestLoc != -1) {\n        THRESHOLD = Math.min(this._bitapScore(0, bestLoc), THRESHOLD);\n      }\n    }\n\n    bestLoc = -1;\n\n    for (i = 0; i < this.patternLen; i++) {\n      // Scan for the best match; each iteration allows for one more error.\n      // Run a binary search to determine how far from 'MATCH_LOCATION' we can stray at this\n      // error level.\n      binMin = 0;\n      binMid = binMax;\n      while (binMin < binMid) {\n        if (this._bitapScore(i, LOCATION + binMid) <= THRESHOLD) {\n          binMin = binMid;\n        } else {\n          binMax = binMid;\n        }\n        binMid = Math.floor((binMax - binMin) / 2 + binMin);\n      }\n\n      // Use the result from this iteration as the maximum for the next.\n      binMax = binMid;\n      start = Math.max(1, LOCATION - binMid + 1);\n      finish = Math.min(LOCATION + binMid, textLen) + this.patternLen;\n\n      // Initialize the bit array\n      bitArr = Array(finish + 2);\n\n      bitArr[finish + 1] = (1 << i) - 1;\n\n      for (j = finish; j >= start; j--) {\n        // The alphabet <patternAlphabet> is a sparse hash, so the following line generates warnings.\n        charMatch = this.patternAlphabet[text.charAt(j - 1)];\n\n        if (i === 0) {\n          // First pass: exact match.\n          bitArr[j] = ((bitArr[j + 1] << 1) | 1) & charMatch;\n        } else {\n          // Subsequent passes: fuzzy match.\n          bitArr[j] = ((bitArr[j + 1] << 1) | 1) & charMatch | (((lastBitArr[j + 1] | lastBitArr[j]) << 1) | 1) | lastBitArr[j + 1];\n        }\n        if (bitArr[j] & this.matchmask) {\n          score = this._bitapScore(i, j - 1);\n          // This match will almost certainly be better than any existing match.\n          // But check anyway.\n          if (score <= THRESHOLD) {\n            // Told you so.\n            THRESHOLD = score;\n            bestLoc = j - 1;\n            locations.push(bestLoc);\n\n            if (bestLoc > LOCATION) {\n              // When passing loc, don't exceed our current distance from loc.\n              start = Math.max(1, 2 * LOCATION - bestLoc);\n            } else {\n              // Already passed loc, downhill from here on in.\n              break;\n            }\n          }\n        }\n      }\n\n      // No hope for a (better) match at greater error levels.\n      if (this._bitapScore(i + 1, LOCATION) > THRESHOLD) {\n        break;\n      }\n      lastBitArr = bitArr;\n    }\n\n    return {\n      isMatch: bestLoc >= 0,\n      score: score\n    };\n  };\n\n  var deepValueHelper = function(obj, path, list) {\n    var firstSegment, remaining, dotIndex;\n\n    if (!path) {\n      // If there's no path left, we've gotten to the object we care about.\n      list.push(obj);\n    } else {\n      dotIndex = path.indexOf('.');\n      if (dotIndex !== -1) {\n        firstSegment = path.slice(0, dotIndex);\n        remaining = path.slice(dotIndex + 1);\n      } else {\n        firstSegment = path;\n      }\n\n      var value = obj[firstSegment];\n      if (value) {\n        if (!remaining && typeof value === 'string') {\n          list.push(value);\n        } else if (Utils.isArray(value)) {\n          // Search each item in the array.\n          for (var i = 0, len = value.length; i < len; i++) {\n            deepValueHelper(value[i], remaining, list);\n          }\n        } else if (remaining) {\n          // An object. Recurse further.\n          deepValueHelper(value, remaining, list);\n        }\n      }\n    }\n\n    return list;\n  };\n\n  var Utils = {\n    /**\n     * Traverse an object\n     * @param {Object} obj The object to traverse\n     * @param {String} path A . separated path to a key in the object. Example 'Data.Object.Somevalue'\n     * @return {Object}\n     */\n    deepValue: function(obj, path) {\n      return deepValueHelper(obj, path, []);\n    },\n    isArray: function(obj) {\n      return Object.prototype.toString.call(obj) === '[object Array]';\n    }\n  };\n\n  /**\n   * @param {Array} list\n   * @param {Object} options\n   * @public\n   */\n  function Fuse(list, options) {\n    this.list = list;\n    this.options = options = options || {};\n\n    var i, len, key, keys;\n    // Add boolean type options\n    for (i = 0, keys = ['sort', 'includeScore', 'shouldSort'], len = keys.length; i < len; i++) {\n      key = keys[i];\n      this.options[key] = key in options ? options[key] : Fuse.defaultOptions[key];\n    }\n    // Add all other options\n    for (i = 0, keys = ['searchFn', 'sortFn', 'keys', 'getFn'], len = keys.length; i < len; i++) {\n      key = keys[i];\n      this.options[key] = options[key] || Fuse.defaultOptions[key];\n    }\n  };\n\n  Fuse.defaultOptions = {\n    id: null,\n\n    caseSensitive: false,\n\n    // Whether the score should be included in the result set.\n    // When <true>, each result in the list will be of the form: `{ item: ..., score: ... }`\n    includeScore: false,\n\n    // Whether to sort the result list, by score\n    shouldSort: true,\n\n    // The search function to use\n    // Note that the default search function ([[Function]]) must conform to the following API:\n    //\n    //  @param pattern The pattern string to search\n    //  @param options The search option\n    //  [[Function]].constructor = function(pattern, options)\n    //\n    //  @param text: the string to search in for the pattern\n    //  @return Object in the form of:\n    //    - isMatch: boolean\n    //    - score: Int\n    //  [[Function]].prototype.search = function(text)\n    searchFn: BitapSearcher,\n\n    // Default sort function\n    sortFn: function(a, b) {\n      return a.score - b.score;\n    },\n\n    // Default get function\n    getFn: Utils.deepValue,\n\n    keys: []\n  };\n\n  /**\n   * Searches for all the items whose keys (fuzzy) match the pattern.\n   * @param {String} pattern The pattern string to fuzzy search on.\n   * @return {Array} A list of all serch matches.\n   * @public\n   */\n  Fuse.prototype.search = function(pattern) {\n    var searcher = new(this.options.searchFn)(pattern, this.options),\n      j, item,\n      list = this.list,\n      dataLen = list.length,\n      options = this.options,\n      searchKeys = this.options.keys,\n      searchKeysLen = searchKeys.length,\n      bitapResult,\n      rawResults = [],\n      resultMap = {},\n      existingResult,\n      results = [];\n\n    /**\n     * Calls <Searcher::search> for bitap analysis. Builds the raw result list.\n     * @param {String} text The pattern string to fuzzy search on.\n     * @param {String|Number} entity If the <data> is an Array, then entity will be an index,\n     *                            otherwise it's the item object.\n     * @param {Number} index\n     * @private\n     */\n    var analyzeText = function(text, entity, index) {\n      // Check if the text can be searched\n      if (text === undefined || text === null) {\n        return;\n      }\n\n      if (typeof text === 'string') {\n\n        // Get the result\n        bitapResult = searcher.search(text);\n\n        // If a match is found, add the item to <rawResults>, including its score\n        if (bitapResult.isMatch) {\n\n          // Check if the item already exists in our results\n          existingResult = resultMap[index];\n          if (existingResult) {\n            // Use the lowest score\n            existingResult.score = Math.min(existingResult.score, bitapResult.score);\n          } else {\n            // Add it to the raw result list\n            resultMap[index] = {\n              item: entity,\n              score: bitapResult.score\n            };\n            rawResults.push(resultMap[index]);\n          }\n        }\n      } else if (Utils.isArray(text)) {\n        for (var i = 0; i < text.length; i++) {\n          analyzeText(text[i], entity, index);\n        }\n      }\n    };\n\n    // Check the first item in the list, if it's a string, then we assume\n    // that every item in the list is also a string, and thus it's a flattened array.\n    if (typeof list[0] === 'string') {\n      // Iterate over every item\n      for (var i = 0; i < dataLen; i++) {\n        analyzeText(list[i], i, i);\n      }\n    } else {\n      // Otherwise, the first item is an Object (hopefully), and thus the searching\n      // is done on the values of the keys of each item.\n\n      // Iterate over every item\n      for (var i = 0; i < dataLen; i++) {\n        item = list[i];\n        // Iterate over every key\n        for (j = 0; j < searchKeysLen; j++) {\n          analyzeText(options.getFn(item, searchKeys[j]), item, i);\n        }\n      }\n    }\n\n    if (options.shouldSort) {\n      rawResults.sort(options.sortFn);\n    }\n\n    // Helper function, here for speed-up, which returns the\n    // the raw item, including the score, or simply the item itself, depending\n    // on the specified option\n    var getItem = options.includeScore ? function(i) {\n      return rawResults[i];\n    } : function(i) {\n      return rawResults[i].item;\n    };\n\n    // Helper function, here for speed-up, which replaces the item with its value,\n    // if the options specifies it,\n    var replaceValue = options.id ? function(i) {\n      rawResults[i].item = options.getFn(rawResults[i].item, options.id);\n    } : function(i) {\n      return; // no-op\n    };\n\n    // From the results, push into a new array only the item identifier (if specified)\n    // of the entire item.  This is because we don't want to return the <rawResults>,\n    // since it contains other metadata;\n    for (var i = 0, len = rawResults.length; i < len; i++) {\n      // replace the item with its value, which can be its id if the options specifies it\n      replaceValue(i);\n      results.push(getItem(i));\n    }\n\n    return results;\n  };\n\n  // Export to Common JS Loader\n  if (typeof exports === 'object') {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like environments that support module.exports,\n    // like Node.\n    module.exports = Fuse;\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module.\n    define(function() {\n      return Fuse;\n    });\n  } else {\n    // Browser globals (root is window)\n    global.Fuse = Fuse;\n  }\n\n})(this);","(function($) {\n\tvar zapi, js_plugin_src;\n\n\tzapi = {\n\t\tdefaults        : {\n\t\t\tcollection     : '',\n\t\t\tuser           : '1562960',\n\t\t\t// Number of entries to fetch\n\t\t\tnum_entries    : 99,\n\t\t\tstart          : 0,\n\t\t\tzotero_options : 'format=atom&content=json,bib&style=apa&order=date&sort=desc',\n\t\t\tip             : false\n\t\t},\n\t\tparams          : {},\n\t\tcallback        : {},\n\t\tcollection_name : window.location.pathname.split('/').pop().replace('archive-', '').replace('monitoring-', '').replace('.html', ''),\n\t\tfeed_base       : 'https://api.zotero.org/users/',\n\t\tnamespace       : 'zapi\\\\:',\n\t\tlang            : 'en',\n\t\t// Element cache (careful with using string selectors with this jQuery; it will search the parent DOM)\n\t\t$body           : $(document.body),\n\t\t$window         : $(window),\n\t\t$parent_body    : $('body'),\n\t\t$footer         : $('.c-back-to-top'),\n\t\t$year_filter    : $(),\n\t\t$year_links     : $(),\n\t\t$year_sections  : $(),\n\t\t// Labels for quarter-year filters\n\t\tquarter_labels  : {\n\t\t\t'en': [\n\t\t\t\t'Jan - Mar',\n\t\t\t\t'April - June',\n\t\t\t\t'July - Sept',\n\t\t\t\t'Oct - Dec'\n\t\t\t],\n\t\t\t'fr': [\n\t\t\t\t'Jan - Mars',\n\t\t\t\t'Avril - Juin',\n\t\t\t\t'Juil - Sept',\n\t\t\t\t'Oct - Dec'\n\t\t\t]\n\t\t},\n\t\t// An array of years of the references (for archive page)\n\t\tyears                    : [],\n\t\t// Flag if is initial load\n\t\tis_init                  : true,\n\t\t// Flag for loading all references immediately\n\t\tis_all_loading           : false,\n\t\t// Flag for keeping track if all references have been loaded\n\t\tis_all_loaded            : false,\n\t\t// Class to add to body when loading references\n\t\tloading_class            : 'loading-references',\n\t\t// HTML and CSS snippets\n\t\tloading_indicator_styles : '',\n\t\tloading_indicator_html   : '',\n\t\tmonitoring_css           : '.year-filter{width:24%;min-width:145px;float:right;margin:0 0 .5em .25em;border:1px solid #e5e5e5}.year-filter .item{position:relative;max-height:40px;padding:.5em .75em;overflow:hidden;cursor:pointer;-webkit-transition:max-height .35s;transition:max-height .35s}.year-filter.active .item{max-height:450px;overflow-y:auto;cursor:default}body.loading-references .year-filter.active .item{max-height:110px;overflow:hidden}.year-filter .spinner{position:static;margin:1em auto}.c-accordion .arrow{position:absolute;top:0;right:1px;width:20px;height:20px;background:url(\\'data:image/svg+xml;utf8,<svg version=\"1.1\" id=\"Capa_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" width=\"216px\" height=\"146px\" viewBox=\"0 0 216 146\" enable-background=\"new 0 0 216 146\" xml:space=\"preserve\"><path d=\"M168.452,42.121l-6.109-6.111c-2.118-2.009-4.59-3.014-7.413-3.014c-2.88,0-5.324,1.005-7.334,3.014L108,75.607 L68.404,36.011c-2.01-2.009-4.454-3.014-7.333-3.014c-2.824,0-5.296,1.005-7.414,3.014l-6.029,6.111 c-2.064,2.063-3.096,4.535-3.096,7.414c0,2.933,1.033,5.377,3.096,7.332l53.039,53.039c1.956,2.064,4.399,3.096,7.333,3.096 c2.879,0,5.35-1.032,7.413-3.096l53.039-53.039c2.01-2.01,3.016-4.454,3.016-7.332C171.468,46.711,170.462,44.24,168.452,42.121z\"/></svg>\\') no-repeat center center;background-size:26px;-webkit-transition:all .3s;transition:all .3s}.c-accordion .open .arrow{-webkit-transform:rotate(180deg);-ms-transform:rotate(180deg);transform:rotate(180deg)}.year-filter h3{position:relative;cursor:pointer}.year-filter h6 a{display:block;padding:.2em 1em}.quarter-filter.is-enabled:hover,.year-filter h6 a:hover{background:#f0f0f0;cursor:pointer}.quarter-filter.active,.quarter-filter.active:hover,.year-filter h6 a.active,.year-filter h6 a.active:hover{background:#ddd}.quarters{float:left;margin-left:9px;margin-top:20px;line-height:42px}#boot .year-section h2{margin-top:20px}#boot .year-section.first h2,#boot.filtered .year-section h2{margin-top:0}#boot .year-section h6{margin-top:1em}.filtered .year-section .quarters,.year-section.first .quarters{margin-top:0}.quarter-filter{border:1px solid #e5e5e5;font-weight:700;font-size:13px;padding:.25em .35em;margin:0 .25em;opacity:.5}.quarter-filter.is-enabled{opacity:1}h2.quarterly{float:left}.ref-entry{clear:left}#boot .year-filter h6 a:hover{text-decoration:none}#boot .year-filter.active .item:hover{background-color:transparent}',\n\t\tyear_filter_html         : '',\n\t\t// Set the correct height of the tab iframe\n\t\ttab_height_timeout       : '',\n\t\tfixTabHeight : function() {\n\t\t\twindow.clearTimeout(zapi.tab_height_timeout);\n\t\t\tzapi.tab_height_timeout = window.setTimeout(function() {\n\t\t\t\t// Remove this event listener, adjust height, add back the listener\n\t\t\t\tzapi.$window.off('resize.tabs.' + zapi.collection_name);\n\t\t\t\t// Set height with extra 50px\n\t\t\t\twindow.frameElement.height = zapi.tab_height = zapi.$body.parent().height() + 50;\n\t\t\t\t// Add back the listener\n\t\t\t\twindow.setTimeout(function() {\n\t\t\t\t\tzapi.$window.on('resize.tabs.' + zapi.collection_name, zapi.fixTabHeight);\n\t\t\t\t}, 200);\n\t\t\t}, 200);\n\t\t},\n\t\tfilterByType : function(type) {\n\t\t\treturn function() {\n\t\t\t\treturn $(this).attr('zapi:type') === type;\n\t\t\t};\n\t\t},\n\t\tbuildParams  : function(options) {\n\t\t\tzapi.params = $.extend({}, zapi.defaults, options);\n\t\t},\n\t\tgetFeedUrl   : function() {\n\t\t\tvar feed_url = zapi.feed_base;\n\n\t\t\t// Build the zotero api url\n\t\t\tfeed_url += zapi.params.user + '/collections/' + zapi.params.collection + '/items?' + zapi.params.zotero_options + '&start=' + zapi.params.start + '&limit=' + zapi.params.num_entries;\n\n\t\t\t// Add a 24 hour cache busting date string\n\t\t\tfeed_url += '&cb=' + new Date().toDateString();\n\n\t\t\tif (zapi.params.q) {\n\t\t\t\tfeed_url += '&q=' + zapi.params.q + '&qmode=titleCreatorYear';\n\t\t\t}\n\t\t\t// Build the google feed api url and return it\n\t\t\treturn 'https://ajax.googleapis.com/ajax/services/feed/load?v=1.0&output=xml&num=' + zapi.params.num_entries + (zapi.params.ip ? '&userip=' + zapi.params.ip : '') + '&q=' + encodeURIComponent(feed_url);\n\t\t},\n\t\tgetReferences: function(options, callback) {\n\t\t\t// If we have options (like on first load), use them\n\t\t\tif (options) {\n\t\t\t\t// Build our params, then get the feed url\n\t\t\t\tzapi.buildParams(options);\n\t\t\t\tif (callback) {\n\t\t\t\t\tzapi.callback = callback;\n\t\t\t\t}\n\t\t\t\t// Special logic for language\n\t\t\t\tif (parent.window.location.pathname.substr(1).split('/').shift() === 'fr') {\n\t\t\t\t\tzapi.lang = 'fr';\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (zapi.is_init) {\n\t\t\t\tzapi.initialize();\n\t\t\t}\n\t\t\t// If all references are already loaded, return\n\t\t\tif (zapi.is_all_loaded) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// Get the google feed api url\n\t\t\tvar feed_url = zapi.getFeedUrl();\n\n\t\t\t// Check if the iframe has our styles yet\n\t\t\tif (!zapi.$body.hasClass('ready')) {\n\t\t\t\t$(document).find('head').append('<style>' + zapi.monitoring_css + '\\n' + zapi.loading_indicator_styles + '</style>');\n\t\t\t\tzapi.$body.addClass('ready');\n\t\t\t}\n\n\t\t\t// If the spinner markup is not yet in the parent.window DOM, set it up and add styles\n\t\t\tif (!zapi.$footer.prev().length || zapi.$footer.prev()[0].className !== 'spinner') {\n\t\t\t\t// First, our styles\n\t\t\t\t$('head').append('<style>' + zapi.loading_indicator_styles + '</style>');\n\t\t\t\t// And our markup\n\t\t\t\tzapi.$footer.before(zapi.loading_indicator_html);\n\t\t\t}\n\n\t\t\t// Add loading references class\n\t\t\tzapi.$parent_body.addClass(zapi.loading_class);\n\t\t\t$.ajax({\n\t\t\t\turl      : feed_url,\n\t\t\t\tdataType : 'jsonp'\n\t\t\t}).done(function(data) {\n\t\t\t\tvar // Structure of resp: data.responseData.feed.entries[]\n\t\t\t\t\t$feed              = $($.parseXML(data.responseData.xmlString)),\n\t\t\t\t\t$entries           = $feed.find('entry'),\n\t\t\t\t\tlen                = $entries.length,\n\t\t\t\t\ti                  = 0,\n\t\t\t\t\tref_html           = '',\n\t\t\t\t\tthe_date           = '',\n\t\t\t\t\tthe_year           = '',\n\t\t\t\t\tyear_class         = '',\n\t\t\t\t\tyear_title_class   = '',\n\t\t\t\t\tis_new_year        = false,\n\t\t\t\t\tyears_for_quarters = [],\n\t\t\t\t\tqtr_idx,\n\t\t\t\t\tthe_month,\n\t\t\t\t\t$entry,\n\t\t\t\t\t$bib,\n\t\t\t\t\tbib_html,\n\t\t\t\t\tbib_url_start,\n\t\t\t\t\tentry,\n\t\t\t\t\tentry_class;\n\n\t\t\t\t// First time through, try to figure out which namespace will work\n\t\t\t\tif (zapi.is_init && len) {\n\t\t\t\t\t// Try to fetch a zapi:subcontent node using the namespace ('zapi\\\\:')\n\t\t\t\t\tif (!$($entries[0]).find(zapi.namespace + 'subcontent').length) {\n\t\t\t\t\t\t// If that failed, namespace must be an empty string\n\t\t\t\t\t\tzapi.namespace = '';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (; i < len; i++) {\n\t\t\t\t\t$entry = $($entries[i]);\n\t\t\t\t\t// Use our filter function helper (checks attr('zapi:type'))\n\t\t\t\t\tentry = $.parseJSON($entry.find(zapi.namespace + 'subcontent').filter(zapi.filterByType('json')).text());\n\n\t\t\t\t\tentry_class = 'ref-entry';\n\n\t\t\t\t\t// Zotero provides date as zapi:parsedDate in form yyyy-mm-dd\n\t\t\t\t\t// Other variations: yyyy-mm, yyyy\n\t\t\t\t\tthe_date = $entry.find(zapi.namespace + 'parsedDate').text().split('-');\n\n\t\t\t\t\tthe_year = the_date[0] || '';\n\t\t\t\t\tis_new_year = zapi.years[zapi.years.length - 1] !== the_year;\n\t\t\t\t\t// Is it a new year section or the first of this group of references\n\t\t\t\t\tif ((!ref_html.length || is_new_year) && the_year) {\n\t\t\t\t\t\t// If this is not the first year header and not the first of this group of references, close the previous year div\n\t\t\t\t\t\tif (zapi.years.length && ref_html.length) {\n\t\t\t\t\t\t\tref_html += '</div>';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tyear_class = 'year-section ' + the_year;\n\t\t\t\t\t\t// If this is the very first year, add .first class\n\t\t\t\t\t\tif (!zapi.years.length) {\n\t\t\t\t\t\t\tyear_class += ' first';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tref_html += '<div class=\"' + year_class + '\">';\n\t\t\t\t\t\t// If first of this year, add heading and push year onto years array\n\t\t\t\t\t\tif (is_new_year) {\n\t\t\t\t\t\t\tif (zapi.params.quarterly) {\n\t\t\t\t\t\t\t\tyear_title_class = ' class=\"quarterly\"';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tref_html += '<h2 id=\"year-' + the_year + '\"' + year_title_class + '>' + the_year + '</h2>';\n\t\t\t\t\t\t\tzapi.years.push(the_year);\n\t\t\t\t\t\t\t// If is quarterly, add quarters\n\t\t\t\t\t\t\tif (zapi.params.quarterly) {\n\t\t\t\t\t\t\t\tref_html += '<div class=\"quarters\">';\n\t\t\t\t\t\t\t\tfor (qtr_idx = 0; qtr_idx < 4; qtr_idx++) {\n\n\t\t\t\t\t\t\t\t\tref_html += '<span class=\"quarter-filter\" data-quarter=\"' + qtr_idx + '\">' + zapi.quarter_labels[zapi.lang][qtr_idx] + '</span>';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tref_html += '</div>';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// If there is a previous year, process it for quarterly\n\t\t\t\t\t\t\tif (zapi.years.length > 1) {\n\t\t\t\t\t\t\t\tyears_for_quarters.push(zapi.years[zapi.years.length - 2]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// Quarterly logic requires the date also\n\t\t\t\t\tif (zapi.params.quarterly) {\n\t\t\t\t\t\tthe_month = the_date[1] || 0;\n\t\t\t\t\t\tentry_class += ' year-' + the_year + ' quarter-' + Math.floor(the_month / 3);\n\t\t\t\t\t}\n\t\t\t\t\t// Entry wrap\n\t\t\t\t\tref_html += '<div class=\"' + entry_class + '\">';\n\t\t\t\t\t// Title\n\t\t\t\t\tref_html += '<h6>' + (entry.url ? '<a href=\"' + entry.url + '\" target=\"_blank\">' : '') + entry.title + (entry.url ? '</a>' : '') + '</h6>';\n\n\t\t\t\t\t$bib = $entry.find(zapi.namespace + 'subcontent').filter(zapi.filterByType('bib')).children('div');\n\t\t\t\t\tif ($bib.length) {\n\t\t\t\t\t\tbib_html = $bib[0].outerHTML;\n\t\t\t\t\t\tif (entry.url) {\n\t\t\t\t\t\t\tbib_url_start = bib_html.lastIndexOf(' from http://');\n\t\t\t\t\t\t\tif (bib_url_start === -1) {\n\t\t\t\t\t\t\t\tbib_url_start = bib_html.lastIndexOf(' from https://');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (bib_url_start !== -1) {\n\t\t\t\t\t\t\t\t// The \"from [url]\" text always has ' Retrieved' before it, so go find that text\n\t\t\t\t\t\t\t\t// bib_url_start -= 10;\n\t\t\t\t\t\t\t\tbib_url_start = bib_html.substring(0, bib_url_start).lastIndexOf(' Retrieved');\n\t\t\t\t\t\t\t\tif (bib_url_start !== -1) {\n\t\t\t\t\t\t\t\t\tbib_html = bib_html.substring(0, bib_url_start) + bib_html.substring(bib_html.indexOf('</div>'));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tref_html += bib_html;\n\t\t\t\t\t}\n\t\t\t\t\tref_html += '</div>';\n\t\t\t\t}\n\t\t\t\t// Close div.year-section\n\t\t\t\tref_html += '</div>';\n\t\t\t\t// First time through, add in year filter html\n\t\t\t\tif (zapi.is_init) {\n\t\t\t\t\tref_html = zapi.year_filter_html + ref_html;\n\t\t\t\t}\n\n\t\t\t\t// Finished building HTML\n\t\t\t\t// Pass it to callback\n\t\t\t\t// ----------------------\n\t\t\t\tzapi.callback(ref_html);\n\t\t\t\t// ----------------------\n\n\t\t\t\t// Initial run through, set up JS and styles for year filter\n\t\t\t\tif (zapi.is_init) {\n\t\t\t\t\t// Set this flag now to false to avoid conflicts with calling getReferences again\n\t\t\t\t\tzapi.is_init = false;\n\t\t\t\t\t// Attach filter by year click handler\n\t\t\t\t\tzapi.$year_filter = zapi.$body.find('.year-filter');\n\t\t\t\t\tzapi.$body.on('click.year-filter.' + zapi.collection_name, '.year-filter', zapi.loadYearFilterList);\n\t\t\t\t\tzapi.$body.on('references-load.' + zapi.collection_name, function() {\n\t\t\t\t\t\tvar // Prepare for year calculations\n\t\t\t\t\t\t\tyear_list = '',\n\t\t\t\t\t\t\ti         = 0,\n\t\t\t\t\t\t\tlen       = zapi.years.length;\n\n\t\t\t\t\t\t// Reset $year_filter object from DOM\n\t\t\t\t\t\tzapi.$year_filter = zapi.$body.find('.year-filter');\n\t\t\t\t\t\t// Remove all click handlers, then add back simple toggle handler\n\t\t\t\t\t\tzapi.$body.off('click.year-filter.' + zapi.collection_name).on('click.year-filter.' + zapi.collection_name, '.year-filter', zapi.yearFilterToggle);\n\t\t\t\t\t\tzapi.$body.off('click.year-filter.' + zapi.collection_name).on('click.year-filter.' + zapi.collection_name, '.year-filter h3', zapi.yearFilterTitleToggle);\n\t\t\t\t\t\t// Set up year section element cache\n\t\t\t\t\t\tzapi.$year_sections = zapi.$body.find('.year-section');\n\t\t\t\t\t\t// Build years list\n\t\t\t\t\t\tfor (; i < len; i++) {\n\t\t\t\t\t\t\tif (zapi.years[i].length === 4) {\n\t\t\t\t\t\t\t\tyear_list += '<h6><a class=\"year-link\" href=\"#year-' + zapi.years[i] + '\">' + zapi.years[i] + '</a></h6>';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tzapi.$year_filter.find('.group').append(year_list);\n\t\t\t\t\t\tzapi.$year_links = zapi.$year_filter.find('a.year-link');\n\t\t\t\t\t\tzapi.$year_links.on('click.' + zapi.collection_name, function(evt) {\n\t\t\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\t\t\tvar $year_link  = $(this),\n\t\t\t\t\t\t\t\tactive_year = '';\n\n\t\t\t\t\t\t\t// No other year links should be active\n\t\t\t\t\t\t\tzapi.$year_links.not($year_link).removeClass('active');\n\t\t\t\t\t\t\t$year_link.toggleClass('active');\n\n\t\t\t\t\t\t\tif ($year_link.hasClass('active')) {\n\t\t\t\t\t\t\t\tactive_year = '.' + this.innerHTML;\n\t\t\t\t\t\t\t\t/*zapi.$year_links.filter('.active').each(function() {\n\t\t\t\t\t\t\t\t\tactive_year += (active_year.length ? ', ' : '') + '.' + this.innerHTML;\n\t\t\t\t\t\t\t\t});*/\n\n\t\t\t\t\t\t\t\t// Add filtered class\n\t\t\t\t\t\t\t\tzapi.$body.addClass('filtered');\n\t\t\t\t\t\t\t\tzapi.$year_sections.not(active_year).removeClass('active').fadeOut();\n\t\t\t\t\t\t\t\tzapi.$year_sections.filter(active_year).addClass('active').fadeIn();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tzapi.$body.removeClass('filtered');\n\t\t\t\t\t\t\t\tzapi.$year_sections.fadeIn();\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Recalculate iframe height after 0.3 seconds\n\t\t\t\t\t\t\twindow.setTimeout(function() {\n\t\t\t\t\t\t\t\tzapi.$window.trigger('resize.tabs.' + zapi.collection_name);\n\t\t\t\t\t\t\t}, 300);\n\t\t\t\t\t\t});\n\t\t\t\t\t\t// Remove this handler\n\t\t\t\t\t\tzapi.$body.off('references-load.' + zapi.collection_name);\n\t\t\t\t\t\t// After letting year links settle, remove loading class (to enable smooth dropdown effect)\n\t\t\t\t\t\twindow.setTimeout(function() {\n\t\t\t\t\t\t\tzapi.$body.removeClass(zapi.loading_class);\n\t\t\t\t\t\t}, 200);\n\t\t\t\t\t\t// If .year-filter is currently active, height has changed, so trigger our event\n\t\t\t\t\t\tif (zapi.$year_filter.hasClass('active')) {\n\t\t\t\t\t\t\tzapi.$window.trigger('change-height.tabs.' + zapi.collection_name);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Reload all quarter filters (to avoid bug with first couple year's quarter filter click handlers no longer being triggered after all references finish loading)\n\t\t\t\t\t\twindow.setTimeout(function() {\n\t\t\t\t\t\t\tzapi.setupQuarterFilters(zapi.years);\n\t\t\t\t\t\t}, 200);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tzapi.is_init = false;\n\t\t\t\tzapi.$parent_body.removeClass(zapi.loading_class);\n\t\t\t\t// When this tab is selected, a resize is triggered; use that opportunity to fix the iframe height\n\t\t\t\t// And then trigger the logic once right away for the default tab\n\t\t\t\tzapi.$window.on('resize.tabs.' + zapi.collection_name, zapi.fixTabHeight).trigger('resize.tabs.' + zapi.collection_name);\n\n\t\t\t\t// If we have not yet loaded all the references, set up fetching of the next set of references\n\t\t\t\t// With a sanity check to avoid infinite loop if something went wrong (never go more above 3000 entries)\n\t\t\t\tif (len >= zapi.params.num_entries && zapi.params.start < 3000) {\n\t\t\t\t\t// Special logic for quarterly collections (in which case load all references)\n\t\t\t\t\tif (zapi.params.quarterly && !zapi.is_all_loading) {\n\t\t\t\t\t\t// Trigger immediate set up of next references (don't need infinite loading functionality)\n\t\t\t\t\t\tzapi.getNextReferences(true);\n\t\t\t\t\t\tzapi.getAllReferences();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Set up next references set\n\t\t\t\t\t\tzapi.getNextReferences();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// We have finished, so we can process the last year's quarter filters\n\t\t\t\t\tyears_for_quarters.push(the_year);\n\t\t\t\t\tzapi.is_all_loaded = true;\n\t\t\t\t\tzapi.$body.trigger('references-load.' + zapi.collection_name);\n\t\t\t\t}\n\t\t\t\t// Quarter filter setup\n\t\t\t\tif (years_for_quarters.length) {\n\t\t\t\t\tzapi.setupQuarterFilters(years_for_quarters);\n\t\t\t\t}\n\t\t\t}).fail(function() {\n\t\t\t\t// Let's try again\n\t\t\t\tzapi.getReferences();\n\t\t\t});\n\t\t},\n\t\t// Set up infinite scroll-style fetching of next set of references (or trigger it right away if is_all_loading)\n\t\tgetNextReferences: function(timedout) {\n\t\t\t// If not is_all_loading and this is not the timeout, set up timeout and return\n\t\t\tif (!zapi.is_all_loading && !timedout) {\n\t\t\t\t// Make sure resize.tabs has had a chance to do its magic by attaching inview event after 500 ms\n\t\t\t\twindow.setTimeout(function() {\n\t\t\t\t\tzapi.getNextReferences(true);\n\t\t\t\t}, 500);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tzapi.params.start += zapi.params.num_entries;\n\n\t\t\t// If not is_all_loading, add a handler to the parent window to load the next set of results\n\t\t\tif (!zapi.is_all_loading) {\n\t\t\t\tzapi.$footer.on('inview.' + zapi.collection_name, function() {\n\t\t\t\t\t// Is the current active tab this one?\n\t\t\t\t\tif ($('.tab-pane.active').attr('id') !== zapi.collection_name) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t// It is the current tab, so remove this handler and get the next set of references\n\t\t\t\t\tzapi.$footer.off('inview.' + zapi.collection_name);\n\t\t\t\t\tzapi.getReferences();\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tzapi.getReferences();\n\t\t\t}\n\t\t},\n\t\t// Get all the rest of the references\n\t\tgetAllReferences: function() {\n\t\t\t// If already loaded or loading all references, return\n\t\t\tif (zapi.is_all_loaded || zapi.is_all_loading) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// Load 'em up\n\t\t\tzapi.is_all_loading = true;\n\t\t\t// Set loading class\n\t\t\tzapi.$body.addClass(zapi.loading_class);\n\t\t\t// Kick off reference retrieval\n\t\t\tzapi.getReferences();\n\t\t},\n\t\tinitialize: function() {\n\t\t\tzapi.prepareMarkup();\n\t\t\t// Get current ip address for google API calls\n\t\t\t$.ajax({\n\t\t\t\turl      : 'http://www.telize.com/jsonip',\n\t\t\t\tdataType : 'jsonp',\n\t\t\t\tsuccess  : function(resp) {\n\t\t\t\t\tzapi.params.ip = resp.ip;\n\t\t\t\t}\n\t\t\t});\n\t\t\t// Add custom height change event handler to body\n\t\t\tzapi.$window.on('change-height.tabs.' + zapi.collection_name, function() {\n\t\t\t\t// Trigger resize tabs event after 0.5 seconds\n\t\t\t\twindow.setTimeout(function() {\n\t\t\t\t\tzapi.$window.trigger('resize.tabs.' + zapi.collection_name);\n\t\t\t\t}, 500);\n\t\t\t});\n\t\t},\n\t\tprepareMarkup: function() {\n\t\t\t// HTML and CSS snippets\n\t\t\tzapi.loading_indicator_styles = '.spinner { display: none; position: absolute; left: 45%; width: 50px; height: 30px; text-align: center; font-size: 10px; } body.' + zapi.loading_class + ' .spinner { display: block; } .spinner > div { background-color: #333; height: 100%; width: 6px; margin: 0 1px; display: inline-block;  -webkit-animation: stretchdelay 1.2s infinite ease-in-out; animation: stretchdelay 1.2s infinite ease-in-out; } .spinner .rect2 { -webkit-animation-delay: -1.1s; animation-delay: -1.1s; } .spinner .rect3 { -webkit-animation-delay: -1.0s; animation-delay: -1.0s; } .spinner .rect4 { -webkit-animation-delay: -0.9s; animation-delay: -0.9s; } .spinner .rect5 { -webkit-animation-delay: -0.8s; animation-delay: -0.8s; } @-webkit-keyframes stretchdelay { 0%, 40%, 100% { -webkit-transform: scaleY(0.4) } 20% { -webkit-transform: scaleY(1.0) } } @keyframes stretchdelay { 0%, 40%, 100% { transform: scaleY(0.4); -webkit-transform: scaleY(0.4); } 20% {  transform: scaleY(1.0); -webkit-transform: scaleY(1.0); } }';\n\t\t\tzapi.loading_indicator_html   = '<div class=\"spinner\"><div class=\"rect1\"></div><div class=\"rect2\"></div><div class=\"rect3\"></div><div class=\"rect4\"></div><div class=\"rect5\"></div></div>';\n\t\t\tzapi.year_filter_html         = '<nav class=\"year-filter c-accordion\"><div class=\"item\"><span class=\"group\"><h3>Archive <div class=\"arrow\"></div></h3>' + zapi.loading_indicator_html + '</span></div></nav>';\n\t\t},\n\t\tloadYearFilterList: function(evt) {\n\t\t\tevt.stopPropagation();\n\t\t\t// Add .active/.open\n\t\t\tzapi.yearFilterAddActive();\n\n\t\t\tif (!zapi.is_all_loaded) {\n\t\t\t\tif (zapi.is_all_loading) {\n\t\t\t\t\t// Already working on it\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Don't run this function again\n\t\t\tzapi.$body.off('click.year-filter.' + zapi.collection_name);\n\t\t\tzapi.$body.on( 'click.year-filter.' + zapi.collection_name, '.year-filter', zapi.yearFilterToggle);\n\t\t\tzapi.$body.on( 'click.year-filter.' + zapi.collection_name, '.year-filter h3', zapi.yearFilterTitleToggle);\n\t\t},\n\t\tyearFilterToggle: function(evt) {\n\t\t\tevt.stopPropagation();\n\t\t\t// Add .active/.open\n\t\t\tzapi.yearFilterAddActive();\n\t\t\t// Trigger change height\n\t\t\tzapi.$window.trigger('change-height.tabs.' + zapi.collection_name);\n\t\t},\n\t\tyearFilterTitleToggle: function(evt) {\n\t\t\tevt.stopPropagation();\n\t\t\t// Toggle .active/.open\n\t\t\tzapi.yearFilterToggleActive();\n\t\t\t// Trigger change height\n\t\t\tzapi.$window.trigger('change-height.tabs.' + zapi.collection_name);\n\t\t},\n\t\tyearFilterAddActive: function($year_filter) {\n\t\t\t$year_filter = $year_filter || zapi.$body.find('.year-filter');\n\t\t\tif (!$year_filter.hasClass('active')) {\n\t\t\t\t$year_filter.addClass('active');\n\t\t\t\t$year_filter.find('.item').addClass('open');\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\tyearFilterToggleActive: function($year_filter) {\n\t\t\t$year_filter = $year_filter || zapi.$body.find('.year-filter');\n\t\t\tif (!zapi.yearFilterAddActive($year_filter)) {\n\t\t\t\t$year_filter.removeClass('active');\n\t\t\t\t$year_filter.find('.item').removeClass('open');\n\t\t\t}\n\t\t},\n\t\tsetupQuarterFilters: function(the_years) {\n\t\t\tvar i   = 0,\n\t\t\t\tlen = the_years.length,\n\t\t\t\t$quarters,\n\t\t\t\trefs_by_quarter,\n\t\t\t\tqtr_idx;\n\n\t\t\tif (!zapi.params.quarterly || !len) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// Set up quarter filters, if applicable\n\t\t\tfor (; i < len; i++) {\n\t\t\t\tif (the_years[i].length !== 4) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\t$quarters       = zapi.$body.find('.year-section.' + the_years[i] + ' .quarters');\n\t\t\t\trefs_by_quarter = [];\n\t\t\t\tqtr_idx         = 0;\n\n\t\t\t\tif (!$quarters.length) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tfor (; qtr_idx < 4; qtr_idx++) {\n\t\t\t\t\trefs_by_quarter[qtr_idx] = zapi.$body.find('.year-section.' + the_years[i] + ' .quarter-' + qtr_idx);\n\t\t\t\t\tif (refs_by_quarter[qtr_idx].length) {\n\t\t\t\t\t\t$quarters.find('[data-quarter=\"' + qtr_idx +'\"]').addClass('is-enabled');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tzapi.attachQuarterFilterToggle($quarters, refs_by_quarter);\n\t\t\t}\n\t\t},\n\t\tattachQuarterFilterToggle: function($quarters, refs_by_quarter) {\n\t\t\t$quarters.find('.quarter-filter.is-enabled').off('click.quarter-filter.' + zapi.collection_name).on('click.quarter-filter.' + zapi.collection_name, function() {\n\t\t\t\tvar $filter        = $(this),\n\t\t\t\t\tactive_quarter = '',\n\t\t\t\t\ti;\n\t\t\t\t// No other quarter links should be active\n\t\t\t\t$quarters.find('.quarter-filter').not($filter).removeClass('active');\n\t\t\t\t$filter.toggleClass('active');\n\n\t\t\t\tif ($filter.hasClass('active')) {\n\t\t\t\t\tactive_quarter = parseInt($filter.data('quarter'), 10);\n\t\t\t\t\tfor (i = 0; i < 4; i++) {\n\t\t\t\t\t\tif (i !== active_quarter) {\n\t\t\t\t\t\t\trefs_by_quarter[i].fadeOut();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trefs_by_quarter[i].fadeIn();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tfor (i = 0; i < 4; i++) {\n\t\t\t\t\t\tif (i !== active_quarter) {\n\t\t\t\t\t\t\trefs_by_quarter[i].fadeIn();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Trigger change height\n\t\t\t\tzapi.$window.trigger('change-height.tabs.' + zapi.collection_name);\n\t\t\t});\n\t\t}\n\t};\n\n\t// Export our Zotero API handler (it may already be defined, in which case merge it into our local zapi)\n\twindow.zotero_api = window.zotero_api || {};\n\t// $.extend() merges 2nd object into first, modifying it, and returns the modified object\n\twindow.zotero_api = $.extend(zapi, window.zotero_api);\n\n\t// Attach jquery.inview to parent if not yet attached\n\tif ($.event.special.inview === undefined) {\n\t\tjs_plugin_src = window.location.href.split('/');\n\t\tjs_plugin_src.pop();\n\t\tjs_plugin_src.push('jquery.inview.min.js');\n\t\tzapi.$parent_body.append('<script src=\"' + js_plugin_src.join('/') + '\"><\\/script>');\n\t}\n})(window.jQuery || window.parent.jQuery);\n"]}