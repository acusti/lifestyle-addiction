{"version":3,"file":"zapi.js","sources":["../bower_components/fuse.js/src/fuse.js","src/str-to-date.js","zapi-compiled.js"],"names":["global","Fuse","list","options","this","i","len","key","keys","length","defaultOptions","BitapSearcher","pattern","location","distance","threshold","maxPatternLength","caseSensitive","toLowerCase","patternLen","Error","matchmask","patternAlphabet","_calculatePatternAlphabet","prototype","mask","charAt","_bitapScore","errors","accuracy","proximity","Math","abs","search","text","isMatch","score","j","binMin","binMid","start","finish","bitArr","lastBitArr","charMatch","textLen","LOCATION","THRESHOLD","bestLoc","indexOf","binMax","locations","min","lastIndexOf","floor","max","Array","push","deepValueHelper","obj","path","firstSegment","remaining","dotIndex","slice","value","Utils","isArray","deepValue","Object","toString","call","id","includeScore","shouldSort","searchFn","sortFn","a","b","getFn","item","bitapResult","existingResult","searcher","dataLen","searchKeys","searchKeysLen","rawResults","resultMap","results","analyzeText","entity","index","undefined","sort","getItem","replaceValue","exports","module","define","amd","_slashRe","_yearRe","_monthRe","_dayRe","_country","strToDate","string","date","order","part","parts","replace","m","exec","year","month","day","parseInt","tmp","today","Date","getFullYear","twoDigitYear","century","before","_insertDateOrderPart","splice","months","RegExp","join","after","daySuffixes","substr","dateOrder","partOrder","pos","window","zotero_api","$","zapi","defaults","collection","user","num_entries","zotero_options","ip","params","callback","collection_name","pathname","split","pop","feed_base","namespace","lang","$body","document","body","$window","$parent_body","$footer","$year_filter","$year_links","$year_sections","$reference_list","quarter_labels","en","fr","years","total","is_init","is_all_loading","is_all_loaded","loading_class","loading_indicator_styles","loading_indicator_html","monitoring_css","year_filter_html","reference_list","tab_height_timeout","fixTabHeight","clearTimeout","setTimeout","off","frameElement","height","tab_height","parent","on","filterByType","type","attr","buildParams","extend","getFeedUrl","feed_url","toDateString","q","encodeURIComponent","getReferences","shift","initialize","hasClass","find","append","addClass","prev","className","ajax","url","dataType","done","data","responseData","xmlString","qtr_idx","the_month","$entry","$bib","bib_url_start","entry","entry_class","$feed","parseXML","$entries","ref_html","the_year","year_title_class","year_title","the_entry","entry_title","entry_citation","is_new_year","years_for_quarters","parseJSON","filter","title","citation","wrapper_class","search_text","quarterly","children","outerHTML","substring","loadYearFilterList","year_list","yearFilterToggle","yearFilterTitleToggle","evt","preventDefault","$year_link","active_year","not","removeClass","toggleClass","innerHTML","fadeOut","fadeIn","trigger","setupQuarterFilters","getNextReferences","getAllReferences","fail","timedout","prepareMarkup","appendTo","success","resp","stopPropagation","yearFilterAddActive","yearFilterToggleActive","the_years","$quarters","refs_by_quarter","attachQuarterFilterToggle","$filter","active_quarter","jQuery"],"mappings":"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","sourcesContent":["/**\n * @license\n * Fuse - Lightweight fuzzy-search\n *\n * Copyright (c) 2012 Kirollos Risk <kirollos@gmail.com>.\n * All Rights Reserved. Apache Software License 2.0\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n(function(global) {\n\n  /**\n   * Adapted from \"Diff, Match and Patch\", by Google\n   *\n   *   http://code.google.com/p/google-diff-match-patch/\n   *\n   * Modified by: Kirollos Risk <kirollos@gmail.com>\n   * -----------------------------------------------\n   * Details: the algorithm and structure was modified to allow the creation of\n   * <Searcher> instances with a <search> method which does the actual\n   * bitap search. The <pattern> (the string that is searched for) is only defined\n   * once per instance and thus it eliminates redundant re-creation when searching\n   * over a list of strings.\n   *\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   */\n  var BitapSearcher = function(pattern, options) {\n    options = options || {};\n    this.options = options;\n    this.options.location = options.location || BitapSearcher.defaultOptions.location;\n    this.options.distance = 'distance' in options ? options.distance : BitapSearcher.defaultOptions.distance;\n    this.options.threshold = 'threshold' in options ? options.threshold : BitapSearcher.defaultOptions.threshold;\n    this.options.maxPatternLength = options.maxPatternLength || BitapSearcher.defaultOptions.maxPatternLength;\n\n    this.pattern = options.caseSensitive ? pattern : pattern.toLowerCase();\n    this.patternLen = pattern.length;\n\n    if (this.patternLen > this.options.maxPatternLength) {\n      throw new Error('Pattern length is too long');\n    }\n\n    this.matchmask = 1 << (this.patternLen - 1);\n    this.patternAlphabet = this._calculatePatternAlphabet();\n  };\n\n  BitapSearcher.defaultOptions = {\n    // Approximately where in the text is the pattern expected to be found?\n    location: 0,\n\n    // Determines how close the match must be to the fuzzy location (specified above).\n    // An exact letter match which is 'distance' characters away from the fuzzy location\n    // would score as a complete mismatch. A distance of '0' requires the match be at\n    // the exact location specified, a threshold of '1000' would require a perfect match\n    // to be within 800 characters of the fuzzy location to be found using a 0.8 threshold.\n    distance: 100,\n\n    // At what point does the match algorithm give up. A threshold of '0.0' requires a perfect match\n    // (of both letters and location), a threshold of '1.0' would match anything.\n    threshold: 0.6,\n\n    // Machine word size\n    maxPatternLength: 32\n  };\n\n  /**\n   * Initialize the alphabet for the Bitap algorithm.\n   * @return {Object} Hash of character locations.\n   * @private\n   */\n  BitapSearcher.prototype._calculatePatternAlphabet = function() {\n    var mask = {},\n      i = 0;\n\n    for (i = 0; i < this.patternLen; i++) {\n      mask[this.pattern.charAt(i)] = 0;\n    }\n\n    for (i = 0; i < this.patternLen; i++) {\n      mask[this.pattern.charAt(i)] |= 1 << (this.pattern.length - i - 1);\n    }\n\n    return mask;\n  };\n\n  /**\n   * Compute and return the score for a match with `e` errors and `x` location.\n   * @param {number} errors Number of errors in match.\n   * @param {number} location Location of match.\n   * @return {number} Overall score for match (0.0 = good, 1.0 = bad).\n   * @private\n   */\n  BitapSearcher.prototype._bitapScore = function(errors, location) {\n    var accuracy = errors / this.patternLen,\n      proximity = Math.abs(this.options.location - location);\n\n    if (!this.options.distance) {\n      // Dodge divide by zero error.\n      return proximity ? 1.0 : accuracy;\n    }\n    return accuracy + (proximity / this.options.distance);\n  };\n\n  /**\n   * Compute and return the result of the search\n   * @param {String} text The text to search in\n   * @return {Object} Literal containing:\n   *                          {Boolean} isMatch Whether the text is a match or not\n   *                          {Decimal} score Overall score for the match\n   * @public\n   */\n  BitapSearcher.prototype.search = function(text) {\n    text = this.options.caseSensitive ? text : text.toLowerCase();\n\n    if (this.pattern === text) {\n      // Exact match\n      return {\n        isMatch: true,\n        score: 0\n      };\n    }\n\n    var i, j,\n      // Set starting location at beginning text and initialize the alphabet.\n      textLen = text.length,\n      LOCATION = this.options.location,\n      // Highest score beyond which we give up.\n      THRESHOLD = this.options.threshold,\n      // Is there a nearby exact match? (speedup)\n      bestLoc = text.indexOf(this.pattern, LOCATION),\n      binMin, binMid,\n      binMax = this.patternLen + textLen,\n      start, finish,\n      bitArr, lastBitArr,\n      charMatch,\n      score = 1,\n      locations = [];\n\n    if (bestLoc != -1) {\n      THRESHOLD = Math.min(this._bitapScore(0, bestLoc), THRESHOLD);\n      // What about in the other direction? (speedup)\n      bestLoc = text.lastIndexOf(this.pattern, LOCATION + this.patternLen);\n\n      if (bestLoc != -1) {\n        THRESHOLD = Math.min(this._bitapScore(0, bestLoc), THRESHOLD);\n      }\n    }\n\n    bestLoc = -1;\n\n    for (i = 0; i < this.patternLen; i++) {\n      // Scan for the best match; each iteration allows for one more error.\n      // Run a binary search to determine how far from 'MATCH_LOCATION' we can stray at this\n      // error level.\n      binMin = 0;\n      binMid = binMax;\n      while (binMin < binMid) {\n        if (this._bitapScore(i, LOCATION + binMid) <= THRESHOLD) {\n          binMin = binMid;\n        } else {\n          binMax = binMid;\n        }\n        binMid = Math.floor((binMax - binMin) / 2 + binMin);\n      }\n\n      // Use the result from this iteration as the maximum for the next.\n      binMax = binMid;\n      start = Math.max(1, LOCATION - binMid + 1);\n      finish = Math.min(LOCATION + binMid, textLen) + this.patternLen;\n\n      // Initialize the bit array\n      bitArr = Array(finish + 2);\n\n      bitArr[finish + 1] = (1 << i) - 1;\n\n      for (j = finish; j >= start; j--) {\n        // The alphabet <patternAlphabet> is a sparse hash, so the following line generates warnings.\n        charMatch = this.patternAlphabet[text.charAt(j - 1)];\n\n        if (i === 0) {\n          // First pass: exact match.\n          bitArr[j] = ((bitArr[j + 1] << 1) | 1) & charMatch;\n        } else {\n          // Subsequent passes: fuzzy match.\n          bitArr[j] = ((bitArr[j + 1] << 1) | 1) & charMatch | (((lastBitArr[j + 1] | lastBitArr[j]) << 1) | 1) | lastBitArr[j + 1];\n        }\n        if (bitArr[j] & this.matchmask) {\n          score = this._bitapScore(i, j - 1);\n          // This match will almost certainly be better than any existing match.\n          // But check anyway.\n          if (score <= THRESHOLD) {\n            // Told you so.\n            THRESHOLD = score;\n            bestLoc = j - 1;\n            locations.push(bestLoc);\n\n            if (bestLoc > LOCATION) {\n              // When passing loc, don't exceed our current distance from loc.\n              start = Math.max(1, 2 * LOCATION - bestLoc);\n            } else {\n              // Already passed loc, downhill from here on in.\n              break;\n            }\n          }\n        }\n      }\n\n      // No hope for a (better) match at greater error levels.\n      if (this._bitapScore(i + 1, LOCATION) > THRESHOLD) {\n        break;\n      }\n      lastBitArr = bitArr;\n    }\n\n    return {\n      isMatch: bestLoc >= 0,\n      score: score\n    };\n  };\n\n  var deepValueHelper = function(obj, path, list) {\n    var firstSegment, remaining, dotIndex;\n\n    if (!path) {\n      // If there's no path left, we've gotten to the object we care about.\n      list.push(obj);\n    } else {\n      dotIndex = path.indexOf('.');\n      if (dotIndex !== -1) {\n        firstSegment = path.slice(0, dotIndex);\n        remaining = path.slice(dotIndex + 1);\n      } else {\n        firstSegment = path;\n      }\n\n      var value = obj[firstSegment];\n      if (value) {\n        if (!remaining && typeof value === 'string') {\n          list.push(value);\n        } else if (Utils.isArray(value)) {\n          // Search each item in the array.\n          for (var i = 0, len = value.length; i < len; i++) {\n            deepValueHelper(value[i], remaining, list);\n          }\n        } else if (remaining) {\n          // An object. Recurse further.\n          deepValueHelper(value, remaining, list);\n        }\n      }\n    }\n\n    return list;\n  };\n\n  var Utils = {\n    /**\n     * Traverse an object\n     * @param {Object} obj The object to traverse\n     * @param {String} path A . separated path to a key in the object. Example 'Data.Object.Somevalue'\n     * @return {Object}\n     */\n    deepValue: function(obj, path) {\n      return deepValueHelper(obj, path, []);\n    },\n    isArray: function(obj) {\n      return Object.prototype.toString.call(obj) === '[object Array]';\n    }\n  };\n\n  /**\n   * @param {Array} list\n   * @param {Object} options\n   * @public\n   */\n  function Fuse(list, options) {\n    this.list = list;\n    this.options = options = options || {};\n\n    var i, len, key, keys;\n    // Add boolean type options\n    for (i = 0, keys = ['sort', 'includeScore', 'shouldSort'], len = keys.length; i < len; i++) {\n      key = keys[i];\n      this.options[key] = key in options ? options[key] : Fuse.defaultOptions[key];\n    }\n    // Add all other options\n    for (i = 0, keys = ['searchFn', 'sortFn', 'keys', 'getFn'], len = keys.length; i < len; i++) {\n      key = keys[i];\n      this.options[key] = options[key] || Fuse.defaultOptions[key];\n    }\n  };\n\n  Fuse.defaultOptions = {\n    id: null,\n\n    caseSensitive: false,\n\n    // Whether the score should be included in the result set.\n    // When <true>, each result in the list will be of the form: `{ item: ..., score: ... }`\n    includeScore: false,\n\n    // Whether to sort the result list, by score\n    shouldSort: true,\n\n    // The search function to use\n    // Note that the default search function ([[Function]]) must conform to the following API:\n    //\n    //  @param pattern The pattern string to search\n    //  @param options The search option\n    //  [[Function]].constructor = function(pattern, options)\n    //\n    //  @param text: the string to search in for the pattern\n    //  @return Object in the form of:\n    //    - isMatch: boolean\n    //    - score: Int\n    //  [[Function]].prototype.search = function(text)\n    searchFn: BitapSearcher,\n\n    // Default sort function\n    sortFn: function(a, b) {\n      return a.score - b.score;\n    },\n\n    // Default get function\n    getFn: Utils.deepValue,\n\n    keys: []\n  };\n\n  /**\n   * Searches for all the items whose keys (fuzzy) match the pattern.\n   * @param {String} pattern The pattern string to fuzzy search on.\n   * @return {Array} A list of all serch matches.\n   * @public\n   */\n  Fuse.prototype.search = function(pattern) {\n    var searcher = new(this.options.searchFn)(pattern, this.options),\n      j, item,\n      list = this.list,\n      dataLen = list.length,\n      options = this.options,\n      searchKeys = this.options.keys,\n      searchKeysLen = searchKeys.length,\n      bitapResult,\n      rawResults = [],\n      resultMap = {},\n      existingResult,\n      results = [];\n\n    /**\n     * Calls <Searcher::search> for bitap analysis. Builds the raw result list.\n     * @param {String} text The pattern string to fuzzy search on.\n     * @param {String|Number} entity If the <data> is an Array, then entity will be an index,\n     *                            otherwise it's the item object.\n     * @param {Number} index\n     * @private\n     */\n    var analyzeText = function(text, entity, index) {\n      // Check if the text can be searched\n      if (text === undefined || text === null) {\n        return;\n      }\n\n      if (typeof text === 'string') {\n\n        // Get the result\n        bitapResult = searcher.search(text);\n\n        // If a match is found, add the item to <rawResults>, including its score\n        if (bitapResult.isMatch) {\n\n          // Check if the item already exists in our results\n          existingResult = resultMap[index];\n          if (existingResult) {\n            // Use the lowest score\n            existingResult.score = Math.min(existingResult.score, bitapResult.score);\n          } else {\n            // Add it to the raw result list\n            resultMap[index] = {\n              item: entity,\n              score: bitapResult.score\n            };\n            rawResults.push(resultMap[index]);\n          }\n        }\n      } else if (Utils.isArray(text)) {\n        for (var i = 0; i < text.length; i++) {\n          analyzeText(text[i], entity, index);\n        }\n      }\n    };\n\n    // Check the first item in the list, if it's a string, then we assume\n    // that every item in the list is also a string, and thus it's a flattened array.\n    if (typeof list[0] === 'string') {\n      // Iterate over every item\n      for (var i = 0; i < dataLen; i++) {\n        analyzeText(list[i], i, i);\n      }\n    } else {\n      // Otherwise, the first item is an Object (hopefully), and thus the searching\n      // is done on the values of the keys of each item.\n\n      // Iterate over every item\n      for (var i = 0; i < dataLen; i++) {\n        item = list[i];\n        // Iterate over every key\n        for (j = 0; j < searchKeysLen; j++) {\n          analyzeText(options.getFn(item, searchKeys[j]), item, i);\n        }\n      }\n    }\n\n    if (options.shouldSort) {\n      rawResults.sort(options.sortFn);\n    }\n\n    // Helper function, here for speed-up, which returns the\n    // the raw item, including the score, or simply the item itself, depending\n    // on the specified option\n    var getItem = options.includeScore ? function(i) {\n      return rawResults[i];\n    } : function(i) {\n      return rawResults[i].item;\n    };\n\n    // Helper function, here for speed-up, which replaces the item with its value,\n    // if the options specifies it,\n    var replaceValue = options.id ? function(i) {\n      rawResults[i].item = options.getFn(rawResults[i].item, options.id);\n    } : function(i) {\n      return; // no-op\n    };\n\n    // From the results, push into a new array only the item identifier (if specified)\n    // of the entire item.  This is because we don't want to return the <rawResults>,\n    // since it contains other metadata;\n    for (var i = 0, len = rawResults.length; i < len; i++) {\n      // replace the item with its value, which can be its id if the options specifies it\n      replaceValue(i);\n      results.push(getItem(i));\n    }\n\n    return results;\n  };\n\n  // Export to Common JS Loader\n  if (typeof exports === 'object') {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like environments that support module.exports,\n    // like Node.\n    module.exports = Fuse;\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module.\n    define(function() {\n      return Fuse;\n    });\n  } else {\n    // Browser globals (root is window)\n    global.Fuse = Fuse;\n  }\n\n})(this);","/**\n * Zotero date string parsing utility function\n *\n * Adapted to work standalone\n *\n * From https://github.com/zotero/zotero/blob/4.0/chrome/content/zotero/xpcom/date.js\n */\n\n/*jshint quotmark: false, eqeqeq: false, strict: false, curly: false */\n\n(function() {\n\n\t/*\n\t * converts a string to an object containing:\n\t *    day: integer form of the day\n\t *    month: integer form of the month (indexed from 0, not 1)\n\t *    year: 4 digit year (or, year + BC/AD/etc.)\n\t *    part: anything that does not fall under any of the above categories\n\t *          (e.g., \"Summer,\" etc.)\n\t *\n\t * Note: the returned object is *not* a JS Date object\n\t */\n\tvar _slashRe = /^(.*?)\\b([0-9]{1,4})(?:([\\-\\/\\.\\u5e74])([0-9]{1,2}))?(?:([\\-\\/\\.\\u6708])([0-9]{1,4}))?((?:\\b|[^0-9]).*?)$/;\n\tvar _yearRe = /^(.*?)\\b((?:circa |around |about |c\\.? ?)?[0-9]{1,4}(?: ?B\\.? ?C\\.?(?: ?E\\.?)?| ?C\\.? ?E\\.?| ?A\\.? ?D\\.?)|[0-9]{3,4})\\b(.*?)$/i;\n\tvar _monthRe = null;\n\tvar _dayRe = null;\n\tvar _country = 'CA';\n\n\tvar strToDate = function(string) {\n\t\tvar date = {\n\t\t\torder: ''\n\t\t};\n\n\t\t// skip empty things\n\t\tif(!string) {\n\t\t\treturn date;\n\t\t}\n\n\t\tvar parts = [],\n\t\t\tpart,\n\t\t\ti;\n\n\t\tstring = string.toString().replace(/^\\s+|\\s+$/g, \"\").replace(/\\s+/, \" \");\n\n\t\t// first, directly inspect the string\n\t\tvar m = _slashRe.exec(string);\n\t\tif (m &&\n\t\t\t((!m[5] || !m[3]) || m[3] == m[5] || (m[3] == \"\\u5e74\" && m[5] == \"\\u6708\")) &&\t// require sane separators\n\t\t\t((m[2] && m[4] && m[6]) || (!m[1] && !m[7]))) {\n\t\t\t// require that either all parts are found,\n\t\t\t// or else this is the entire date field\n\t\t\t// figure out date based on parts\n\t\t\tif(m[2].length == 3 || m[2].length == 4 || m[3] == \"\\u5e74\") {\n\t\t\t\t// ISO 8601 style date (big endian)\n\t\t\t\tdate.year = m[2];\n\t\t\t\tdate.month = m[4];\n\t\t\t\tdate.day = m[6];\n\t\t\t\tdate.order += m[2] ? 'y' : '';\n\t\t\t\tdate.order += m[4] ? 'm' : '';\n\t\t\t\tdate.order += m[6] ? 'd' : '';\n\t\t\t} else if(m[2] && !m[4] && m[6]) {\n\t\t\t\tdate.month = m[2];\n\t\t\t\tdate.year = m[6];\n\t\t\t\tdate.order += m[2] ? 'm' : '';\n\t\t\t\tdate.order += m[6] ? 'y' : '';\n\t\t\t} else {\n\t\t\t\t// local style date (middle or little endian)\n\t\t\t\tif (_country == \"US\" ||\t// The United States\n\t\t\t\t\t_country == \"FM\" ||\t// The Federated States of Micronesia\n\t\t\t\t\t_country == \"PW\" ||\t// Palau\n\t\t\t\t\t_country == \"PH\") {\t// The Philippines\n\t\t\t\t\tdate.month = m[2];\n\t\t\t\t\tdate.day = m[4];\n\t\t\t\t\tdate.order += m[2] ? 'm' : '';\n\t\t\t\t\tdate.order += m[4] ? 'd' : '';\n\t\t\t\t} else {\n\t\t\t\t\tdate.month = m[4];\n\t\t\t\t\tdate.day = m[2];\n\t\t\t\t\tdate.order += m[2] ? 'd' : '';\n\t\t\t\t\tdate.order += m[4] ? 'm' : '';\n\t\t\t\t}\n\t\t\t\tdate.year = m[6];\n\t\t\t\tdate.order += 'y';\n\t\t\t}\n\n\t\t\tif(date.year) date.year = parseInt(date.year, 10);\n\t\t\tif(date.day) date.day = parseInt(date.day, 10);\n\t\t\tif(date.month) {\n\t\t\t\tdate.month = parseInt(date.month, 10);\n\n\t\t\t\tif(date.month > 12) {\n\t\t\t\t\t// swap day and month\n\t\t\t\t\tvar tmp = date.day;\n\t\t\t\t\tdate.day = date.month;\n\t\t\t\t\tdate.month = tmp;\n\t\t\t\t\tdate.order = date.order.replace('m', 'D')\n\t\t\t\t\t\t.replace('d', 'M')\n\t\t\t\t\t\t.replace('D', 'd')\n\t\t\t\t\t\t.replace('M', 'm');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif((!date.month || date.month <= 12) && (!date.day || date.day <= 31)) {\n\t\t\t\tif(date.year && date.year < 100) {\t// for two digit years, determine proper\n\t\t\t\t\t\t\t\t\t\t\t\t\t// four digit year\n\t\t\t\t\tvar today = new Date();\n\t\t\t\t\tvar year = today.getFullYear();\n\t\t\t\t\tvar twoDigitYear = year % 100;\n\t\t\t\t\tvar century = year - twoDigitYear;\n\n\t\t\t\t\tif(date.year <= twoDigitYear) {\n\t\t\t\t\t\t// assume this date is from our century\n\t\t\t\t\t\tdate.year = century + date.year;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// assume this date is from the previous century\n\t\t\t\t\t\tdate.year = century - 100 + date.year;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif(date.month) date.month--;\t\t// subtract one for JS style\n\n\t\t\t\tparts.push(\n\t\t\t\t\t{ part: m[1], before: true },\n\t\t\t\t\t{ part: m[7] }\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\t// give up; we failed the sanity check\n\t\t\t\tdate = {\n\t\t\t\t\torder: ''\n\t\t\t\t};\n\t\t\t\tparts.push({ part: string });\n\t\t\t}\n\t\t} else {\n\t\t\tparts.push({ part: string });\n\t\t}\n\n\t\t// couldn't find something with the algorithms; use regexp\n\t\t// YEAR\n\t\tif(!date.year) {\n\t\t\tfor (i in parts) {\n\t\t\t\tm = _yearRe.exec(parts[i].part);\n\t\t\t\tif (m) {\n\t\t\t\t\tdate.year = m[2];\n\t\t\t\t\tdate.order = _insertDateOrderPart(date.order, 'y', parts[i]);\n\t\t\t\t\tparts.splice(\n\t\t\t\t\t\ti, 1,\n\t\t\t\t\t\t{ part: m[1], before: true },\n\t\t\t\t\t\t{ part: m[3] }\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// MONTH\n\t\tif(!date.month) {\n\t\t\t// compile month regular expression\n\t\t\tvar months = ['jan', 'feb', 'mar', 'apr', 'may', 'jun', 'jul',\n\t\t\t\t'aug', 'sep', 'oct', 'nov', 'dec'];\n\n\t\t\tif(!_monthRe) {\n\t\t\t\t_monthRe = new RegExp(\"^(.*)\\\\b(\"+months.join(\"|\")+\")[^ ]*(?: (.*)$|$)\", \"i\");\n\t\t\t}\n\n\t\t\tfor (i in parts) {\n\t\t\t\tm = _monthRe.exec(parts[i].part);\n\t\t\t\tif (m) {\n\t\t\t\t\t// Modulo 12 in case we have multiple languages\n\t\t\t\t\tdate.month = months.indexOf(m[2].toLowerCase()) % 12;\n\t\t\t\t\tdate.order = _insertDateOrderPart(date.order, 'm', parts[i]);\n\t\t\t\t\tparts.splice(\n\t\t\t\t\t\ti, 1,\n\t\t\t\t\t\t{ part: m[1], before: \"m\" },\n\t\t\t\t\t\t{ part: m[3], after: \"m\" }\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// DAY\n\t\tif(!date.day) {\n\t\t\t// compile day regular expression\n\t\t\tif(!_dayRe) {\n\t\t\t\tvar daySuffixes = \"\";\n\t\t\t\t_dayRe = new RegExp(\"\\\\b([0-9]{1,2})(?:\"+daySuffixes+\")?\\\\b(.*)\", \"i\");\n\t\t\t}\n\n\t\t\tfor (i in parts) {\n\t\t\t\tm = _dayRe.exec(parts[i].part);\n\t\t\t\tif (m) {\n\t\t\t\t\tvar day = parseInt(m[1], 10);\n\t\t\t\t\t// Sanity check\n\t\t\t\t\tif (day <= 31) {\n\t\t\t\t\t\tdate.day = day;\n\t\t\t\t\t\tdate.order = _insertDateOrderPart(date.order, 'd', parts[i]);\n\t\t\t\t\t\tif(m.index > 0) {\n\t\t\t\t\t\t\tpart = parts[i].part.substr(0, m.index);\n\t\t\t\t\t\t\tif(m[2]) {\n\t\t\t\t\t\t\t\tpart += \" \" + m[2];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpart = m[2];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tparts.splice(\n\t\t\t\t\t\t\ti, 1,\n\t\t\t\t\t\t\t{ part: part }\n\t\t\t\t\t\t);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Concatenate date parts\n\t\tdate.part = '';\n\t\tfor (i in parts) {\n\t\t\tdate.part += parts[i].part + ' ';\n\t\t}\n\n\t\t// clean up date part\n\t\tif(date.part) {\n\t\t\tdate.part = date.part.replace(/^[^A-Za-z0-9]+|[^A-Za-z0-9]+$/g, \"\");\n\t\t}\n\n\t\tif(date.part === \"\" || date.part === undefined) {\n\t\t\tdelete date.part;\n\t\t}\n\n\t\t//make sure year is always a string\n\t\tif(date.year || date.year === 0) date.year += '';\n\n\t\treturn date;\n\t};\n\t// Internal helper function\n\tvar _insertDateOrderPart = function(dateOrder, part, partOrder) {\n\t\tif (!dateOrder) {\n\t\t\treturn part;\n\t\t}\n\t\tif (partOrder.before === true) {\n\t\t\treturn part + dateOrder;\n\t\t}\n\t\tif (partOrder.after === true) {\n\t\t\treturn dateOrder + part;\n\t\t}\n\t\tvar pos;\n\t\tif (partOrder.before) {\n\t\t\tpos = dateOrder.indexOf(partOrder.before);\n\t\t\tif (pos == -1) {\n\t\t\t\treturn dateOrder;\n\t\t\t}\n\t\t\treturn dateOrder.replace(new RegExp(\"(\" + partOrder.before + \")\"), part + '$1');\n\t\t}\n\t\tif (partOrder.after) {\n\t\t\tpos = dateOrder.indexOf(partOrder.after);\n\t\t\tif (pos == -1) {\n\t\t\t\treturn dateOrder + part;\n\t\t\t}\n\t\t\treturn dateOrder.replace(new RegExp(\"(\" + partOrder.after + \")\"), '$1' + part);\n\t\t}\n\t\treturn dateOrder + part;\n\t};\n\t// Export strToDate as part of zotero_api object\n\twindow.zotero_api = window.zotero_api || {};\n\twindow.zotero_api.strToDate = strToDate;\n\n})();\n","(function($) {\n\t'use strict';\n\tvar zapi;\n\t// js_plugin_src\n\n\tzapi = {\n\t\tdefaults        : {\n\t\t\tcollection     : '',\n\t\t\tuser           : '1562960',\n\t\t\t// Number of entries to fetch\n\t\t\tnum_entries    : 99,\n\t\t\tstart          : 0,\n\t\t\tzotero_options : 'format=atom&content=json,bib&style=apa&order=date&sort=desc',\n\t\t\tip             : false\n\t\t},\n\t\tparams          : {},\n\t\tcallback        : {},\n\t\tcollection_name : window.location.pathname.split('/').pop().replace('archive-', '').replace('monitoring-', '').replace('.html', ''),\n\t\tfeed_base       : 'https://api.zotero.org/users/',\n\t\tnamespace       : 'zapi\\\\:',\n\t\tlang            : 'en',\n\t\t// Element cache (careful with using string selectors with this jQuery; it will search the parent DOM)\n\t\t$body           : $(document.body),\n\t\t$window         : $(window),\n\t\t$parent_body    : $('body'),\n\t\t$footer         : $('.c-back-to-top'),\n\t\t$year_filter    : $(),\n\t\t$year_links     : $(),\n\t\t$year_sections  : $(),\n\t\t$reference_list : $(),\n\t\t// Labels for quarter-year filters\n\t\tquarter_labels  : {\n\t\t\t'en': [\n\t\t\t\t'Jan - Mar',\n\t\t\t\t'April - June',\n\t\t\t\t'July - Sept',\n\t\t\t\t'Oct - Dec'\n\t\t\t],\n\t\t\t'fr': [\n\t\t\t\t'Jan - Mars',\n\t\t\t\t'Avril - Juin',\n\t\t\t\t'Juil - Sept',\n\t\t\t\t'Oct - Dec'\n\t\t\t]\n\t\t},\n\t\t// An array of years of the references (for archive page)\n\t\tyears                    : [],\n\t\t// Total number of references\n\t\ttotal                    : false,\n\t\t// Flag if is initial load\n\t\tis_init                  : true,\n\t\t// Flag for loading all references immediately\n\t\tis_all_loading           : true,\n\t\t// Flag for keeping track if all references have been loaded\n\t\tis_all_loaded            : false,\n\t\t// Class to add to body when loading references\n\t\tloading_class            : 'loading-references',\n\t\t// HTML and CSS snippets\n\t\tloading_indicator_styles : '',\n\t\tloading_indicator_html   : '',\n\t\tmonitoring_css           : '.year-filter{width:24%;min-width:145px;float:right;margin:0 0 .5em .25em;border:1px solid #e5e5e5}.year-filter .item{position:relative;max-height:64px;padding:.5em .75em;overflow:hidden;cursor:pointer;transition:max-height .35s}.year-filter.active .item{max-height:450px;overflow-y:auto;cursor:default}body.loading-references .year-filter.active .item{max-height:110px;overflow:hidden}.year-filter .spinner{position:static;margin:1em auto}.year-filter h3{position:relative;cursor:pointer}.year-filter h6 a{display:block;padding:.2em 1em}.quarter-filter.is-enabled:hover,.year-filter h6 a:hover{background:#f0f0f0;cursor:pointer}.quarter-filter.active,.quarter-filter.active:hover,.year-filter h6 a.active,.year-filter h6 a.active:hover{background:#ddd}.quarters{float:left;margin-left:9px;margin-top:20px;line-height:42px}#boot .year-section h2{margin-top:20px}#boot .year-section.first h2,#boot.filtered .year-section h2{margin-top:0}#boot .year-section h6{margin-top:1em}.filtered .year-section .quarters,.year-section.first .quarters{margin-top:0}.quarter-filter{border:1px solid #e5e5e5;font-weight:700;font-size:13px;padding:.25em .35em;margin:0 .25em;-ms-filter:\"alpha(Opacity=50)\";filter:alpha(opacity=50);opacity:.5}.quarter-filter.is-enabled{-ms-filter:\"alpha(Opacity=100)\";filter:alpha(opacity=100);opacity:1}h2.quarterly{float:left}.ref-entry{clear:left}#boot .year-filter h6 a:hover{text-decoration:none}#boot .year-filter.active .item:hover{background-color:transparent}',\n\t\tyear_filter_html         : '',\n\t\t// Reference list as array of objects for searching\n\t\treference_list           : [],\n\t\t// Set the correct height of the tab iframe\n\t\ttab_height_timeout       : '',\n\t\tfixTabHeight : function() {\n\t\t\twindow.clearTimeout(zapi.tab_height_timeout);\n\t\t\tzapi.tab_height_timeout = window.setTimeout(function() {\n\t\t\t\t// Remove this event listener, adjust height, add back the listener\n\t\t\t\tzapi.$window.off('resize.tabs.' + zapi.collection_name);\n\t\t\t\t// Set height with extra 50px\n\t\t\t\twindow.frameElement.height = zapi.tab_height = zapi.$body.parent().height() + 50;\n\t\t\t\t// Add back the listener\n\t\t\t\twindow.setTimeout(function() {\n\t\t\t\t\tzapi.$window.on('resize.tabs.' + zapi.collection_name, zapi.fixTabHeight);\n\t\t\t\t}, 200);\n\t\t\t}, 200);\n\t\t},\n\t\tfilterByType : function(type) {\n\t\t\treturn function() {\n\t\t\t\treturn $(this).attr('zapi:type') === type;\n\t\t\t};\n\t\t},\n\t\tbuildParams  : function(options) {\n\t\t\tzapi.params = $.extend({}, zapi.defaults, options);\n\t\t\t// if (zapi.params.quarterly) {\n\t\t\t//\tzapi.params.num_entries = 99;\n\t\t\t// }\n\t\t},\n\t\tgetFeedUrl   : function() {\n\t\t\tvar feed_url = zapi.feed_base;\n\n\t\t\t// Build the zotero api url\n\t\t\tfeed_url += zapi.params.user + '/collections/' + zapi.params.collection + '/items?' + zapi.params.zotero_options + '&start=' + zapi.params.start + '&limit=' + zapi.params.num_entries;\n\n\t\t\t// Add a 24 hour cache busting date string\n\t\t\tfeed_url += '&cb=' + new Date().toDateString();\n\n\t\t\tif (zapi.params.q) {\n\t\t\t\tfeed_url += '&q=' + zapi.params.q + '&qmode=titleCreatorYear';\n\t\t\t}\n\t\t\t// Build the google feed api url and return it\n\t\t\treturn 'https://ajax.googleapis.com/ajax/services/feed/load?v=1.0&output=xml&num=' + zapi.params.num_entries + (zapi.params.ip ? '&userip=' + zapi.params.ip : '') + '&q=' + encodeURIComponent(feed_url);\n\t\t},\n\t\tgetReferences: function(options, callback) {\n\t\t\t// If we have options (like on first load), use them\n\t\t\tif (options) {\n\t\t\t\t// Build our params, then get the feed url\n\t\t\t\tzapi.buildParams(options);\n\t\t\t\tif (callback) {\n\t\t\t\t\tzapi.callback = callback;\n\t\t\t\t}\n\t\t\t\t// Special logic for language\n\t\t\t\tif (parent.window.location.pathname.substr(1).split('/').shift() === 'fr') {\n\t\t\t\t\tzapi.lang = 'fr';\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (zapi.is_init) {\n\t\t\t\tzapi.initialize();\n\t\t\t}\n\t\t\t// If all references are already loaded, return\n\t\t\tif (zapi.is_all_loaded) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// Get the google feed api url\n\t\t\tvar feed_url = zapi.getFeedUrl();\n\n\t\t\t// Check if the iframe has our styles yet\n\t\t\tif (!zapi.$body.hasClass('ready')) {\n\t\t\t\t$(document).find('head').append('<style>' + zapi.monitoring_css + '\\n' + zapi.loading_indicator_styles + '</style>');\n\t\t\t\tzapi.$body.addClass('ready');\n\t\t\t}\n\n\t\t\t// If the spinner markup is not yet in the parent.window DOM, set it up and add styles\n\t\t\tif (zapi.$footer.prev()[0].className !== 'spinner') {\n\t\t\t\t// First, our styles\n\t\t\t\t$('head').append('<style>' + zapi.loading_indicator_styles + '</style>');\n\t\t\t\t// And our markup\n\t\t\t\tzapi.$footer.before(zapi.loading_indicator_html);\n\t\t\t}\n\n\t\t\t// Add loading references class\n\t\t\tzapi.$parent_body.addClass(zapi.loading_class);\n\t\t\t$.ajax({\n\t\t\t\turl      : feed_url,\n\t\t\t\tdataType : 'jsonp'\n\t\t\t}).done(function(data) {\n\t\t\t\tif (!data.responseData || !data.responseData.xmlString || !data.responseData.xmlString.length) {\n\t\t\t\t\t// Try again\n\t\t\t\t\tzapi.getReferences();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tvar // Structure of resp: data.responseData.feed.entries[]\n\t\t\t\t\t$feed              = $($.parseXML(data.responseData.xmlString)),\n\t\t\t\t\t$entries           = $feed.find('entry'),\n\t\t\t\t\tlen                = $entries.length,\n\t\t\t\t\ti                  = 0,\n\t\t\t\t\tref_html           = '',\n\t\t\t\t\tthe_year           = '',\n\t\t\t\t\t// year_class         = '',\n\t\t\t\t\tyear_title_class   = '',\n\t\t\t\t\tyear_title         = '',\n\t\t\t\t\tthe_entry          = {},\n\t\t\t\t\tentry_title        = '',\n\t\t\t\t\tentry_citation     = '',\n\t\t\t\t\tregex_match_html   = /<\\/?\\w+((\\s+\\w+(\\s*=\\s*(?:\\\".*?\"|'.*?'|[^'\\\">\\s]+))?)+\\s*|\\s*)\\/?>/gi,\n\t\t\t\t\tis_new_year        = false,\n\t\t\t\t\tyears_for_quarters = [],\n\t\t\t\t\tqtr_idx,\n\t\t\t\t\tthe_month,\n\t\t\t\t\t$entry,\n\t\t\t\t\t$bib,\n\t\t\t\t\tbib_url_start,\n\t\t\t\t\tentry,\n\t\t\t\t\tentry_class;\n\n\t\t\t\tif (!$feed.length) {\n\t\t\t\t\t// Try again\n\t\t\t\t\tzapi.getReferences();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// Check if we have set the total results yet\n\t\t\t\tif (zapi.total === false) {\n\t\t\t\t\t// First time through, try to fetch totalResults node using the namespace ('zapi\\\\:')\n\t\t\t\t\tzapi.total = $feed.find(zapi.namespace + 'totalResults');\n\t\t\t\t\t// If that failed, try it without the namespace (set the namespace as an empty string)\n\t\t\t\t\tif (!zapi.total.length) {\n\t\t\t\t\t\tzapi.namespace = '';\n\t\t\t\t\t\tzapi.total = $feed.find(zapi.namespace + 'totalResults');\n\t\t\t\t\t}\n\t\t\t\t\t// If we found it, set it. Otherwise, keep zapi.total as false\n\t\t\t\t\tif (zapi.total.length) {\n\t\t\t\t\t\tzapi.total = parseInt(zapi.total.text(), 10);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tzapi.total = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (; i < len; i++) {\n\t\t\t\t\t$entry = $($entries[i]);\n\t\t\t\t\t// If this selector doesn't work, we need to use a filter function and check attr('zapi:type')\n\t\t\t\t\tentry = $.parseJSON($entry.find(zapi.namespace + 'subcontent').filter(zapi.filterByType('json')).text());\n\n\t\t\t\t\tentry_class = 'ref-entry';\n\n\t\t\t\t\t// Initialize the_entry object\n\t\t\t\t\tthe_entry = {\n\t\t\t\t\t\ttitle:         '',\n\t\t\t\t\t\tcitation:      '',\n\t\t\t\t\t\twrapper_class: '',\n\t\t\t\t\t\tbefore:        '',\n\t\t\t\t\t\tafter:         '',\n\t\t\t\t\t\tsearch_text:   ''\n\t\t\t\t\t};\n\n\t\t\t\t\tthe_year = $entry.find(zapi.namespace + 'year').text();\n\t\t\t\t\tis_new_year = zapi.years.length && zapi.years[zapi.years.length - 1] > the_year;\n\t\t\t\t\t// Is it a new year section or the first of this group of references\n\t\t\t\t\tif ((!i || is_new_year) && the_year) {\n\t\t\t\t\t\t// If this is not the first year header and not the first of this group of references, close the previous year div\n\t\t\t\t\t\t/*if (zapi.years.length && ref_html.length) {\n\t\t\t\t\t\t\tref_html += '</div>';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tyear_class = 'year-section ' + the_year;\n\t\t\t\t\t\t// If this is the very first year, add .first class\n\t\t\t\t\t\tif (!zapi.years.length) {\n\t\t\t\t\t\t\tyear_class += ' first';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tref_html += '<div class=\"' + year_class + '\">';*/\n\t\t\t\t\t\t// If first of this year, add heading and push year onto years array\n\t\t\t\t\t\tif (is_new_year) {\n\t\t\t\t\t\t\tyear_title_class = 'year-title';\n\t\t\t\t\t\t\tif (zapi.params.quarterly) {\n\t\t\t\t\t\t\t\tyear_title_class += ' quarterly';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tyear_title = '<h2 id=\"year-' + the_year + '\"' + year_title_class + '>' + the_year + '</h2>';\n\t\t\t\t\t\t\tzapi.years.push(the_year);\n\t\t\t\t\t\t\t// If is quarterly, add quarters\n\t\t\t\t\t\t\tif (zapi.params.quarterly) {\n\t\t\t\t\t\t\t\tyear_title += '<div class=\"quarters\">';\n\t\t\t\t\t\t\t\tfor (qtr_idx = 0; qtr_idx < 4; qtr_idx++) {\n\t\t\t\t\t\t\t\t\tyear_title += '<span class=\"quarter-filter\" data-quarter=\"' + qtr_idx + '\">' + zapi.quarter_labels[zapi.lang][qtr_idx] + '</span>';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tyear_title += '</div>';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tyear_title += '</h2>';\n\t\t\t\t\t\t\tthe_entry.before = year_title;\n\t\t\t\t\t\t\t// If there is a previous year, process it for quarterly\n\t\t\t\t\t\t\tif (zapi.years.length > 1) {\n\t\t\t\t\t\t\t\tyears_for_quarters.push(zapi.years[zapi.years.length - 2]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// Quarterly logic requires the date also\n\t\t\t\t\tif (zapi.params.quarterly) {\n\t\t\t\t\t\tthe_month = zapi.strToDate(entry.date).month;\n\t\t\t\t\t\tif (typeof the_month !== 'number') {\n\t\t\t\t\t\t\t// If strToDate() failed to parse the date string, default to first month\n\t\t\t\t\t\t\tthe_month = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tentry_class += ' year-' + the_year + ' quarter-' + Math.floor(the_month / 3);\n\t\t\t\t\t}\n\t\t\t\t\t// Entry wrap\n\t\t\t\t\tref_html += '<div class=\"' + entry_class + '\">';\n\t\t\t\t\t// Title\n\t\t\t\t\tref_html += '<h6>' + (entry.url ? '<a href=\"' + entry.url + '\" target=\"_blank\">' : '') + entry.title + (entry.url ? '</a>' : '') + '</h6>';\n\n\t\t\t\t\t$bib = $entry.find(zapi.namespace + 'subcontent').filter(zapi.filterByType('bib')).children('div');\n\t\t\t\t\tif ($bib.length) {\n\t\t\t\t\t\tentry_citation = $bib[0].outerHTML;\n\t\t\t\t\t\tif (entry.url) {\n\t\t\t\t\t\t\tbib_url_start = entry_citation.lastIndexOf(' from http://');\n\t\t\t\t\t\t\tif (bib_url_start === -1) {\n\t\t\t\t\t\t\t\tbib_url_start = entry_citation.lastIndexOf(' from https://');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (bib_url_start !== -1) {\n\t\t\t\t\t\t\t\t// The \"from [url]\" text always has ' Retrieved' before it, so go find that text\n\t\t\t\t\t\t\t\t// bib_url_start -= 10;\n\t\t\t\t\t\t\t\tbib_url_start = entry_citation.substring(0, bib_url_start).lastIndexOf(' Retrieved');\n\t\t\t\t\t\t\t\tif (bib_url_start !== -1) {\n\t\t\t\t\t\t\t\t\tentry_citation = entry_citation.substring(0, bib_url_start) + entry_citation.substring(entry_citation.indexOf('</div>'));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// TODO: add property to identify reference (actual dom object or id?)\n\t\t\t\t\tzapi.reference_list.push({\n\t\t\t\t\t\ttitle    : entry_title,\n\t\t\t\t\t\tcitation : entry_citation\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t// Close div.year-section\n\t\t\t\tref_html += '</div>';\n\t\t\t\t// First time through, add in year filter html\n\t\t\t\tif (zapi.is_init) {\n\t\t\t\t\tref_html = zapi.year_filter_html + ref_html;\n\t\t\t\t}\n\n\t\t\t\t// Finished building HTML\n\t\t\t\t// Pass it to callback\n\t\t\t\t// ----------------------\n\t\t\t\t// zapi.callback(ref_html);\n\t\t\t\t// ----------------------\n\n\t\t\t\t// Initial run through, set up JS and styles for year filter\n\t\t\t\tif (zapi.is_init) {\n\t\t\t\t\t// Set this flag now to false to avoid conflicts with calling getReferences again\n\t\t\t\t\tzapi.is_init = false;\n\t\t\t\t\t// Attach filter by year click handler\n\t\t\t\t\tzapi.$year_filter = zapi.$body.find('.year-filter');\n\t\t\t\t\tzapi.$body.on('click.year-filter.' + zapi.collection_name, '.year-filter', zapi.loadYearFilterList);\n\t\t\t\t\tzapi.$body.on('references-load.' + zapi.collection_name, function() {\n\t\t\t\t\t\tvar // Prepare for year calculations\n\t\t\t\t\t\t\tyear_list = '',\n\t\t\t\t\t\t\ti         = 0,\n\t\t\t\t\t\t\tlen       = zapi.years.length;\n\n\t\t\t\t\t\t// Reset $year_filter object from DOM\n\t\t\t\t\t\tzapi.$year_filter = zapi.$body.find('.year-filter');\n\t\t\t\t\t\t// Remove all click handlers, then add back simple toggle handler\n\t\t\t\t\t\tzapi.$body.off('click.year-filter.' + zapi.collection_name).on('click.year-filter.' + zapi.collection_name, '.year-filter', zapi.yearFilterToggle);\n\t\t\t\t\t\tzapi.$body.off('click.year-filter.' + zapi.collection_name).on('click.year-filter.' + zapi.collection_name, '.year-filter h3', zapi.yearFilterTitleToggle);\n\t\t\t\t\t\t// Set up year section element cache\n\t\t\t\t\t\tzapi.$year_sections = zapi.$body.find('.year-section');\n\t\t\t\t\t\t// Build years list\n\t\t\t\t\t\tfor (; i < len; i++) {\n\t\t\t\t\t\t\tif (zapi.years[i].length === 4) {\n\t\t\t\t\t\t\t\tyear_list += '<h6><a class=\"year-link\" href=\"#year-' + zapi.years[i] + '\">' + zapi.years[i] + '</a></h6>';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tzapi.$year_filter.find('.group').append(year_list);\n\t\t\t\t\t\tzapi.$year_links = zapi.$year_filter.find('a.year-link');\n\t\t\t\t\t\tzapi.$year_links.on('click.' + zapi.collection_name, function(evt) {\n\t\t\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\t\t\tvar $year_link  = $(this),\n\t\t\t\t\t\t\t\tactive_year = '';\n\n\t\t\t\t\t\t\t// No other year links should be active\n\t\t\t\t\t\t\tzapi.$year_links.not($year_link).removeClass('active');\n\t\t\t\t\t\t\t$year_link.toggleClass('active');\n\n\t\t\t\t\t\t\tif ($year_link.hasClass('active')) {\n\t\t\t\t\t\t\t\tactive_year = '.' + this.innerHTML;\n\t\t\t\t\t\t\t\t/*zapi.$year_links.filter('.active').each(function() {\n\t\t\t\t\t\t\t\t\tactive_year += (active_year.length ? ', ' : '') + '.' + this.innerHTML;\n\t\t\t\t\t\t\t\t});*/\n\n\t\t\t\t\t\t\t\t// Add filtered class\n\t\t\t\t\t\t\t\tzapi.$body.addClass('filtered');\n\t\t\t\t\t\t\t\tzapi.$year_sections.not(active_year).removeClass('active').fadeOut();\n\t\t\t\t\t\t\t\tzapi.$year_sections.filter(active_year).addClass('active').fadeIn();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tzapi.$body.removeClass('filtered');\n\t\t\t\t\t\t\t\tzapi.$year_sections.fadeIn();\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Recalculate iframe height after 0.3 seconds\n\t\t\t\t\t\t\twindow.setTimeout(function() {\n\t\t\t\t\t\t\t\tzapi.$window.trigger('resize.tabs.' + zapi.collection_name);\n\t\t\t\t\t\t\t}, 300);\n\t\t\t\t\t\t});\n\t\t\t\t\t\t// Remove this handler\n\t\t\t\t\t\tzapi.$body.off('references-load.' + zapi.collection_name);\n\t\t\t\t\t\t// After letting year links settle, remove loading class (to enable smooth dropdown effect)\n\t\t\t\t\t\twindow.setTimeout(function() {\n\t\t\t\t\t\t\tzapi.$body.removeClass(zapi.loading_class);\n\t\t\t\t\t\t}, 200);\n\t\t\t\t\t\t// If .year-filter is currently active, height has changed, so trigger our event\n\t\t\t\t\t\tif (zapi.$year_filter.hasClass('active')) {\n\t\t\t\t\t\t\tzapi.$window.trigger('change-height.tabs.' + zapi.collection_name);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Reload all quarter filters (to avoid bug with first couple year's quarter filter click handlers no longer being triggered after all references finish loading)\n\t\t\t\t\t\twindow.setTimeout(function() {\n\t\t\t\t\t\t\tzapi.setupQuarterFilters(zapi.years);\n\t\t\t\t\t\t}, 200);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tzapi.is_init = false;\n\t\t\t\tzapi.$parent_body.removeClass(zapi.loading_class);\n\t\t\t\t// When this tab is selected, a resize is triggered; use that opportunity to fix the iframe height\n\t\t\t\t// And then trigger the logic once right away for the default tab\n\t\t\t\tzapi.$window.on('resize.tabs.' + zapi.collection_name, zapi.fixTabHeight).trigger('resize.tabs.' + zapi.collection_name);\n\n\t\t\t\t// If we have not yet loaded all the references, set up fetching of the next set of references\n\t\t\t\t// First check to make sure we have a valid total (if not, try to fetch the next set)\n\t\t\t\tif (zapi.total === false || zapi.params.start + zapi.params.num_entries < zapi.total) {\n\t\t\t\t\t// Special logic for quarterly collections (in which case load all references)\n\t\t\t\t\tif (zapi.params.quarterly && !zapi.is_all_loading) {\n\t\t\t\t\t\t// Trigger immediate set up of next references (don't need infinite loading functionality)\n\t\t\t\t\t\tzapi.getNextReferences(true);\n\t\t\t\t\t\tzapi.getAllReferences();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Set up next references set\n\t\t\t\t\t\tzapi.getNextReferences();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// We have finished, so we can process the last year's quarter filters\n\t\t\t\t\tyears_for_quarters.push(the_year);\n\t\t\t\t\tzapi.is_all_loaded = true;\n\t\t\t\t\tzapi.$body.trigger('references-load.' + zapi.collection_name);\n\t\t\t\t}\n\t\t\t\t// Quarter filter setup\n\t\t\t\tif (years_for_quarters.length) {\n\t\t\t\t\tzapi.setupQuarterFilters(years_for_quarters);\n\t\t\t\t}\n\t\t\t}).fail(function() {\n\t\t\t\t// Let's try again\n\t\t\t\tzapi.getReferences();\n\t\t\t});\n\t\t},\n\t\t// Set up infinite scroll-style fetching of next set of references (or trigger it right away if is_all_loading)\n\t\tgetNextReferences: function(timedout) {\n\t\t\t// If not is_all_loading and this is not the timeout, set up timeout and return\n\t\t\tif (!zapi.is_all_loading && !timedout) {\n\t\t\t\t// Make sure resize.tabs has had a chance to do its magic\n\t\t\t\twindow.setTimeout(function() {\n\t\t\t\t\tzapi.getNextReferences(true);\n\t\t\t\t}, 500);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tzapi.params.start += zapi.params.num_entries;\n\n\t\t\t// If this is the first time calling getNextReferences, adjust num_entries to max\n\t\t\t// if (zapi.params.start === zapi.params.num_entries) {\n\t\t\t//\tzapi.params.num_entries = 99;\n\t\t\t// }\n\n\t\t\t// If is_all_loading, load the next set of results\n\t\t\tif (zapi.is_all_loading) {\n\t\t\t\tzapi.getReferences();\n\t\t\t}\n\t\t},\n\t\t// Get all the rest of the references\n\t\tgetAllReferences: function() {\n\t\t\t// If already loaded or loading all references, return\n\t\t\tif (zapi.is_all_loaded || zapi.is_all_loading) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// Load 'em up\n\t\t\tzapi.is_all_loading = true;\n\t\t\t// Load max number of entries at a time\n\t\t\t// zapi.params.num_entries = 99;\n\t\t\t// Set loading class\n\t\t\tzapi.$body.addClass(zapi.loading_class);\n\t\t\t// Kick off reference retrieval\n\t\t\tzapi.getReferences();\n\t\t},\n\t\tinitialize: function() {\n\t\t\tzapi.prepareMarkup();\n\t\t\t// Insert list container and initialize List.js object\n\t\t\tzapi.$reference_list = $('<ul class=\"reference-list\" />').appendTo(zapi.$body);\n\n\t\t\t// zapi.reference_list = new List(zapi.$reference_list, zapi.list_options, {});\n\t\t\t// Get current ip address for google API calls\n\t\t\t$.ajax({\n\t\t\t\turl      : 'http://www.telize.com/jsonip',\n\t\t\t\tdataType : 'jsonp',\n\t\t\t\tsuccess  : function(resp) {\n\t\t\t\t\tzapi.params.ip = resp.ip;\n\t\t\t\t}\n\t\t\t});\n\t\t\t// Add custom height change event handler to body\n\t\t\tzapi.$window.on('change-height.tabs.' + zapi.collection_name, function() {\n\t\t\t\t// Trigger resize tabs event after 0.5 seconds\n\t\t\t\twindow.setTimeout(function() {\n\t\t\t\t\tzapi.$window.trigger('resize.tabs.' + zapi.collection_name);\n\t\t\t\t}, 500);\n\t\t\t});\n\t\t},\n\t\tprepareMarkup: function() {\n\t\t\t// HTML and CSS snippets\n\t\t\tzapi.loading_indicator_styles = '.spinner { display: none; position: absolute; left: 45%; width: 50px; height: 30px; text-align: center; font-size: 10px; } body.' + zapi.loading_class + ' .spinner { display: block; } .spinner > div { background-color: #333; height: 100%; width: 6px; margin: 0 1px; display: inline-block;  -webkit-animation: stretchdelay 1.2s infinite ease-in-out; animation: stretchdelay 1.2s infinite ease-in-out; } .spinner .rect2 { -webkit-animation-delay: -1.1s; animation-delay: -1.1s; } .spinner .rect3 { -webkit-animation-delay: -1.0s; animation-delay: -1.0s; } .spinner .rect4 { -webkit-animation-delay: -0.9s; animation-delay: -0.9s; } .spinner .rect5 { -webkit-animation-delay: -0.8s; animation-delay: -0.8s; } @-webkit-keyframes stretchdelay { 0%, 40%, 100% { -webkit-transform: scaleY(0.4) } 20% { -webkit-transform: scaleY(1.0) } } @keyframes stretchdelay { 0%, 40%, 100% { transform: scaleY(0.4); -webkit-transform: scaleY(0.4); } 20% {  transform: scaleY(1.0); -webkit-transform: scaleY(1.0); } }';\n\t\t\tzapi.loading_indicator_html   = '<div class=\"spinner\"><div class=\"rect1\"></div><div class=\"rect2\"></div><div class=\"rect3\"></div><div class=\"rect4\"></div><div class=\"rect5\"></div></div>';\n\t\t\tzapi.year_filter_html         = '<nav class=\"year-filter c-accordion\"><div class=\"item\"><span class=\"group\"><h3>Archive <div class=\"arrow\"></div></h3>' + zapi.loading_indicator_html + '</span></div></nav>';\n\t\t\t// zapi.list_options             = {\n\t\t\t//\titem: '<div class=\"ref-entry\"><h6 class=\"title\"></h6><div class=\"citation\"></div></div>'\n\t\t\t// };\n\t\t},\n\t\tloadYearFilterList: function(evt) {\n\t\t\tevt.stopPropagation();\n\t\t\t// Add .active/.open\n\t\t\tzapi.yearFilterAddActive();\n\n\t\t\tif (!zapi.is_all_loaded) {\n\t\t\t\tif (zapi.is_all_loading) {\n\t\t\t\t\t// Already working on it\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Don't run this function again\n\t\t\tzapi.$body.off('click.year-filter.' + zapi.collection_name);\n\t\t\tzapi.$body.on( 'click.year-filter.' + zapi.collection_name, '.year-filter', zapi.yearFilterToggle);\n\t\t\tzapi.$body.on( 'click.year-filter.' + zapi.collection_name, '.year-filter h3', zapi.yearFilterTitleToggle);\n\t\t},\n\t\tyearFilterToggle: function(evt) {\n\t\t\tevt.stopPropagation();\n\t\t\t// Add .active/.open\n\t\t\tzapi.yearFilterAddActive();\n\t\t\t// Trigger change height\n\t\t\tzapi.$window.trigger('change-height.tabs.' + zapi.collection_name);\n\t\t},\n\t\tyearFilterTitleToggle: function(evt) {\n\t\t\tevt.stopPropagation();\n\t\t\t// Toggle .active/.open\n\t\t\tzapi.yearFilterToggleActive();\n\t\t\t// Trigger change height\n\t\t\tzapi.$window.trigger('change-height.tabs.' + zapi.collection_name);\n\t\t},\n\t\tyearFilterAddActive: function($year_filter) {\n\t\t\t$year_filter = $year_filter || zapi.$body.find('.year-filter');\n\t\t\tif (!$year_filter.hasClass('active')) {\n\t\t\t\t$year_filter.addClass('active');\n\t\t\t\t$year_filter.find('.item').addClass('open');\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\tyearFilterToggleActive: function($year_filter) {\n\t\t\t$year_filter = $year_filter || zapi.$body.find('.year-filter');\n\t\t\tif (!zapi.yearFilterAddActive($year_filter)) {\n\t\t\t\t$year_filter.removeClass('active');\n\t\t\t\t$year_filter.find('.item').removeClass('open');\n\t\t\t}\n\t\t},\n\t\tsetupQuarterFilters: function(the_years) {\n\t\t\tvar i   = 0,\n\t\t\t\tlen = the_years.length,\n\t\t\t\t$quarters,\n\t\t\t\trefs_by_quarter,\n\t\t\t\tqtr_idx;\n\n\t\t\tif (!zapi.params.quarterly || !len) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// Set up quarter filters, if applicable\n\t\t\tfor (; i < len; i++) {\n\t\t\t\tif (the_years[i].length !== 4) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\t$quarters       = zapi.$body.find('.year-section.' + the_years[i] + ' .quarters');\n\t\t\t\trefs_by_quarter = [];\n\t\t\t\tqtr_idx         = 0;\n\n\t\t\t\tif (!$quarters.length) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tfor (; qtr_idx < 4; qtr_idx++) {\n\t\t\t\t\trefs_by_quarter[qtr_idx] = zapi.$body.find('.year-section.' + the_years[i] + ' .quarter-' + qtr_idx);\n\t\t\t\t\tif (refs_by_quarter[qtr_idx].length) {\n\t\t\t\t\t\t$quarters.find('[data-quarter=\"' + qtr_idx +'\"]').addClass('is-enabled');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tzapi.attachQuarterFilterToggle($quarters, refs_by_quarter);\n\t\t\t}\n\t\t},\n\t\tattachQuarterFilterToggle: function($quarters, refs_by_quarter) {\n\t\t\t$quarters.find('.quarter-filter.is-enabled').off('click.quarter-filter.' + zapi.collection_name).on('click.quarter-filter.' + zapi.collection_name, function() {\n\t\t\t\tvar $filter        = $(this),\n\t\t\t\t\tactive_quarter = '',\n\t\t\t\t\ti;\n\t\t\t\t// No other quarter links should be active\n\t\t\t\t$quarters.find('.quarter-filter').not($filter).removeClass('active');\n\t\t\t\t$filter.toggleClass('active');\n\n\t\t\t\tif ($filter.hasClass('active')) {\n\t\t\t\t\tactive_quarter = parseInt($filter.data('quarter'), 10);\n\t\t\t\t\tfor (i = 0; i < 4; i++) {\n\t\t\t\t\t\tif (i !== active_quarter) {\n\t\t\t\t\t\t\trefs_by_quarter[i].fadeOut();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trefs_by_quarter[i].fadeIn();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tfor (i = 0; i < 4; i++) {\n\t\t\t\t\t\tif (i !== active_quarter) {\n\t\t\t\t\t\t\trefs_by_quarter[i].fadeIn();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// Trigger change height\n\t\t\t\tzapi.$window.trigger('change-height.tabs.' + zapi.collection_name);\n\t\t\t});\n\t\t}\n\t};\n\n\t// Export our Zotero API handler (it may already be defined, in which case merge it into our local zapi)\n\twindow.zotero_api = window.zotero_api || {};\n\t// $.extend() merges 2nd object into first, modifying it, and returns the modified object\n\twindow.zotero_api = $.extend(zapi, window.zotero_api);\n\n})(window.jQuery || window.parent.jQuery);\n"]}