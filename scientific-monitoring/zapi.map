{"version":3,"file":"zapi.js","sources":["zapi-compiled.js"],"names":["$","zapi","js_plugin_src","defaults","collection","user","num_entries","start","zotero_options","params","callback","collection_name","window","location","pathname","split","pop","replace","feed_base","namespace","lang","$body","document","body","$window","$parent_body","$footer","$year_filter","$year_links","$year_sections","quarter_labels","en","fr","years","total","is_init","load_all","all_loaded","loading_class","loading_indicator_styles","loading_indicator_html","monitoring_css","year_filter_html","tab_height_timeout","fixTabHeight","clearTimeout","setTimeout","off","frameElement","height","tab_height","parent","on","filterByType","type","this","attr","buildParams","options","extend","getFeedUrl","feed_url","Date","toDateString","q","encodeURIComponent","getReferences","substr","shift","prepareMarkup","hasClass","find","append","addClass","prev","className","before","ajax","url","dataType","success","resp","responseData","xmlString","the_month","$entry","$bib","bib_html","bib_url_start","entry","entry_class","$feed","parseXML","$entries","len","length","i","ref_html","the_year","year_class","is_new_year","parseInt","text","parseJSON","filter","push","quarterly","date","getMonth","isNaN","Math","floor","title","children","outerHTML","lastIndexOf","substring","indexOf","loadYearFilterList","year_list","yearFilterToggle","yearFilterTitleToggle","evt","preventDefault","$year_link","active_year","not","removeClass","toggleClass","innerHTML","fadeOut","fadeIn","trigger","each","quarters","quarter_class","$quarters","$year_title","refs_by_quarter","insertAfter","$filter","active_quarter","data","getNextReferences","timedout","stopPropagation","yearFilterAddActive","yearFilterToggleActive","zotero_api","undefined","event","special","inview","href","join","jQuery"],"mappings":"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","sourcesContent":["(function($) {\n\tvar zapi, js_plugin_src;\n\n\tzapi = {\n\t\tdefaults : {\n\t\t\tcollection     : '',\n\t\t\tuser           : '1562960',\n\t\t\t// Number of entries to fetch\n\t\t\tnum_entries    : 20,\n\t\t\tstart          : 0,\n\t\t\tzotero_options : 'format=atom&content=json,bib&style=apa&order=date&sort=desc'\n\t\t},\n\t\tparams          : {},\n\t\tcallback        : {},\n\t\tcollection_name : window.location.pathname.split('/').pop().replace('archive-', '').replace('monitoring-', '').replace('.html', ''),\n\t\tfeed_base       : 'https://api.zotero.org/users/',\n\t\tnamespace       : 'zapi\\\\:',\n\t\tlang            : 'en',\n\t\t// @todo try fetching xml nodes with namespace prefix; if it doesn't work, set namespace prefix to ''\n\t\t// Element cache (careful with using string selectors with this jQuery; it will search the parent DOM)\n\t\t$body          : $(document.body),\n\t\t$window        : $(window),\n\t\t$parent_body   : $('body'),\n\t\t$footer        : $('.c-back-to-top'),\n\t\t$year_filter   : $(),\n\t\t$year_links    : $(),\n\t\t$year_sections : $(),\n\t\t// Labels for quarter-year filters\n\t\tquarter_labels  : {\n\t\t\t'en': [\n\t\t\t\t'Jan - Mar',\n\t\t\t\t'April - June',\n\t\t\t\t'July - Sept',\n\t\t\t\t'Oct - Dec'\n\t\t\t],\n\t\t\t'fr': [\n\t\t\t\t'Jan - Mars',\n\t\t\t\t'Avril - Juin',\n\t\t\t\t'Juil - Sept',\n\t\t\t\t'Oct - Dec'\n\t\t\t]\n\t\t},\n\t\t// An array of years of the references (for archive page)\n\t\tyears      : [],\n\t\t// Total number of references\n\t\ttotal      : false,\n\t\t// Flag if is initial load\n\t\tis_init    : true,\n\t\t// Flag for loading all references immediately\n\t\tload_all   : false,\n\t\t// Flag for keeping track if all references have been loaded\n\t\tall_loaded : false,\n\t\t// Class to add to body when loading references\n\t\tloading_class      : 'loading-references',\n\t\t// HTML and CSS snippets\n\t\tloading_indicator_styles : '',\n\t\tloading_indicator_html   : '',\n\t\tmonitoring_css           : '.year-filter{width:24%;min-width:145px;float:right;margin:0 0 .5em .25em}.year-filter .item{position:relative;max-height:50px;overflow:hidden;cursor:pointer}.year-filter.active .item{max-height:450px;overflow-y:auto;cursor:default}body.loading-references .year-filter.active .item{max-height:110px;overflow:hidden}.year-filter .spinner{position:static;margin:1em auto}.year-filter h3{position:relative;cursor:pointer}.year-filter h6 a{display:block;padding:.2em 1em}.quarter-filter.is-enabled:hover,.year-filter h6 a:hover{background:#f0f0f0;cursor:pointer}.quarter-filter.active,.quarter-filter.active:hover,.year-filter h6 a.active,.year-filter h6 a.active:hover{background:#ddd}.quarters{float:left;margin-left:9px;margin-top:20px;line-height:42px}#boot .year-section h2{margin-top:20px}#boot .year-section.first h2,#boot.filtered .year-section h2{margin-top:0}#boot .year-section h6{margin-top:1em}.filtered .year-section .quarters,.year-section.first .quarters{margin-top:0}.quarter-filter{border:1px solid #e5e5e5;font-weight:700;font-size:13px;padding:.25em .35em;margin:0 .25em;-ms-filter:\"alpha(Opacity=50)\";filter:alpha(opacity=50);opacity:.5}.quarter-filter.is-enabled{-ms-filter:\"alpha(Opacity=100)\";filter:alpha(opacity=100);opacity:1}h2.quarterly{float:left}.ref-entry{clear:left}#boot .year-filter h6 a:hover{text-decoration:none}#boot .year-filter.active .item:hover{background-color:transparent}',\n\t\tyear_filter_html         : '',\n\t\t// Set the correct height of the tab iframe\n\t\ttab_height_timeout: '',\n\t\tfixTabHeight: function() {\n\t\t\twindow.clearTimeout(zapi.tab_height_timeout);\n\t\t\tzapi.tab_height_timeout = window.setTimeout(function() {\n\t\t\t\t// Remove this event listener, adjust height, add back the listener\n\t\t\t\tzapi.$window.off('resize.tabs.' + zapi.collection_name);\n\t\t\t\t// Set height with extra 50px\n\t\t\t\twindow.frameElement.height = zapi.tab_height = zapi.$body.parent().height() + 50;\n\t\t\t\t// Add back the listener\n\t\t\t\twindow.setTimeout(function() {\n\t\t\t\t\tzapi.$window.on('resize.tabs.' + zapi.collection_name, zapi.fixTabHeight);\n\t\t\t\t}, 200);\n\t\t\t}, 200);\n\t\t},\n\t\tfilterByType: function(type) {\n\t\t\treturn function() {\n\t\t\t\treturn $(this).attr('zapi:type') === type;\n\t\t\t};\n\t\t},\n\t\tbuildParams: function(options) {\n\t\t\tzapi.params = $.extend({}, zapi.defaults, options);\n\t\t},\n\t\tgetFeedUrl: function() {\n\t\t\tvar feed_url = zapi.feed_base;\n\t\t\t\n\t\t\t// Build the zotero api url\n\t\t\tfeed_url += zapi.params.user + '/collections/' + zapi.params.collection + '/items?' + zapi.params.zotero_options + '&start=' + zapi.params.start + '&limit=' + zapi.params.num_entries;\n\t\t\t\n\t\t\t// Add a 24 hour cache busting date string\n\t\t\tfeed_url += '&cb=' + new Date().toDateString();\n\t\t\t\n\t\t\tif (zapi.params.q) {\n\t\t\t\tfeed_url += '&q=' + zapi.params.q + '&qmode=titleCreatorYear';\n\t\t\t}\n\t\t\t// Build the google feed api url and return it\n\t\t\treturn 'https://ajax.googleapis.com/ajax/services/feed/load?v=1.0&output=xml&num=' + zapi.params.num_entries + '&q=' + encodeURIComponent(feed_url);\n\t\t},\n\t\tgetReferences: function(options, callback) {\n\t\t\t// If we have options (like on first load), use them\n\t\t\tif (options) {\n\t\t\t\t// Build our params, then get the feed url\n\t\t\t\tzapi.buildParams(options);\n\t\t\t\tif (callback) {\n\t\t\t\t\tzapi.callback = callback;\n\t\t\t\t}\n\t\t\t\t// Special logic for language\n\t\t\t\tif (window.location.pathname.substr(1).split('/').shift() === 'fr') {\n\t\t\t\t\tzapi.lang = 'fr';\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (zapi.is_init) {\n\t\t\t\tzapi.prepareMarkup();\n\t\t\t}\n\t\t\t// If all references are already loaded, return\n\t\t\tif (zapi.all_loaded) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// Get the google feed api url\n\t\t\tvar feed_url = zapi.getFeedUrl();\n\t\t\t\n\t\t\t// Check if the iframe has our styles yet\n\t\t\tif (!zapi.$body.hasClass('ready')) {\n\t\t\t\t$(document).find('head').append('<style>' + zapi.monitoring_css + '\\n' + zapi.loading_indicator_styles + '</style>');\n\t\t\t\tzapi.$body.addClass('ready');\n\t\t\t}\n\n\t\t\t// If the spinner markup is not yet in the parent.window DOM, set it up and add styles\n\t\t\tif (zapi.$footer.prev()[0].className !== 'spinner') {\n\t\t\t\t// First, our styles\n\t\t\t\t$('head').append('<style>' + zapi.loading_indicator_styles + '</style>');\n\t\t\t\t// And our markup\n\t\t\t\tzapi.$footer.before(zapi.loading_indicator_html);\n\t\t\t}\n\t\t\t\n\t\t\t// Add loading references class\n\t\t\tzapi.$parent_body.addClass(zapi.loading_class);\n\t\t\t$.ajax({\n\t\t\t\turl: feed_url,\n\t\t\t\tdataType: 'jsonp',\n\t\t\t\tsuccess: function(resp) {\n\t\t\t\t\t// Do we have a good response? If not, lets try again\n\t\t\t\t\tif (!resp.responseData || !resp.responseData.xmlString) {\n\t\t\t\t\t\tzapi.getReferences();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tvar // Structure of resp: resp.responseData.feed.entries[]\n\t\t\t\t\t\t$feed       = $($.parseXML(resp.responseData.xmlString)),\n\t\t\t\t\t\t$entries    = $feed.find('entry'),\n\t\t\t\t\t\tlen         = $entries.length,\n\t\t\t\t\t\ti           = 0,\n\t\t\t\t\t\tref_html    = '',\n\t\t\t\t\t\tthe_year    = '',\n\t\t\t\t\t\tyear_class  = '',\n\t\t\t\t\t\tis_new_year = false,\n\t\t\t\t\t\tthe_month,\n\t\t\t\t\t\t$entry,\n\t\t\t\t\t\t$bib,\n\t\t\t\t\t\tbib_html,\n\t\t\t\t\t\tbib_url_start,\n\t\t\t\t\t\tentry,\n\t\t\t\t\t\tentry_class;\n\n\t\t\t\t\t// Check if we have set the total results yet\n\t\t\t\t\tif (zapi.total === false) {\n\t\t\t\t\t\t// First time through, try to fetch totalResults node using the namespace ('zapi\\\\:')\n\t\t\t\t\t\tzapi.total = $feed.find(zapi.namespace + 'totalResults');\n\t\t\t\t\t\t// If that failed, try it without the namespace (set the namespace as an empty string)\n\t\t\t\t\t\tif (!zapi.total.length) {\n\t\t\t\t\t\t\tzapi.namespace = '';\n\t\t\t\t\t\t\tzapi.total = $feed.find(zapi.namespace + 'totalResults');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tzapi.total = parseInt(zapi.total.text(), 10);\n\t\t\t\t\t}\n\t\t\t\t\tfor (; i < len; i++) {\n\t\t\t\t\t\t$entry = $($entries[i]);\n\t\t\t\t\t\t// If this selector doesn't work, we need to use a filter function and check attr('zapi:type')\n\t\t\t\t\t\tentry = $.parseJSON($entry.find(zapi.namespace + 'subcontent').filter(zapi.filterByType('json')).text());\n\t\t\t\t\t\t\n\t\t\t\t\t\tentry_class = 'ref-entry';\n\t\t\t\t\t\t\n\t\t\t\t\t\tthe_year = $entry.find(zapi.namespace + 'year').text();\n\t\t\t\t\t\tis_new_year = zapi.years[zapi.years.length - 1] !== the_year;\n\t\t\t\t\t\t// Is it a new year section or the first of this group of references\n\t\t\t\t\t\tif (!ref_html.length || is_new_year) {\n\t\t\t\t\t\t\t// If this is not the first year header and not the first of this group of references, close the previous year div\n\t\t\t\t\t\t\tif (zapi.years.length && ref_html.length) {\n\t\t\t\t\t\t\t\tref_html += '</div>';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tyear_class = 'year-section ' + the_year;\n\t\t\t\t\t\t\t// If this is the very first year, add .first class\n\t\t\t\t\t\t\tif (!zapi.years.length) {\n\t\t\t\t\t\t\t\tyear_class += ' first';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tref_html += '<div class=\"' + year_class + '\">';\n\t\t\t\t\t\t\t// If first of this year, add heading and push year onto years array\n\t\t\t\t\t\t\tif (is_new_year) {\n\t\t\t\t\t\t\t\tref_html += '<h2 id=\"year-' + the_year + '\">' + the_year + '</h2>';\n\t\t\t\t\t\t\t\tzapi.years.push(the_year);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Quarterly logic requires the date also\n\t\t\t\t\t\tif (zapi.params.quarterly) {\n\t\t\t\t\t\t\tthe_month = new Date(entry.date);\n\t\t\t\t\t\t\tthe_month = the_month.getMonth();\n\t\t\t\t\t\t\tif (isNaN(the_month)) {\n\t\t\t\t\t\t\t\t// If Date() failed to parse the_month string, default to first month\n\t\t\t\t\t\t\t\tthe_month = 0;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tentry_class += ' year-' + the_year + ' quarter-' + Math.floor(the_month / 3);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Entry wrap\n\t\t\t\t\t\tref_html += '<div class=\"' + entry_class + '\">';\n\t\t\t\t\t\t// Title\n\t\t\t\t\t\tref_html += '<h6>' + (entry.url ? '<a href=\"' + entry.url + '\" target=\"_blank\">' : '') + entry.title + (entry.url ? '</a>' : '') + '</h6>';\n\n\t\t\t\t\t\t$bib = $entry.find(zapi.namespace + 'subcontent').filter(zapi.filterByType('bib')).children('div');\n\t\t\t\t\t\tif ($bib.length) {\n\t\t\t\t\t\t\tbib_html = $bib[0].outerHTML;\n\t\t\t\t\t\t\tif (entry.url) {\n\t\t\t\t\t\t\t\tbib_url_start = bib_html.lastIndexOf(' from http://');\n\t\t\t\t\t\t\t\tif (bib_url_start === -1) {\n\t\t\t\t\t\t\t\t\tbib_url_start = bib_html.lastIndexOf(' from https://');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (bib_url_start !== -1) {\n\t\t\t\t\t\t\t\t\t// The \"from [url]\" text always has ' Retrieved' before it, so go find that text\n\t\t\t\t\t\t\t\t\t// bib_url_start -= 10;\n\t\t\t\t\t\t\t\t\tbib_url_start = bib_html.substring(0, bib_url_start).lastIndexOf(' Retrieved');\n\t\t\t\t\t\t\t\t\tif (bib_url_start !== -1) {\n\t\t\t\t\t\t\t\t\t\tbib_html = bib_html.substring(0, bib_url_start) + bib_html.substring(bib_html.indexOf('</div>'));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tref_html += bib_html;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tref_html += '</div>';\n\t\t\t\t\t}\n\t\t\t\t\t// Close div.year-section\n\t\t\t\t\tref_html += '</div>';\n\t\t\t\t\t// First time through, add in year filter html\n\t\t\t\t\tif (zapi.is_init) {\n\t\t\t\t\t\tref_html = zapi.year_filter_html + ref_html;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Finished building HTML\n\t\t\t\t\t// Pass it to callback\n\t\t\t\t\t// ----------------------\n\t\t\t\t\tzapi.callback(ref_html);\n\t\t\t\t\t// ----------------------\n\n\t\t\t\t\t// Initial run through, set up JS and styles for year filter\n\t\t\t\t\tif (zapi.is_init) {\n\t\t\t\t\t\t// Set this flag now to false to avoid conflicts with calling getReferences again\n\t\t\t\t\t\tzapi.is_init = false;\n\t\t\t\t\t\t// Attach filter by year click handler\n\t\t\t\t\t\tzapi.$year_filter = zapi.$body.find('.year-filter');\n\t\t\t\t\t\tzapi.$body.on('click.year-filter.' + zapi.collection_name, '.year-filter', zapi.loadYearFilterList);\n\t\t\t\t\t\tzapi.$body.on('references-load.' + zapi.collection_name, function() {\n\t\t\t\t\t\t\tvar // Prepare for year calculations\n\t\t\t\t\t\t\t\tyear_list = '',\n\t\t\t\t\t\t\t\ti         = 0,\n\t\t\t\t\t\t\t\tlen       = zapi.years.length;\n\n\t\t\t\t\t\t\t// Reset $year_filter object from DOM\n\t\t\t\t\t\t\tzapi.$year_filter = zapi.$body.find('.year-filter');\n\t\t\t\t\t\t\t// Remove all click handlers, then add back simple toggle handler\n\t\t\t\t\t\t\tzapi.$body.off('click.year-filter.' + zapi.collection_name).on('click.year-filter.' + zapi.collection_name, '.year-filter', zapi.yearFilterToggle);\n\t\t\t\t\t\t\tzapi.$body.off('click.year-filter.' + zapi.collection_name).on('click.year-filter.' + zapi.collection_name, '.year-filter h3', zapi.yearFilterTitleToggle);\n\t\t\t\t\t\t\t// Set up year section element cache\n\t\t\t\t\t\t\tzapi.$year_sections = zapi.$body.find('.year-section');\n\t\t\t\t\t\t\t// Build years list\n\t\t\t\t\t\t\tfor (; i < len; i++) {\n\t\t\t\t\t\t\t\tif (zapi.years[i].length) {\n\t\t\t\t\t\t\t\t\tyear_list += '<h6><a class=\"year-link\" href=\"#year-' + zapi.years[i] + '\">' + zapi.years[i] + '</a></h6>';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tzapi.$year_filter.find('.group').append(year_list);\n\t\t\t\t\t\t\tzapi.$year_links = zapi.$year_filter.find('a.year-link');\n\t\t\t\t\t\t\tzapi.$year_links.on('click.' + zapi.collection_name, function(evt) {\n\t\t\t\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\t\t\t\tvar $year_link  = $(this),\n\t\t\t\t\t\t\t\t\tactive_year = '';\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// No other year links should be active\n\t\t\t\t\t\t\t\tzapi.$year_links.not($year_link).removeClass('active');\n\t\t\t\t\t\t\t\t$year_link.toggleClass('active');\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif ($year_link.hasClass('active')) {\n\t\t\t\t\t\t\t\t\tactive_year = '.' + this.innerHTML;\n\t\t\t\t\t\t\t\t\t/*zapi.$year_links.filter('.active').each(function() {\n\t\t\t\t\t\t\t\t\t\tactive_year += (active_year.length ? ', ' : '') + '.' + this.innerHTML;\n\t\t\t\t\t\t\t\t\t});*/\n\n\t\t\t\t\t\t\t\t\t// Add filtered class\n\t\t\t\t\t\t\t\t\tzapi.$body.addClass('filtered');\n\t\t\t\t\t\t\t\t\tzapi.$year_sections.not(active_year).removeClass('active').fadeOut();\n\t\t\t\t\t\t\t\t\tzapi.$year_sections.filter(active_year).addClass('active').fadeIn();\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tzapi.$body.removeClass('filtered');\n\t\t\t\t\t\t\t\t\tzapi.$year_sections.fadeIn();\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// Recalculate iframe height after 0.3 seconds\n\t\t\t\t\t\t\t\twindow.setTimeout(function() {\n\t\t\t\t\t\t\t\t\tzapi.$window.trigger('resize.tabs.' + zapi.collection_name);\n\t\t\t\t\t\t\t\t}, 300);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t// Remove this handler\n\t\t\t\t\t\t\tzapi.$body.off('references-load.' + zapi.collection_name);\n\t\t\t\t\t\t\t// After letting year links settle, remove loading class (to enable smooth dropdown effect)\n\t\t\t\t\t\t\twindow.setTimeout(function() {\n\t\t\t\t\t\t\t\tzapi.$body.removeClass(zapi.loading_class);\n\t\t\t\t\t\t\t}, 50);\n\t\t\t\t\t\t\t// If .year-filter is currently active, recalculate iframe height after 0.5 seconds\n\t\t\t\t\t\t\tif (zapi.$year_filter.hasClass('active')) {\n\t\t\t\t\t\t\t\twindow.setTimeout(function() {\n\t\t\t\t\t\t\t\t\tzapi.$window.trigger('resize.tabs.' + zapi.collection_name);\n\t\t\t\t\t\t\t\t}, 500);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// Now set up quarter filters, if applicable\n\t\t\t\t\t\t\tif (zapi.params.quarterly) {\n\t\t\t\t\t\t\t\tzapi.$body.find('h2').each(function() {\n\t\t\t\t\t\t\t\t\tvar $year_title = $(this),\n\t\t\t\t\t\t\t\t\t\tthe_year = this.innerHTML,\n\t\t\t\t\t\t\t\t\t\tquarters,\n\t\t\t\t\t\t\t\t\t\tquarter_class,\n\t\t\t\t\t\t\t\t\t\t$quarters,\n\t\t\t\t\t\t\t\t\t\trefs_by_quarter = [],\n\t\t\t\t\t\t\t\t\t\ti;\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tif (!the_year.length) {\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tquarters = '<div class=\"quarters\">';\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tfor (i = 0; i < 4; i++) {\n\t\t\t\t\t\t\t\t\t\tquarter_class = 'quarter-filter';\n\t\t\t\t\t\t\t\t\t\trefs_by_quarter[i] = zapi.$body.find('.year-section.' + the_year + ' .quarter-' + i);\n\t\t\t\t\t\t\t\t\t\tif (refs_by_quarter[i].length) {\n\t\t\t\t\t\t\t\t\t\t\tquarter_class += ' is-enabled';\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tquarters += '<span class=\"' + quarter_class + '\" data-quarter=\"' + i + '\">' + zapi.quarter_labels[zapi.lang][i] + '</span>';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tquarters += '</div>';\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t$year_title.addClass('quarterly');\n\t\t\t\t\t\t\t\t\t$quarters = $(quarters).insertAfter($year_title);\n\t\t\t\t\t\t\t\t\t$quarters.on('click', '.quarter-filter.is-enabled', function() {\n\t\t\t\t\t\t\t\t\t\tvar $filter = $(this),\n\t\t\t\t\t\t\t\t\t\t\tactive_quarter = '',\n\t\t\t\t\t\t\t\t\t\t\ti;\n\t\t\t\t\t\t\t\t\t\t// No other quarter links should be active\n\t\t\t\t\t\t\t\t\t\t$quarters.find('.quarter-filter').not($filter).removeClass('active');\n\t\t\t\t\t\t\t\t\t\t$filter.toggleClass('active');\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\tif ($filter.hasClass('active')) {\n\t\t\t\t\t\t\t\t\t\t\tactive_quarter = parseInt($filter.data('quarter'), 10);\n\t\t\t\t\t\t\t\t\t\t\tfor (i = 0; i < 4; i++) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (i !== active_quarter) {\n\t\t\t\t\t\t\t\t\t\t\t\t\trefs_by_quarter[i].fadeOut();\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\trefs_by_quarter[i].fadeIn();\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tfor (i = 0; i < 4; i++) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (i !== active_quarter) {\n\t\t\t\t\t\t\t\t\t\t\t\t\trefs_by_quarter[i].fadeIn();\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tzapi.is_init = false;\n\t\t\t\t\tzapi.$parent_body.removeClass(zapi.loading_class);\n\t\t\t\t\t// When this tab is selected, a resize is triggered; use that opportunity to fix the iframe height\n\t\t\t\t\t// And then trigger the logic once right away for the default tab\n\t\t\t\t\tzapi.$window.on('resize.tabs.' + zapi.collection_name, zapi.fixTabHeight).trigger('resize.tabs.' + zapi.collection_name);\n\t\t\t\t\t\n\t\t\t\t\t// If we have not yet loaded all the references, set up fetching of the next set of references\n\t\t\t\t\tif (zapi.params.start + zapi.params.num_entries < zapi.total) {\n\t\t\t\t\t\tzapi.getNextReferences();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tzapi.all_loaded = true;\n\t\t\t\t\t\tzapi.$body.trigger('references-load.' + zapi.collection_name);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\t// Set up infinite scroll-style fetching of next set of references (or trigger it right away if load_all)\n\t\tgetNextReferences: function(timedout) {\n\t\t\t// If not load_all and this is not the timeout, set up timeout and return\n\t\t\tif (!zapi.load_all && !timedout) {\n\t\t\t\t// Make sure resize.tabs has had a chance to do its magic by attaching inview event after 500 ms\n\t\t\t\twindow.setTimeout(function() {\n\t\t\t\t\tzapi.getNextReferences(true);\n\t\t\t\t}, 500);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tzapi.params.start += zapi.params.num_entries;\n\t\t\t\n\t\t\t// If this is the first time calling getNextReferences, adjust num_entries to 50\n\t\t\tif (zapi.params.start === zapi.params.num_entries) {\n\t\t\t\tzapi.params.num_entries = 50;\n\t\t\t}\n\t\t\t\n\t\t\t// If not load_all, add a handler to the parent window to load the next set of results\n\t\t\tif (!zapi.load_all) {\n\t\t\t\tzapi.$footer.on('inview.' + zapi.collection_name, function() {\n\t\t\t\t\t// Is the current active tab this one?\n\t\t\t\t\tif ($('.tab-pane.active').attr('id') !== zapi.collection_name) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t// It is the current tab, so remove this handler and get the next set of references\n\t\t\t\t\tzapi.$footer.off('inview.' + zapi.collection_name);\n\t\t\t\t\tzapi.getReferences();\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tzapi.getReferences();\n\t\t\t}\n\t\t},\n\t\tprepareMarkup: function() {\n\t\t\t// HTML and CSS snippets\n\t\t\tzapi.loading_indicator_styles = '.spinner { display: none; position: absolute; left: 45%; width: 50px; height: 30px; text-align: center; font-size: 10px; } body.' + zapi.loading_class + ' .spinner { display: block; } .spinner > div { background-color: #333; height: 100%; width: 6px; margin: 0 1px; display: inline-block;  -webkit-animation: stretchdelay 1.2s infinite ease-in-out; animation: stretchdelay 1.2s infinite ease-in-out; } .spinner .rect2 { -webkit-animation-delay: -1.1s; animation-delay: -1.1s; } .spinner .rect3 { -webkit-animation-delay: -1.0s; animation-delay: -1.0s; } .spinner .rect4 { -webkit-animation-delay: -0.9s; animation-delay: -0.9s; } .spinner .rect5 { -webkit-animation-delay: -0.8s; animation-delay: -0.8s; } @-webkit-keyframes stretchdelay { 0%, 40%, 100% { -webkit-transform: scaleY(0.4) } 20% { -webkit-transform: scaleY(1.0) } } @keyframes stretchdelay { 0%, 40%, 100% { transform: scaleY(0.4); -webkit-transform: scaleY(0.4); } 20% {  transform: scaleY(1.0); -webkit-transform: scaleY(1.0); } }';\n\t\t\tzapi.loading_indicator_html   = '<div class=\"spinner\"><div class=\"rect1\"></div><div class=\"rect2\"></div><div class=\"rect3\"></div><div class=\"rect4\"></div><div class=\"rect5\"></div></div>';\n\t\t\tzapi.year_filter_html         = '<nav class=\"year-filter c-accordion\"><div class=\"item\"><span class=\"group\"><h3>Archive <div class=\"arrow\"></div></h3>' + zapi.loading_indicator_html + '</span></div></nav>';\n\t\t},\n\t\tloadYearFilterList: function(evt) {\n\t\t\tevt.stopPropagation();\n\t\t\t// Add .active/.open\n\t\t\tzapi.yearFilterAddActive();\n\t\t\t\n\t\t\tif (!zapi.all_loaded) {\n\t\t\t\tif (zapi.load_all) {\n\t\t\t\t\t// Already working on it\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// Load 'em up\n\t\t\t\tzapi.load_all = true;\n\t\t\t\t// Load max number of entries at a time\n\t\t\t\tzapi.params.num_entries = 99;\n\t\t\t\t// Set loading class\n\t\t\t\tzapi.$body.addClass(zapi.loading_class);\n\t\t\t\t// Kick off reference retrieval\n\t\t\t\tzapi.getReferences();\n\t\t\t}\n\t\t\t// Don't run this function again\n\t\t\tzapi.$body.off('click.year-filter.' + zapi.collection_name);\n\t\t\tzapi.$body.on('click.year-filter.' + zapi.collection_name, '.year-filter', zapi.yearFilterToggle);\n\t\t\tzapi.$body.on('click.year-filter.' + zapi.collection_name, '.year-filter h3', zapi.yearFilterTitleToggle);\n\t\t},\n\t\tyearFilterToggle: function(evt) {\n\t\t\tevt.stopPropagation();\n\t\t\t// Add .active/.open\n\t\t\tzapi.yearFilterAddActive();\n\n\t\t\t// Recalculate iframe height after 0.5 seconds\n\t\t\twindow.setTimeout(function() {\n\t\t\t\tzapi.$window.trigger('resize.tabs.' + zapi.collection_name);\n\t\t\t}, 500);\n\t\t},\n\t\tyearFilterTitleToggle: function(evt) {\n\t\t\tevt.stopPropagation();\n\t\t\t// Toggle .active/.open\n\t\t\tzapi.yearFilterToggleActive();\n\t\t\t\n\t\t\t// Recalculate iframe height after 0.5 seconds\n\t\t\twindow.setTimeout(function() {\n\t\t\t\tzapi.$window.trigger('resize.tabs.' + zapi.collection_name);\n\t\t\t}, 500);\n\t\t},\n\t\tyearFilterAddActive: function($year_filter) {\n\t\t\t$year_filter = $year_filter || zapi.$body.find('.year-filter');\n\t\t\tif (!$year_filter.hasClass('active')) {\n\t\t\t\t$year_filter.addClass('active');\n\t\t\t\t$year_filter.find('.item').addClass('open');\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\tyearFilterToggleActive: function($year_filter) {\n\t\t\t$year_filter = $year_filter || zapi.$body.find('.year-filter');\n\t\t\tif (!zapi.yearFilterAddActive($year_filter)) {\n\t\t\t\t$year_filter.removeClass('active');\n\t\t\t\t$year_filter.find('.item').removeClass('open');\n\t\t\t}\n\t\t}\n\t};\n\n\t// Export our Zotero API handler\n\twindow.zotero_api = zapi;\n\t\n\t// Attach jquery.inview to parent if not yet attached\n\tif ($.event.special.inview === undefined) {\n\t\tjs_plugin_src = window.location.href.split('/');\n\t\tjs_plugin_src.pop();\n\t\tjs_plugin_src.push('jquery.inview.min.js');\n\t\tzapi.$parent_body.append('<script src=\"' + js_plugin_src.join('/') + '\"><\\/script>');\n\t}\n})(window.jQuery || window.parent.jQuery);\n"]}